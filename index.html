<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NoShopiA - Reutiliza tu ropa con IA</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #3b82f6; --text-primary: #1f2937; --text-secondary: #6b7280; --background: #ffffff;
      --border: #e5e7eb; --accent: #10b981; --warning: #f59e0b; --error: #ef4444; --success: #10b981; --gold: #fbbf24;
      --surface: #f8fafc; --surface-hover: #f1f5f9;
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.6; overflow-x: hidden;
      background: var(--background); color: #000000; min-height: 100vh; font-size: 1.2em;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
    .section { padding: 6rem 5%; position: relative; z-index: 2; background: var(--background); }
    .section-title { text-align: center; margin-bottom: 4rem; }
    .section-title h2 { font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; color: #000000; }
    .section-subtitle { font-size: 1.2rem; max-width: 600px; margin: 0 auto; color: #000000; opacity: 0.8; }
    
    /* Header & Navigation */
    header {
      position: fixed; top: 0; width: 100%; padding: 1rem 5%; background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); z-index: 1000; transition: all 0.3s ease;
    }
    nav { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
    .logo { font-size: 3rem; font-weight: 900; display: flex; align-items: center; letter-spacing: 1px; }
    .logo-no { color: #ef4444; } .logo-shop { color: #000000; } .logo-i, .logo-a { color: #22c55e; }
    .nav-pills {
      display: flex; background: rgba(59, 130, 246, 0.1); padding: 0.5rem; border-radius: 50px; gap: 0.5rem;
    }
    .nav-pill {
      padding: 0.7rem 1.5rem; border-radius: 25px; color: #000000; text-decoration: none; font-weight: 500;
      transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;
    }
    .nav-pill:hover, .nav-pill.active { background: rgba(59, 130, 246, 0.2); transform: translateY(-2px); }
    
    /* Enhanced Buttons */
    .btn {
      padding: 1.2rem 3rem; border: none; border-radius: 50px; font-weight: 600; font-size: 1.1rem;
      cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.8rem;
      text-decoration: none; outline: none; box-sizing: border-box;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #1d4ed8); color: white;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4); }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .btn-secondary {
      background: rgba(59, 130, 246, 0.1); color: var(--primary); border: 2px solid var(--primary);
    }
    .btn-secondary:hover { background: var(--primary); color: white; transform: translateY(-2px); }
    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669); color: white;
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    }
    .btn-success:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4); }
    .btn-danger {
      background: linear-gradient(135deg, var(--error), #dc2626); color: white;
      box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
    }
    .btn-danger:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(239, 68, 68, 0.4); }
    
    /* Hero Section */
    .hero {
      min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; position: relative; z-index: 2; padding: 6rem 2rem 4rem; background: var(--background);
    }
    .hero h1 { font-size: clamp(2rem, 5vw, 4rem); font-weight: 800; margin-bottom: 1rem; color: #000000; line-height: 1.2; }
    .hero-subtitle { font-size: 1.3rem; margin-bottom: 0.5rem; font-weight: 600; color: #000000; }
    
    /* Grid Layouts */
    .grid { display: grid; gap: 2rem; }
    .grid-2 { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    .grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
    .grid-5 { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    
    /* Enhanced Card Components */
    .card {
      background: var(--background); border-radius: 25px; padding: 3rem 2rem; border: 1px solid var(--border);
      transition: all 0.3s ease; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .card:hover { transform: translateY(-10px); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15); }
    .card-compact { padding: 2rem 1.5rem; }
    .card-icon { font-size: 3rem; margin-bottom: 1rem; color: var(--primary); }
    .card-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #000000; }
    
    /* Form Sections */
    .form-section {
      background: rgba(59, 130, 246, 0.05); border: 2px solid rgba(59, 130, 246, 0.2);
      border-radius: 20px; padding: 3rem 2rem; margin: 2rem 0; animation: fadeInUp 0.6s ease-out;
    }
    .form-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .form-option {
      background: var(--background); border: 2px solid var(--border); border-radius: 15px; padding: 1rem 0.5rem;
      cursor: pointer; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center;
      gap: 0.5rem; font-size: 0.9rem; font-weight: 500; color: #000000; text-align: center;
      min-height: 80px; justify-content: center;
    }
    .form-option:hover { transform: translateY(-3px); border-color: var(--primary); background: rgba(59, 130, 246, 0.1); }
    .form-option.selected {
      border-color: var(--primary); background: rgba(59, 130, 246, 0.15); transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
    }
    
    /* Upload Components */
    .upload-area {
      background: rgba(59, 130, 246, 0.02); border: 2px dashed var(--border);
      border-radius: 25px; padding: 4rem 2rem; margin: 2rem 0;
    }
    .file-input { display: none; }
    .file-label {
      display: block; padding: 1rem 2rem; background: var(--primary); border-radius: 25px;
      color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 1rem;
    }
    .file-label:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3); }
    .file-label.disabled {
      background: #ccc; cursor: not-allowed; transform: none; box-shadow: none;
    }
    .preview-area {
      margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;
    }
    .preview-container {
      position: relative; display: inline-block;
    }
    .preview-image {
      width: 120px; height: 120px; object-fit: cover; border-radius: 15px;
      border: 2px solid var(--primary); position: relative;
    }
    .remove-image {
      position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border: none;
      border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 12px;
      display: flex; align-items: center; justify-content: center;
    }
    
    /* Enhanced Closet Components */
    .closet-container {
      display: none; background: var(--background); border-radius: 25px; margin: 2rem 0;
      border: 2px solid var(--border); overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    .closet-header {
      background: linear-gradient(135deg, var(--primary), #1d4ed8); padding: 1.5rem 2rem;
      color: white; display: flex; align-items: center; gap: 1rem;
    }
    .closet-stats {
      background: rgba(255, 255, 255, 0.1); padding: 1rem 2rem; display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; text-align: center;
    }
    .closet-stat { color: white; }
    .closet-stat-number { font-size: 1.5rem; font-weight: 700; display: block; }
    .closet-tabs {
      display: flex; background: #f8fafc; border-bottom: 1px solid var(--border); overflow-x: auto;
    }
    .closet-tab {
      padding: 1rem 2rem; background: transparent; border: none; cursor: pointer; font-weight: 600;
      color: #000000; opacity: 0.7; transition: all 0.3s ease; white-space: nowrap;
      border-bottom: 3px solid transparent; display: flex; align-items: center; gap: 0.5rem;
    }
    .closet-tab.active {
      background: var(--background); color: var(--primary); opacity: 1; border-bottom-color: var(--primary);
    }
    .closet-content { padding: 2rem; min-height: 300px; }
    
    /* Subcategory Sections */
    .subcategory-section {
      margin-bottom: 2rem; padding: 1.5rem; background: rgba(59, 130, 246, 0.02);
      border-radius: 15px; border: 1px solid var(--border);
    }
    .subcategory-title {
      display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;
      font-size: 1.1rem; font-weight: 600; color: #000000;
    }
    .subcategory-icon {
      font-size: 1.2rem; width: 35px; height: 35px; display: flex; align-items: center;
      justify-content: center; background: var(--primary); color: white; border-radius: 8px;
    }
    .subcategory-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 1rem;
    }
    .subcategory-item {
      background: var(--background); border: 2px solid var(--border); border-radius: 12px;
      padding: 1rem; text-align: center; transition: all 0.3s ease; cursor: pointer;
      min-height: 100px; display: flex; flex-direction: column; justify-content: center;
    }
    .subcategory-item:hover {
      border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .subcategory-item.has-items {
      border-color: var(--success); background: rgba(16, 185, 129, 0.05);
    }
    .subcategory-count {
      font-weight: 600; color: var(--primary); font-size: 0.9rem; margin-top: 0.5rem;
    }
    
    /* Closet Selection */
    .closet-selection {
      background: rgba(16, 185, 129, 0.05); border: 2px solid rgba(16, 185, 129, 0.2);
      border-radius: 20px; padding: 2rem; margin: 2rem 0;
    }
    .closet-item {
      background: var(--background); border: 2px solid var(--border); border-radius: 15px;
      padding: 1rem; margin: 0.5rem; cursor: pointer; transition: all 0.3s ease;
      display: inline-block; position: relative;
    }
    .closet-item:hover { border-color: var(--success); transform: translateY(-2px); }
    .closet-item.selected {
      border-color: var(--success); background: rgba(16, 185, 129, 0.1);
      box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
    }
    .closet-item img {
      width: 80px; height: 80px; object-fit: cover; border-radius: 10px;
    }
    .selection-badge {
      position: absolute; top: -8px; right: -8px; background: var(--success);
      color: white; border-radius: 50%; width: 24px; height: 24px;
      display: flex; align-items: center; justify-content: center; font-weight: bold;
    }
    
    /* Counters and Stats */
    .counter-display {
      background: rgba(59, 130, 246, 0.1); border-radius: 15px; padding: 1rem;
      margin: 1rem 0; text-align: center; font-weight: 600;
    }
    .counter-item {
      display: inline-block; margin: 0 1rem; padding: 0.5rem 1rem;
      background: var(--background); border-radius: 10px; border: 1px solid var(--border);
    }
    .counter-warning {
      background: rgba(239, 68, 68, 0.1); border-color: var(--error); color: var(--error);
    }
    .counter-success {
      background: rgba(16, 185, 129, 0.1); border-color: var(--success); color: var(--success);
    }
    
    .closet-remaining {
      background: rgba(16, 185, 129, 0.1); border-radius: 15px; padding: 1rem;
      margin: 1rem 0; text-align: center; font-weight: 600; color: var(--success);
      font-size: 1.2rem;
    }
    
    /* Combinations Display */
    .combinations-info {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
      border-radius: 15px; padding: 1.5rem; margin: 1rem 0; text-align: center;
    }
    .combinations-formula {
      font-size: 1.2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem;
    }
    .combinations-result {
      font-size: 1rem; color: #000000; opacity: 0.8;
    }
    
    /* Impact Bars */
    .impact-bar {
      height: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; overflow: hidden; margin-bottom: 0.5rem;
    }
    .impact-fill {
      height: 100%; background: linear-gradient(135deg, var(--primary), #1d4ed8); border-radius: 10px;
      transition: width 2s ease; width: 0%;
    }
    .impact-fill[data-width="85"] { width: 85%; }
    .impact-fill[data-width="72"] { width: 72%; }
    .impact-fill[data-width="68"] { width: 68%; }
    .impact-fill[data-width="63"] { width: 63%; }
    
    /* Notifications */
    .notification {
      position: fixed; top: 20px; right: 20px; padding: 1rem 2rem; border-radius: 15px; color: white;
      font-weight: 600; z-index: 10000; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      animation: slideInRight 0.3s ease;
    }
    .notification.success { background: linear-gradient(135deg, #10b981, #059669); }
    .notification.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .notification.info { background: linear-gradient(135deg, var(--primary), #1d4ed8); }
    
    /* Enhanced Modal */
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5);
      z-index: 10000; display: none; align-items: center; justify-content: center;
      backdrop-filter: blur(5px); animation: fadeIn 0.3s ease;
    }
    .modal {
      background: var(--background); border-radius: 20px; padding: 2rem; max-width: 400px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: scaleIn 0.3s ease;
    }
    .modal h3 { margin-bottom: 1rem; color: #000000; text-align: center; }
    .modal p { margin-bottom: 2rem; color: var(--text-secondary); text-align: center; }
    .modal-actions { display: flex; gap: 1rem; justify-content: center; }
    
    /* Category Error Modal */
    .category-error-modal {
      background: var(--background); border-radius: 20px; padding: 2rem; max-width: 450px; width: 90%;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3); animation: scaleIn 0.3s ease;
    }
    .category-error-modal .error-icon {
      font-size: 3rem; color: var(--error); text-align: center; margin-bottom: 1rem;
    }
    .category-error-modal h3 {
      color: var(--error); text-align: center; margin-bottom: 1rem;
    }
    .category-error-modal p {
      text-align: center; margin-bottom: 1.5rem; line-height: 1.6;
    }
    .category-error-modal .error-details {
      background: rgba(239, 68, 68, 0.1); padding: 1rem; border-radius: 10px; margin-bottom: 1.5rem;
      border-left: 4px solid var(--error);
    }
    
    /* Mode Indicator */
    .mode-indicator {
      position: fixed; top: 100px; right: 20px; background: var(--primary); color: white;
      padding: 0.5rem 1rem; border-radius: 25px; font-size: 0.8rem; font-weight: 600; z-index: 1000;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); display: none;
    }
    .mode-indicator.closet { background: var(--gold); color: #000000; }
    
    /* Animations */
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading {
      display: inline-block; width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%; border-top-color: #ffffff; animation: spin 1s ease-in-out infinite;
    }
    
    /* Utility Classes */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mb-2 { margin-bottom: 2rem; }
    .mt-2 { margin-top: 2rem; }
    
    /* Responsive - CORRECCI√ìN M√ìVIL COMPLETA */
    @media (max-width: 768px) {
      .nav-pills { display: none; }
      .logo { font-size: 2rem; }
      .section { padding: 4rem 3%; }
      .form-options { grid-template-columns: 1fr; }
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
      .grid-5 { grid-template-columns: repeat(2, 1fr); }
      .subcategory-grid { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }
      .hero { padding: 4rem 1rem 2rem; }
      .hero h1 { font-size: clamp(1.8rem, 8vw, 2.5rem); }
      .card { padding: 2rem 1rem; }
      .card-compact { padding: 1.5rem 1rem; }
      .modal { width: 95%; padding: 1.5rem; }
      .category-error-modal { width: 95%; padding: 1.5rem; }
      .closet-tabs { 
        overflow-x: auto; 
        -webkit-overflow-scrolling: touch;
        scroll-behavior: smooth;
      }
      .closet-tab {
        min-width: 150px;
        padding: 0.8rem 1rem;
      }
      .preview-image {
        width: 100px; height: 100px;
      }
      .btn {
        padding: 1rem 2rem;
        font-size: 1rem;
      }
      .section-title h2 {
        font-size: 2rem;
      }
      .section-subtitle {
        font-size: 1rem;
      }
    }
    @media (max-width: 480px) {
      .grid-5 { grid-template-columns: 1fr; }
      .subcategory-grid { grid-template-columns: 1fr; }
      .hero { padding: 3rem 1rem 2rem; }
      .section { padding: 3rem 2%; }
      .card { padding: 1.5rem 1rem; }
      .closet-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>

<body>
  <!-- Templates -->
  <template id="stat-item-tpl">
    <div class="card card-compact">
      <span class="card-number"></span>
      <span class="card-desc"></span>
    </div>
  </template>
  
  <template id="impact-item-tpl">
    <div class="impact-item">
      <div class="impact-label">
        <span class="impact-title"></span>
        <span class="impact-percent"></span>
      </div>
      <div class="impact-bar">
        <div class="impact-fill"></div>
      </div>
      <p class="impact-desc"></p>
    </div>
  </template>
  
  <template id="pricing-card-tpl">
    <div class="card">
      <div class="card-icon"></div>
      <h3 class="card-title"></h3>
      <div class="pricing-price"></div>
      <div class="pricing-period"></div>
      <ul class="pricing-features"></ul>
      <button class="pricing-btn"></button>
    </div>
  </template>

  <!-- Logout Modal -->
  <div id="logoutModal" class="modal-overlay">
    <div class="modal">
      <h3>¬øCerrar sesi√≥n?</h3>
      <p>¬øEst√°s seguro que deseas salir de tu cuenta?</p>
      <div class="modal-actions">
        <button class="btn btn-secondary" onclick="closeLogoutModal()">Cancelar</button>
        <button class="btn btn-danger" onclick="confirmLogout()">Salir</button>
      </div>
    </div>
  </div>

  <!-- Category Error Modal -->
  <div id="categoryErrorModal" class="modal-overlay">
    <div class="category-error-modal">
      <div class="error-icon">‚ùå</div>
      <h3>Error de Categor√≠a</h3>
      <p id="categoryErrorMessage">Has subido una prenda en la categor√≠a incorrecta.</p>
      <div class="error-details" id="categoryErrorDetails"></div>
      <div class="modal-actions">
        <button class="btn btn-primary" onclick="closeCategoryErrorModal()">Entendido</button>
      </div>
    </div>
  </div>

  <header>
    <nav>
      <div class="logo">
        <span class="logo-no">No</span><span class="logo-shop">shop</span><span class="logo-i">i</span><span class="logo-a">A</span>
      </div>
      
      <div style="display: flex; align-items: center;">
        <div class="nav-pills">
          <a href="#inicio" class="nav-pill active" data-section="inicio">üè† Inicio</a>
          <a href="#impacto" class="nav-pill" data-section="impacto">üåç Impacto</a>
          <a href="#precios" class="nav-pill" data-section="precios">$ Precios</a>
          <a href="#funcionamiento" class="nav-pill" data-section="funcionamiento">‚öôÔ∏è C√≥mo funciona</a>
          <a href="#equipo" class="nav-pill" data-section="equipo">üë• Equipo</a>
        </div>
        
        <div class="auth-container">
          <div id="g_id_onload"
               data-client_id="326940877598-ko13n1qcqkkugkoo6gu2n1avs46al09p.apps.googleusercontent.com"
               data-context="signin"
               data-ux_mode="popup"
               data-callback="handleCredentialResponse"
               data-auto_prompt="false">
          </div>
          
          <div id="googleSignInBtn" class="g_id_signin" 
               data-type="standard"
               data-shape="pill"
               data-theme="outline"
               data-text="signin_with"
               data-size="large"
               data-logo_alignment="left">
          </div>
          
          <div class="user-info" id="userInfo" style="display: none;">
            <img class="user-avatar" id="userAvatar" alt="Usuario" style="width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--primary);"/>
            <span id="userName" style="color: #000000;"></span>
            <button onclick="showLogoutModal()" class="btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Salir</button>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <div id="modeIndicator" class="mode-indicator">Modo no seleccionado</div>

  <!-- Hero Section -->
  <section id="inicio" class="hero">
    <div style="max-width: 900px;">
      <span style="font-size: 4rem; margin-bottom: 1rem; display: block;">üö´üõçÔ∏èüëï</span>
      <h1>Reutiliza tu ropa con IA y minimiza tu Impacto Ambiental</h1>
      <p class="hero-subtitle">¬øTardas mucho eligiendo qu√© ponerte cada ma√±ana?</p>
      <p style="font-size: 1.1rem; color: #000000; opacity: 0.8; margin-bottom: 3rem; max-width: 700px; margin-left: auto; margin-right: auto;">
        Descubre combinaciones √∫nicas con tu ropa actual gracias a nuestra inteligencia artificial. Sin estr√©s, sin p√©rdida de tiempo, solo outfits perfectos que cuidan el planeta.
      </p>
      
      <div id="heroGoogleAuth" style="display: flex; justify-content: center; margin-bottom: 2rem;">
        <div class="g_id_signin" 
             data-type="standard"
             data-shape="pill"
             data-theme="filled_blue"
             data-text="signin_with"
             data-size="large"
             data-logo_alignment="left">
        </div>
      </div>
      
      <div class="grid grid-3 mt-2" id="heroStats" style="max-width: 800px;"></div>
    </div>
  </section>

  <!-- Impact Section -->
  <section id="impacto" class="section">
    <div class="container">
      <div class="section-title">
        <h2>üåç Impacto Ambiental</h2>
        <p class="section-subtitle">La industria de la moda es una de las m√°s contaminantes del planeta. Reutilizar tu ropa tiene un impacto positivo inmediato.</p>
      </div>
      <div id="impactBars" style="max-width: 800px; margin: 0 auto;"></div>
    </div>
  </section>

  <!-- Pricing Section -->
  <section id="precios" class="section" style="background: rgba(249, 250, 251, 0.5);">
    <div class="container">
      <div class="section-title">
        <h2>$ Precios Simples y Claros</h2>
        <p class="section-subtitle">Elige el plan que mejor se adapte a tu estilo de vida</p>
      </div>
      <div class="grid grid-2 mt-2" id="pricingCards" style="max-width: 800px; margin: 0 auto;"></div>
    </div>
  </section>

  <!-- How it Works Section -->
  <section id="funcionamiento" class="section">
    <div class="container">
      <div class="section-title">
        <h2>‚öôÔ∏è C√≥mo Funciona</h2>
        <p class="section-subtitle">Descubre combinaciones √∫nicas con tu ropa actual en solo tres simples pasos</p>
      </div>
      <div class="grid grid-3 mt-2" id="featuresGrid"></div>
    </div>
  </section>

  <!-- Upload Section -->
  <section id="upload" class="section" style="background: rgba(249, 250, 251, 0.5);">
    <div class="container">
      <div class="section-title">
        <h2>‚ú® Tu Guardarropa Digital Personalizado</h2>
        <p class="section-subtitle">Sube fotos de la ropa que ya tienes y descubre combinaciones incre√≠bles</p>
      </div>

      <!-- Welcome Section -->
      <div id="welcomeSection" class="form-section" style="display: none; background: rgba(34, 197, 94, 0.05); border-color: rgba(34, 197, 94, 0.2);">
        <h3 class="text-center mb-2">üéâ ¬°Bienvenido a NoshopiA!</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Tu perfil ha sido creado exitosamente. Para darte mejores recomendaciones, necesitamos conocerte un poco m√°s.</p>
        <div class="closet-stats">
          <div class="closet-stat"><span class="closet-stat-number" id="visitCounter">1</span><span>Visitas</span></div>
          <div class="closet-stat"><span class="closet-stat-number" id="recommendationCounter">0</span><span>Recomendaciones</span></div>
          <div class="closet-stat"><span class="closet-stat-number" id="outfitCounter">0</span><span>Outfits Guardados</span></div>
        </div>
      </div>

      <!-- Profile Form -->
      <div id="profileForm" class="form-section hidden">
        <h3 class="text-center mb-2">üë§ Completa tu Perfil (Solo una vez)</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Para personalizar mejor tus recomendaciones futuras</p>
        
        <div style="max-width: 600px; margin: 0 auto;">
          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Color de piel:</label>
            <div class="form-options" id="skinColorOptions"></div>
          </div>
          
          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Rango de edad:</label>
            <div class="form-options" id="ageRangeOptions"></div>
          </div>
          
          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">G√©nero:</label>
            <div class="form-options" id="genderOptions"></div>
          </div>
        </div>
        
        <div class="text-center mt-2">
          <button id="createProfileBtn" class="btn btn-primary" onclick="submitUserProfile()" disabled style="opacity: 0.6;">
            <i class="fas fa-user-plus"></i>
            Selecciona todas las opciones
          </button>
        </div>
      </div>

      <!-- Mode Selector -->
      <div id="closetQuestion" class="form-section hidden">
        <h3 class="text-center mb-2">üëó ¬øC√≥mo quieres usar NoshopiA?</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Elige la forma que mejor se adapte a tu estilo</p>
        
        <div class="grid grid-2">
          <div class="card card-compact" onclick="enableCloset()" style="cursor: pointer;">
            <div class="card-icon">üì¶</div>
            <h4 class="card-title">Mi Closet Digital</h4>
            <p style="opacity: 0.7; font-size: 0.9rem;">Guarda hasta 15 prendas, organiza por categor√≠as y guarda tus outfits favoritos</p>
          </div>
          
          <div class="card card-compact" onclick="useDirectMode()" style="cursor: pointer;">
            <div class="card-icon">‚ö°</div>
            <h4 class="card-title">Recomendaciones R√°pidas</h4>
            <p style="opacity: 0.7; font-size: 0.9rem;">Sube fotos directamente y obt√©n recomendaciones instant√°neas (m√°x: 3-3-5)</p>
          </div>
        </div>
      </div>

      <!-- Closet Container -->
      <div id="closetContainer" class="closet-container">
        <div class="closet-header">
          <i class="fas fa-folder-open" style="font-size: 1.5rem;"></i>
          <div><h2>Mi Closet Digital</h2><span id="userEmail" style="opacity: 0.8; font-size: 0.9rem;"></span></div>
        </div>
        
        <div class="closet-stats">
          <div class="closet-stat"><span class="closet-stat-number" id="closetVisits">1</span><span>Visitas</span></div>
          <div class="closet-stat"><span class="closet-stat-number" id="closetRecommendations">0</span><span>Recomendaciones</span></div>
          <div class="closet-stat"><span class="closet-stat-number" id="closetOutfits">0</span><span>Outfits Guardados</span></div>
        </div>
        
        <div id="closetRemaining" class="closet-remaining hidden">
          <span id="closetRemainingText">Te quedan 15 prendas por subir</span>
        </div>
        
        <div class="closet-tabs">
          <button class="closet-tab active" data-tab="superiores"><i class="fas fa-tshirt"></i> Superiores</button>
          <button class="closet-tab" data-tab="inferiores"><i class="fas fa-user-tie"></i> Inferiores</button>
          <button class="closet-tab" data-tab="calzado"><i class="fas fa-shoe-prints"></i> Calzado</button>
          <button class="closet-tab" data-tab="favoritas"><i class="fas fa-star"></i> Mis Favoritas</button>
        </div>

        <div class="closet-content">
          <div id="superiores" class="closet-tab-content">
            <h3 class="mb-2">üî∏ Prendas Superiores</h3>
            <div id="superioresSubcategories"></div>
          </div>
          <div id="inferiores" class="closet-tab-content hidden">
            <h3 class="mb-2">üî∏ Prendas Inferiores</h3>
            <div id="inferioresSubcategories"></div>
          </div>
          <div id="calzado" class="closet-tab-content hidden">
            <h3 class="mb-2">üî∏ Calzado</h3>
            <div id="calzadoSubcategories"></div>
          </div>
          <div id="favoritas" class="closet-tab-content hidden">
            <h3 class="mb-2">‚≠ê Mis Recomendaciones Favoritas</h3>
            <div id="savedRecommendationsList" class="text-center" style="opacity: 0.7; padding: 2rem;">
              <div class="card">
                <i class="fas fa-heart" style="font-size: 3rem; color: var(--gold); margin-bottom: 1rem;"></i>
                <h4>A√∫n no tienes favoritos</h4>
                <p>Aqu√≠ aparecer√°n las combinaciones que guardes como favoritas</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Closet Selection (for closet mode) -->
      <div id="closetSelection" class="closet-selection hidden">
        <h3 class="text-center mb-2">üì¶ Selecciona las prendas que quieres usar</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">De tu closet digital, elige las prendas para generar recomendaciones</p>
        
        <div id="closetItemsDisplay">
          <div class="mb-2">
            <h4>üëï Superiores disponibles:</h4>
            <div id="closetTopsSelection"></div>
          </div>
          <div class="mb-2">
            <h4>üëñ Inferiores disponibles:</h4>
            <div id="closetBottomsSelection"></div>
          </div>
          <div class="mb-2">
            <h4>üë† Calzado disponible:</h4>
            <div id="closetShoesSelection"></div>
          </div>
        </div>
      </div>

      <!-- Occasion Selector -->
      <div id="occasionSelector" class="form-section hidden">
        <h3 class="text-center mb-2">¬øQu√© planes tienes para esta ocasi√≥n?</h3>
        <div class="grid grid-5" id="occasionGrid"></div>
      </div>

      <!-- Upload Area -->
      <div class="upload-area hidden" id="uploadArea">
        <div id="directModeCounters" class="counter-display hidden">
          <div class="counter-item" id="topsCounter">Superiores: 0/3</div>
          <div class="counter-item" id="bottomsCounter">Inferiores: 0/3</div>
          <div class="counter-item" id="shoesCounter">Zapatos: 0/5</div>
        </div>

        <div class="grid grid-3" id="uploadGrid"></div>

        <div id="combinationsDisplay" class="combinations-info hidden">
          <div class="combinations-formula" id="combinationsFormula">1 √ó 1 √ó 1 = 1 combinaci√≥n posible</div>
          <div class="combinations-result" id="combinationsResult">Se mostrar√°n 1 recomendaci√≥n</div>
        </div>

        <div class="card mt-2" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(34, 197, 94, 0.05));">
          <h3 class="mb-2">üöÄ ¬°Genera tus Recomendaciones!</h3>
          <p class="mb-2" style="opacity: 0.8;">Nuestra IA analizar√° todas las combinaciones posibles</p>
          <div class="notification info hidden" id="processingTimer">‚è±Ô∏è Procesando... <span id="timerDisplay">0.0s</span></div>
          <button class="btn btn-success mt-2" onclick="getRecommendation()" id="generateBtn" disabled>
            <i class="fas fa-magic"></i>Sube fotos de cada categor√≠a para continuar
          </button>
        </div>

        <div id="result" class="hidden mt-2"></div>
      </div>
    </div>
  </section>

  <!-- Team Section -->
  <section id="equipo" class="section">
    <div class="container">
      <div class="section-title">
        <h2>üë• Nuestro Equipo</h2>
        <p class="section-subtitle">Conoce a las personas detr√°s de NoshopiA</p>
      </div>
      <div class="grid grid-2 mt-2" id="teamGrid"></div>
    </div>
  </section>

  <!-- Footer CTA -->
  <section class="section" style="background: rgba(59, 130, 246, 0.05);">
    <div class="container">
      <div class="section-title">
        <h3>üöÄ ¬°Comienza Ahora!</h3>
        <p class="section-subtitle">√önete a miles de personas que ya est√°n revolucionando su estilo de manera sostenible</p>
      </div>
      <div class="grid grid-2 mt-2" style="max-width: 600px; margin: 0 auto;">
        <div class="card card-compact">
          <div style="font-size: 4rem; margin-bottom: 1rem; color: var(--success);">üéÅ</div>
          <h4 style="font-weight: 700; font-size: 1.5rem;">Gratis</h4>
          <p style="opacity: 0.7;">Sin costo inicial</p>
        </div>
        <div class="card card-compact">
          <div style="font-size: 4rem; margin-bottom: 1rem; color: var(--primary);">‚ö°</div>
          <h4 style="font-weight: 700; font-size: 1.5rem;">Instant√°neo</h4>
          <p style="opacity: 0.7;">Resultados en 10 segundos</p>
        </div>
      </div>
    </div>
  </section>

  <footer class="section" style="border-top: 1px solid var(--border);">
    <div class="container">
      <div class="grid grid-2" style="align-items: start; text-align: left;">
        <div>
          <h3><span class="logo-no">No</span><span class="logo-shop">shop</span><span class="logo-i">i</span><span class="logo-a">A</span></h3>
          <p>Maximiza tu ropa, minimiza tu impacto ambiental con IA.</p>
        </div>
        <div>
          <h3>Enlaces R√°pidos</h3>
          <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            <a href="#inicio" data-section="inicio" style="color: inherit; text-decoration: none; opacity: 0.7;">Inicio</a>
            <a href="#impacto" data-section="impacto" style="color: inherit; text-decoration: none; opacity: 0.7;">Impacto Ambiental</a>
            <a href="#precios" data-section="precios" style="color: inherit; text-decoration: none; opacity: 0.7;">Precios</a>
            <a href="#funcionamiento" data-section="funcionamiento" style="color: inherit; text-decoration: none; opacity: 0.7;">C√≥mo Funciona</a>
            <a href="#equipo" data-section="equipo" style="color: inherit; text-decoration: none; opacity: 0.7;">Nuestro Equipo</a>
          </div>
        </div>
      </div>
      <div style="padding-top: 2rem; border-top: 1px solid var(--border); text-align: center; opacity: 0.7;">
        <p>&copy; 2024 NoshopiA. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <script>
    // ============================================
    // CONFIGURACI√ìN Y VARIABLES GLOBALES - CORREGIDAS
    // ============================================
    const CONFIG = {
      GOOGLE_CLIENT_ID: "326940877598-ko13n1qcqkkugkoo6gu2n1avs46al09p.apps.googleusercontent.com",
      DIRECT_MODE_LIMITS: { tops: 3, bottoms: 3, shoes: 5 },
      CLOSET_MAX_TOTAL: 15,
      OCCASIONS: ['casual', 'oficina', 'deportivo', 'formal', 'matrimonio'],
      BACKEND_URL: 'https://noshopia-production.up.railway.app'
    };

    // CORRECCI√ìN CR√çTICA: Declarar todas las variables globales
    let isLoggedIn = false, currentUser = null, closetMode = false, selectedOccasion = '';
    let userProfile = null; // ‚úÖ VARIABLE FALTANTE DECLARADA
    let uploadedFiles = { tops: [], bottoms: [], shoes: [] };
    let uploadedImages = { tops: [], bottoms: [], shoes: [] };
    let closetItems = { tops: [], bottoms: [], shoes: [] };
    let selectedClosetItems = { tops: [], bottoms: [], shoes: [] };
    let savedRecommendations = [];

    // ============================================
    // VALIDACI√ìN DE CATEGOR√çAS
    // ============================================
    const CATEGORY_KEYWORDS = {
      tops: ['camisa', 'blusa', 'polera', 'camiseta', 'sweater', 'sueter', 'chaqueta', 'blazer', 'casaca', 'top', 'shirt', 't-shirt', 'blouse', 'jacket', 'coat', 'hoodie', 'pullover'],
      bottoms: ['pantalon', 'jean', 'falda', 'short', 'vestido', 'calza', 'legging', 'bermuda', 'pants', 'jeans', 'skirt', 'dress', 'shorts', 'trousers'],
      shoes: ['zapato', 'zapatilla', 'bota', 'sandalia', 'taco', 'stiletto', 'sneaker', 'shoe', 'boot', 'sandal', 'heel', 'flat', 'loafer', 'oxford']
    };

    function validateFileCategory(file, expectedCategory) {
      const fileName = file.name.toLowerCase();
      const fileType = file.type.toLowerCase();
      
      if (!fileType.includes('image/')) {
        return {
          valid: false,
          error: 'El archivo debe ser una imagen (JPG, PNG, etc.)',
          details: `Tipo de archivo detectado: ${file.type}`
        };
      }
      
      const expectedKeywords = CATEGORY_KEYWORDS[expectedCategory] || [];
      const allOtherKeywords = Object.entries(CATEGORY_KEYWORDS)
        .filter(([cat]) => cat !== expectedCategory)
        .flatMap(([cat, keywords]) => keywords.map(kw => ({word: kw, category: cat})));
      
      const wrongKeyword = allOtherKeywords.find(({word}) => fileName.includes(word));
      
      if (wrongKeyword) {
        const categoryNames = {
          tops: 'Prendas Superiores',
          bottoms: 'Prendas Inferiores',
          shoes: 'Calzado'
        };
        
        return {
          valid: false,
          error: `Categor√≠a incorrecta detectada`,
          details: `Has subido "${fileName}" en "${categoryNames[expectedCategory]}" pero parece ser "${categoryNames[wrongKeyword.category]}". Palabra detectada: "${wrongKeyword.word}"`,
          suggestedCategory: wrongKeyword.category
        };
      }
      
      return { valid: true };
    }

    function showCategoryError(validationResult, expectedCategory, fileName) {
      const categoryNames = {
        tops: 'Prendas Superiores',
        bottoms: 'Prendas Inferiores', 
        shoes: 'Calzado'
      };
      
      const modal = document.getElementById('categoryErrorModal');
      const message = document.getElementById('categoryErrorMessage');
      const details = document.getElementById('categoryErrorDetails');
      
      message.textContent = validationResult.error;
      details.innerHTML = `
        <strong>Archivo:</strong> ${fileName}<br>
        <strong>Categor√≠a seleccionada:</strong> ${categoryNames[expectedCategory]}<br>
        <strong>Problema:</strong> ${validationResult.details}
        ${validationResult.suggestedCategory ? `<br><strong>Sugerencia:</strong> Sube este archivo en "${categoryNames[validationResult.suggestedCategory]}"` : ''}
      `;
      
      modal.style.display = 'flex';
    }

    window.closeCategoryErrorModal = function() {
      document.getElementById('categoryErrorModal').style.display = 'none';
    };

    // ============================================
    // GOOGLE AUTH - CALLBACK CORREGIDO
    // ============================================
    window.handleCredentialResponse = function(response) {
      try {
        console.log('üîê Google Auth callback received:', response);
        
        const responsePayload = decodeJwtResponse(response.credential);
        console.log('üë§ Decoded user data:', responsePayload);
        
        currentUser = {
          email: responsePayload.email,
          name: responsePayload.name,
          picture: responsePayload.picture,
          sub: responsePayload.sub
        };
        
        isLoggedIn = true;
        updateAuthUI();
        
        const existingProfile = localStorage.getItem(`noshopia_profile_${currentUser.email}`);
        
        if (existingProfile) {
          // CORRECCI√ìN CR√çTICA: userProfile ahora est√° declarada
          userProfile = JSON.parse(existingProfile);
          console.log('üë• Usuario existente detectado, perfil cargado:', userProfile);
          showNotification('¬°Bienvenido de vuelta!', 'success');
          showModeSelector();
        } else {
          console.log('üÜï Usuario nuevo, mostrando formulario de perfil');
          document.getElementById('welcomeSection').style.display = 'block';
          document.getElementById('profileForm').classList.remove('hidden');
          document.getElementById('profileForm').scrollIntoView({ behavior: 'smooth', block: 'center' });
          showNotification('¬°Bienvenido a NoShopiA! Completa tu perfil', 'success');
        }
        
        loadUserClosetData();
        
      } catch (error) {
        console.error('‚ùå Error processing Google Auth:', error);
        showNotification('Error en autenticaci√≥n. Intenta nuevamente.', 'error');
      }
    };

    function decodeJwtResponse(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // ============================================
    // MODAL FUNCTIONS
    // ============================================
    window.showLogoutModal = function() {
      document.getElementById('logoutModal').style.display = 'flex';
    };

    window.closeLogoutModal = function() {
      document.getElementById('logoutModal').style.display = 'none';
    };

    window.confirmLogout = function() {
      closeLogoutModal();
      logout();
    };

    // ============================================
    // FUNCIONES DE FLUJO PRINCIPALES - CORREGIDAS
    // ============================================
    window.showModeSelector = function() {
      console.log('üéØ Showing mode selector...');
      
      // Ocultar secciones anteriores
      document.getElementById('welcomeSection').style.display = 'none';
      document.getElementById('profileForm').classList.add('hidden');
      
      // Mostrar selector de modo
      const selector = document.getElementById('closetQuestion');
      if (selector) {
        selector.classList.remove('hidden');
        selector.scrollIntoView({ behavior: 'smooth', block: 'center' });
        showNotification('Elige tu modo preferido para las recomendaciones', 'info');
      } else {
        console.error('‚ùå ERROR: Elemento #closetQuestion no encontrado');
      }
    };

    window.enableCloset = function() {
      console.log('üì¶ Usuario eligi√≥: Modo Closet');
      closetMode = true;
      updateModeIndicator('Modo Closet Digital (m√°x 15 prendas)', true);
      
      // Ocultar/mostrar elementos correctos - con verificaciones
      const closetQuestion = document.getElementById('closetQuestion');
      const closetContainer = document.getElementById('closetContainer');
      const occasionSelector = document.getElementById('occasionSelector');
      const closetSelection = document.getElementById('closetSelection');
      const uploadArea = document.getElementById('uploadArea');
      
      if (closetQuestion) closetQuestion.classList.add('hidden');
      if (closetContainer) {
        closetContainer.style.display = 'block';
        closetContainer.classList.remove('hidden');
      }
      if (occasionSelector) occasionSelector.classList.add('hidden');
      if (closetSelection) closetSelection.classList.add('hidden');
      if (uploadArea) uploadArea.classList.add('hidden');
      
      // Configurar closet
      if (currentUser?.email) {
        const userEmailEl = document.getElementById('userEmail');
        if (userEmailEl) userEmailEl.textContent = currentUser.email;
      }
      
      const closetRemaining = document.getElementById('closetRemaining');
      if (closetRemaining) closetRemaining.classList.remove('hidden');
      
      updateClosetRemaining();
      renderSubcategories();
      loadUserClosetData();
      
      showNotification('Modo Closet activado - Sube prendas usando las pesta√±as', 'success');
      
      // Activar tab inicial
      setTimeout(() => {
        const firstTab = document.querySelector('.closet-tab[data-tab="superiores"]');
        if (firstTab) firstTab.click();
      }, 100);
    };

    window.useDirectMode = function() {
      console.log('‚ö° Usuario eligi√≥: Modo Recomendaciones Directas');
      closetMode = false;
      updateModeIndicator('Modo Recomendaciones R√°pidas (3-3-5)', false);
      
      // Ocultar/mostrar elementos correctos - con verificaciones
      const closetQuestion = document.getElementById('closetQuestion');
      const closetContainer = document.getElementById('closetContainer');
      const occasionSelector = document.getElementById('occasionSelector');
      const uploadArea = document.getElementById('uploadArea');
      const directModeCounters = document.getElementById('directModeCounters');
      
      if (closetQuestion) closetQuestion.classList.add('hidden');
      if (closetContainer) {
        closetContainer.style.display = 'none';
        closetContainer.classList.add('hidden');
      }
      if (occasionSelector) occasionSelector.classList.remove('hidden');
      if (uploadArea) uploadArea.classList.remove('hidden');
      if (directModeCounters) directModeCounters.classList.remove('hidden');
      
      // Renderizar componentes necesarios
      setTimeout(() => {
        renderOccasions();
        renderUploadArea();
        updateDirectModeCounters();
      }, 100);
      
      showNotification('Modo Recomendaciones Directas activado - L√≠mites: 3-3-5', 'info');
    };

    // ============================================
    // FUNCIONES DE IMAGEN
    // ============================================
    function getImageForCombination(type, item) {
      const images = uploadedImages[type];
      if (!images || images.length === 0) {
        console.warn(`‚ö†Ô∏è No hay im√°genes para tipo: ${type}`);
        return null;
      }
      
      let backendIndex;
      if (type === 'tops' && item.top) {
        backendIndex = item.top.index;
      } else if (type === 'bottoms' && item.bottom) {
        backendIndex = item.bottom.index;
      } else if (type === 'shoes' && item.shoe) {
        backendIndex = item.shoe.index;
      } else {
        console.error(`‚ùå Estructura incorrecta para tipo ${type}:`, item);
        return null;
      }
      
      if (typeof backendIndex === 'number' && backendIndex >= 0 && backendIndex < images.length) {
        return images[backendIndex];
      }
      
      console.error(`‚ùå ${type}: √≠ndice ${backendIndex} inv√°lido, usando primera imagen como fallback`);
      return images[0];
    }

    function renderRecommendations(data) {
      console.log('üöÄ INICIANDO renderRecommendations con datos:', data);
      
      const result = document.getElementById('result');
      if (!result) {
        console.error('‚ùå ERROR CR√çTICO: Elemento #result no encontrado en DOM');
        return;
      }
      
      const results = data.results || [];
      console.log('üìã Procesando', results.length, 'resultados');
      
      if (results.length === 0) {
        console.warn('‚ö†Ô∏è No hay resultados para mostrar');
        result.innerHTML = '<p style="text-align: center; color: #000000; padding: 2rem;">No se encontraron recomendaciones.</p>';
        result.classList.remove('hidden');
        return;
      }
      
      try {
        let bestIndex = 0;
        let highestScore = 0;
        results.forEach((item, index) => {
          const score = item.final_score || 0;
          if (score > highestScore) {
            highestScore = score;
            bestIndex = index;
          }
        });
        
        const occasionText = {
          'oficina': 'Oficina/Trabajo',
          'deportivo': 'Deportes/Gym', 
          'casual': 'Casual',
          'formal': 'Formal',
          'matrimonio': 'Matrimonio'
        };
        
        let html = `
          <div style="text-align: center; margin-bottom: 2rem;">
            <h2 style="color: #000000;">ü™Ñ Recomendaciones para ${occasionText[selectedOccasion] || selectedOccasion}</h2>
            <div style="background: linear-gradient(135deg, var(--primary), #1d4ed8); color: white; border-radius: 15px; padding: 1rem; margin: 1rem 0; display: inline-block;">
              <strong>üìç Ocasi√≥n Actual: ${occasionText[selectedOccasion] || selectedOccasion}</strong>
            </div>
            <p style="color: #000000; opacity: 0.8;">
              ${data.message || `${results.length} combinaciones optimizadas para esta ocasi√≥n`}
            </p>
            <div style="background: rgba(59, 130, 246, 0.1); border-radius: 10px; padding: 1rem; margin: 1rem 0;">
              <strong>Procesamiento:</strong> ${data.processing_stats?.total_time || 'N/A'}
            </div>
          </div>
          <div style="display: grid; gap: 2rem;">
        `;
        
        results.forEach((item, idx) => {
          const scorePercent = Math.round((item.final_score || 0) * 100);
          const isBest = idx === bestIndex;
          
          const topImage = getImageForCombination('tops', item);
          const bottomImage = getImageForCombination('bottoms', item);
          const shoeImage = getImageForCombination('shoes', item);
          
          html += `
            <div style="background: var(--background); border: 2px solid ${isBest ? 'var(--gold)' : 'var(--border)'}; border-radius: 20px; padding: 2rem; position: relative; ${isBest ? 'box-shadow: 0 0 30px rgba(251, 191, 36, 0.3);' : ''}">
              ${isBest ? '<div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: var(--gold); color: #000000; padding: 0.5rem 1.5rem; border-radius: 20px; font-weight: 800; font-size: 0.9rem;">‚≠ê MEJOR PARA ' + (occasionText[selectedOccasion] || selectedOccasion).toUpperCase() + '</div>' : ''}
              
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; ${isBest ? 'margin-top: 1rem;' : ''}">
                <h3 style="color: #000000; margin: 0;">${isBest ? 'üëë' : ''} Combinaci√≥n ${idx + 1}</h3>
                <div style="display: flex; gap: 0.5rem; align-items: center;">
                  <span style="background: rgba(59, 130, 246, 0.1); color: var(--primary); padding: 0.3rem 0.8rem; border-radius: 10px; font-size: 0.8rem; font-weight: 600;">${occasionText[selectedOccasion] || selectedOccasion}</span>
                  <span style="background: ${isBest ? 'var(--gold)' : 'var(--primary)'}; color: ${isBest ? '#000000' : 'white'}; padding: 0.5rem 1rem; border-radius: 15px; font-weight: 700;">${scorePercent}%</span>
                </div>
              </div>
              
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
                <div style="text-align: center;">
                  <div style="font-size: 0.8rem; color: #000000; font-weight: 600; margin-bottom: 0.5rem;">üëï SUPERIOR</div>
                  <div style="background: transparent; border-radius: 20px; padding: 1.5rem; min-height: 240px; display: flex; align-items: center; justify-content: center; margin-bottom: 0.5rem; border: 1px dashed rgba(59, 130, 246, 0.3);">
                    ${topImage ? `<img src="${topImage}" style="max-width: 200px; max-height: 200px; object-fit: contain; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" alt="Superior">` : '<div style="color: #666; font-size: 2rem;">üëï</div>'}
                  </div>
                  <div style="font-size: 0.9rem; color: #000000; opacity: 0.8;">${item.top?.detected_item || 'Superior'}</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 0.8rem; color: #000000; font-weight: 600; margin-bottom: 0.5rem;">üëñ INFERIOR</div>
                  <div style="background: transparent; border-radius: 20px; padding: 1.5rem; min-height: 240px; display: flex; align-items: center; justify-content: center; margin-bottom: 0.5rem; border: 1px dashed rgba(59, 130, 246, 0.3);">
                    ${bottomImage ? `<img src="${bottomImage}" style="max-width: 200px; max-height: 200px; object-fit: contain; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" alt="Inferior">` : '<div style="color: #666; font-size: 2rem;">üëñ</div>'}
                  </div>
                  <div style="font-size: 0.9rem; color: #000000; opacity: 0.8;">${item.bottom?.detected_item || 'Inferior'}</div>
                </div>
                <div style="text-align: center;">
                  <div style="font-size: 0.8rem; color: #000000; font-weight: 600; margin-bottom: 0.5rem;">üë¢ CALZADO</div>
                  <div style="background: transparent; border-radius: 20px; padding: 1.5rem; min-height: 240px; display: flex; align-items: center; justify-content: center; margin-bottom: 0.5rem; border: 1px dashed rgba(59, 130, 246, 0.3);">
                    ${shoeImage ? `<img src="${shoeImage}" style="max-width: 200px; max-height: 200px; object-fit: contain; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);" alt="Calzado">` : '<div style="color: #666; font-size: 2rem;">üë¢</div>'}
                  </div>
                  <div style="font-size: 0.9rem; color: #000000; opacity: 0.8;">${item.shoe?.detected_item || 'Calzado'}</div>
                </div>
              </div>
              
              <div style="background: rgba(59, 130, 246, 0.1); border-radius: 10px; padding: 1rem; text-align: center;">
                <div style="color: #000000; font-weight: 600; margin-bottom: 0.5rem;">
                  ${item.harmony_type || item.scores?.harmony?.type_display || 'Equilibrada'}
                </div>
                <div style="color: #000000; opacity: 0.8; font-size: 0.9rem;">
                  ${item.harmony_description || item.scores?.harmony?.description || 'Combinaci√≥n balanceada'}
                </div>
              </div>
              
              ${closetMode ? `<button onclick="saveRecommendationToCloset(${idx})" style="width: 100%; margin-top: 1rem; padding: 0.8rem; background: var(--success); color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">üíæ Guardar en Mi Closet</button>` : ''}
            </div>
          `;
        });
        
        html += '</div>';
        result.innerHTML = html;
        result.classList.remove('hidden');
        
        window.currentResults = results;
        
        setTimeout(() => {
          result.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
        
        console.log('üéâ renderRecommendations completado exitosamente');
        
      } catch (error) {
        console.error('‚ùå ERROR EN renderRecommendations:', error);
        result.innerHTML = `
          <div style="text-align: center; padding: 2rem; background: rgba(239, 68, 68, 0.1); border-radius: 15px; color: var(--error);">
            <h3>Error al mostrar recomendaciones</h3>
            <p>Error t√©cnico: ${error.message}</p>
            <p>Por favor, intenta nuevamente o contacta soporte.</p>
          </div>
        `;
        result.classList.remove('hidden');
      }
    }

    // ============================================
    // FUNCIONES AUXILIARES NECESARIAS
    // ============================================
    function updateModeIndicator(text, isCloset) {
      const indicator = document.getElementById('modeIndicator');
      indicator.textContent = text;
      indicator.style.display = 'block';
      indicator.classList.toggle('closet', isCloset);
    }

    function updateAuthUI() {
      const googleSignIn = document.getElementById('googleSignInBtn');
      const heroAuth = document.getElementById('heroGoogleAuth');
      const userInfo = document.getElementById('userInfo');
      
      if (isLoggedIn && currentUser) {
        googleSignIn.style.display = 'none';
        heroAuth.style.display = 'none';
        userInfo.style.display = 'flex';
        document.getElementById('userName').textContent = currentUser.name;
        document.getElementById('userAvatar').src = currentUser.picture;
      } else {
        googleSignIn.style.display = 'block';
        heroAuth.style.display = 'flex';
        userInfo.style.display = 'none';
      }
    }

    function logout() {
      isLoggedIn = false; 
      currentUser = null; 
      closetMode = false; 
      selectedOccasion = '';
      userProfile = null; // Limpiar perfil
      uploadedFiles = { tops: [], bottoms: [], shoes: [] };
      uploadedImages = { tops: [], bottoms: [], shoes: [] };
      closetItems = { tops: [], bottoms: [], shoes: [] };
      selectedClosetItems = { tops: [], bottoms: [], shoes: [] };
      savedRecommendations = [];
      
      updateAuthUI();
      
      ['welcomeSection', 'profileForm', 'closetQuestion', 'closetContainer', 'occasionSelector', 'uploadArea'].forEach(id => {
        const element = document.getElementById(id);
        if (element) {
          element.classList.add('hidden');
          if (id === 'closetContainer') element.style.display = 'none';
        }
      });
      
      document.getElementById('modeIndicator').style.display = 'none';
      showNotification('Sesi√≥n cerrada exitosamente', 'info');
      
      if (window.google && google.accounts) {
        google.accounts.id.disableAutoSelect();
      }
    }

    // ============================================
    // PERSISTENCIA DEL CLOSET
    // ============================================
    function saveUserClosetData() {
      if (!currentUser?.email) return;
      const userData = { 
        email: currentUser.email, 
        closetItems, 
        lastUpdated: new Date().toISOString(), 
        totalItems: getTotalClosetItems() 
      };
      localStorage.setItem(`noshopia_closet_${currentUser.email}`, JSON.stringify(userData));
      console.log('üíæ Closet guardado:', userData);
    }

    function loadUserClosetData() {
      if (!currentUser?.email) return;
      const savedData = localStorage.getItem(`noshopia_closet_${currentUser.email}`);
      if (savedData) {
        const userData = JSON.parse(savedData);
        closetItems = userData.closetItems || { tops: [], bottoms: [], shoes: [] };
        console.log('üìÇ Closet cargado:', userData);
        
        if (closetMode) {
          updateClosetRemaining();
          renderSubcategories();
        }
      }
    }

    function getTotalClosetItems() {
      return closetItems.tops.length + closetItems.bottoms.length + closetItems.shoes.length;
    }

    function updateClosetRemaining() {
      if (!closetMode) return;
      
      const total = getTotalClosetItems();
      const remaining = CONFIG.CLOSET_MAX_TOTAL - total;
      const remainingText = document.getElementById('closetRemainingText');
      
      if (remaining <= 0) {
        remainingText.textContent = 'Closet lleno (15/15) - Elimina prendas para subir nuevas';
        remainingText.style.color = 'var(--error)';
      } else {
        remainingText.textContent = `Te quedan ${remaining} prendas por subir (${total}/15)`;
        remainingText.style.color = 'var(--success)';
      }
    }

    // ============================================
    // DATOS DE CONTENIDO
    // ============================================
    const CONTENT_DATA = {
      heroStats: [
        { number: '15min', desc: 'Ahorrados cada ma√±ana' },
        { number: '10s', desc: 'Para generar outfit' },
        { number: '25kg', desc: 'CO‚ÇÇ reducido' }
      ],
      impactItems: [
        { title: 'Reducci√≥n en consumo de agua', percent: '85%', width: '85', desc: 'Cada prenda nueva requiere miles de litros de agua en su producci√≥n.' },
        { title: 'Menos emisiones de CO‚ÇÇ', percent: '72%', width: '72', desc: 'El transporte y manufactura textil son grandes emisores de carbono.' },
        { title: 'Reducci√≥n residuos textiles', percent: '68%', width: '68', desc: 'Millones de toneladas de ropa terminan en vertederos anualmente.' },
        { title: 'Menos uso de qu√≠micos', percent: '63%', width: '63', desc: 'Los tintes y tratamientos textiles contaminan r√≠os y oc√©anos.' }
      ],
      pricingPlans: [
        { icon: 'üéÅ', title: 'Plan Free', price: 'Gratis', period: 'Primer mes completo', features: ['30 combinaciones incluidas', 'An√°lisis b√°sico de IA', '3 prendas superiores', '3 prendas inferiores', '5 zapatos diferentes', 'Recomendaciones instant√°neas', 'Sin compromiso'], btnClass: 'btn-secondary', btnText: 'Empezar Gratis', btnAction: 'startFreePlan()' },
        { icon: '‚≠ê', title: 'Plan Premium', price: '$5,000', period: 'por mes', features: ['Recomendaciones ilimitadas', 'IA avanzada personalizada', 'Prendas ilimitadas', 'Zapatos ilimitados', 'An√°lisis en tiempo real', 'Sugerencias de estilo', 'Soporte prioritario'], btnClass: 'btn-primary', btnText: 'Actualizar a Premium', btnAction: 'upgradeToPremium()', badge: 'M√°s Popular' }
      ],
      features: [
        { icon: 'üì±', title: '1. Sube tus prendas', desc: 'Fotograf√≠a las prendas que quieres incluir: superiores, inferiores y calzado. Nuestra IA analiza cada pieza autom√°ticamente.' },
        { icon: 'ü§ñ', title: '2. IA genera recomendaciones', desc: 'Nuestro algoritmo avanzado analiza colores, estilos, ocasiones y tendencias para crear outfits √∫nicos y balanceados.' },
        { icon: '‚ú®', title: '3. Recibe sugerencias', desc: 'Obt√©n recomendaciones personalizadas rankeadas por score de compatibilidad en menos de 10 segundos.' }
      ],
      team: [
        { name: 'Jos√© Francisco Corti Badia', role: 'Founder & CEO', desc: 'Ingeniero Comercial, Diplomado en GenAI U. De Chile 2025 y Diplomado en AI PUC 2022. Experto en Inteligencia Artificial con m√°s de 15 a√±os creando soluciones tecnol√≥gicas innovadoras en distintas industrias.' },
        { name: 'Paola Andrea Curti Simpson', role: 'Directora Creativa', desc: 'Arquitecta especialista en moda sustentable con amplia experiencia en dise√±o consciente y sostenibilidad. Lidera la visi√≥n creativa y el impacto ambiental de nuestras soluciones.' }
      ],
      profileOptions: {
        skinColor: [
          { value: 'claro', label: 'Claro', display: '<div style="background: #F5DEB3; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>' },
          { value: 'medio', label: 'Medio', display: '<div style="background: #DEB887; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>' },
          { value: 'oscuro', label: 'Oscuro', display: '<div style="background: #8B4513; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>' }
        ],
        ageRange: [
          { value: 'menor_18', label: 'Menor 18', icon: 'fas fa-child' },
          { value: '18-24', label: '18-24', icon: 'fas fa-user-graduate' },
          { value: '25-34', label: '25-34', icon: 'fas fa-user-tie' },
          { value: '35-44', label: '35-44', icon: 'fas fa-user' },
          { value: '45-54', label: '45-54', icon: 'fas fa-user-check' },
          { value: 'mas_54', label: 'M√°s de 54', icon: 'fas fa-user-clock' }
        ],
        gender: [
          { value: 'hombre', label: 'Hombre', icon: 'fas fa-mars' },
          { value: 'mujer', label: 'Mujer', icon: 'fas fa-venus' },
          { value: 'no_binario', label: 'No binario', icon: 'fas fa-genderless' }
        ]
      },
      occasions: [
        { value: 'oficina', label: 'Toca Oficina', icon: 'fas fa-briefcase' },
        { value: 'deportivo', label: 'Deportes/Gym', icon: 'fas fa-dumbbell' },
        { value: 'casual', label: 'Junta casual', icon: 'fas fa-users' },
        { value: 'formal', label: 'Outfit Formal', icon: 'fas fa-black-tie' },
        { value: 'matrimonio', label: 'Matrimonio', icon: 'fas fa-ring' }
      ],
      uploadTypes: [
        { type: 'tops', title: 'Parte Superior', desc: 'Camisas, blusas, su√©teres', icon: 'fas fa-tshirt', label: 'Subir Superiores' },
        { type: 'bottoms', title: 'Parte Inferior', desc: 'Pantalones, faldas, shorts', icon: 'fas fa-user-tie', label: 'Subir Inferiores' },
        { type: 'shoes', title: 'Calzado', desc: 'Zapatos, sneakers, botas', icon: 'fas fa-shoe-prints', label: 'Subir Zapatos' }
      ],
      subcategories: {
        tops: [
          { id: 'camisas', name: 'Camisas', icon: 'üëî', desc: 'Camisas de vestir, casuales, denim' },
          { id: 'blusas', name: 'Blusas', icon: 'üëö', desc: 'Blusas formales, casuales, estampadas' },
          { id: 'sweaters', name: 'Sweaters', icon: 'üß•', desc: 'Su√©teres, cardiganes, hoodies' },
          { id: 'chaquetas', name: 'Chaquetas', icon: 'üè∑Ô∏è', desc: 'Blazers, casacas, chaquetas de cuero' },
          { id: 'poleras', name: 'Poleras', icon: 'üëï', desc: 'Camisetas b√°sicas, con estampados' }
        ],
        bottoms: [
          { id: 'pantalones', name: 'Pantalones', icon: 'üëñ', desc: 'Jeans, de vestir, deportivos' },
          { id: 'shorts', name: 'Shorts', icon: 'ü©≥', desc: 'Bermudas, deportivos, de mezclilla' },
          { id: 'faldas', name: 'Faldas', icon: 'üëó', desc: 'Minifaldas, midi, largas' },
          { id: 'vestidos', name: 'Vestidos', icon: 'üëó', desc: 'Casuales, formales, de noche' },
          { id: 'calzas', name: 'Calzas', icon: 'ü©±', desc: 'Leggings, deportivas, t√©rmicas' }
        ],
        shoes: [
          { id: 'zapatos', name: 'Zapatos', icon: 'üëû', desc: 'Formales, mocasines, con tac√≥n' },
          { id: 'zapatillas', name: 'Zapatillas', icon: 'üëü', desc: 'Deportivas, urbanas, running' },
          { id: 'botas', name: 'Botas', icon: 'ü•æ', desc: 'Botines, de lluvia, militares' },
          { id: 'sandalias', name: 'Sandalias', icon: 'üë°', desc: 'De vestir, deportivas, playeras' },
          { id: 'especiales', name: 'Especiales', icon: '‚öΩ', desc: 'Trabajo, trekking, espec√≠ficos' }
        ]
      }
    };

    // ============================================
    // FUNCIONES DE RENDERIZADO
    // ============================================
    function renderWithTemplate(templateId, container, data, customizer) {
      container.innerHTML = '';
      data.forEach(item => {
        const tpl = document.getElementById(templateId).content.cloneNode(true);
        if (customizer) customizer(tpl, item);
        container.appendChild(tpl);
      });
    }

    function renderHeroStats() {
      const container = document.getElementById('heroStats');
      renderWithTemplate('stat-item-tpl', container, CONTENT_DATA.heroStats, (tpl, item) => {
        tpl.querySelector('.card-number').textContent = item.number;
        tpl.querySelector('.card-number').style.cssText = 'font-size: 2.5rem; font-weight: 900; color: var(--primary); margin-bottom: 0.5rem; display: block;';
        tpl.querySelector('.card-desc').textContent = item.desc;
        tpl.querySelector('.card-desc').style.cssText = 'color: #000000; opacity: 0.7;';
      });
    }

    function renderImpactBars() {
      const container = document.getElementById('impactBars');
      renderWithTemplate('impact-item-tpl', container, CONTENT_DATA.impactItems, (tpl, item) => {
        tpl.querySelector('.impact-title').textContent = item.title;
        tpl.querySelector('.impact-percent').textContent = item.percent;
        tpl.querySelector('.impact-fill').dataset.width = item.width;
        tpl.querySelector('.impact-desc').textContent = item.desc;
        tpl.querySelector('.impact-desc').style.cssText = 'margin-top: 0.5rem; font-size: 0.9rem; color: #000000; opacity: 0.7;';
        tpl.querySelector('.impact-label').style.cssText = 'display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-weight: 600; color: #000000;';
      });
    }

    function renderCards(containerId, data, customizer) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        if (customizer) customizer(card, item);
        container.appendChild(card);
      });
    }

    function renderOptions(containerId, options, field) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'form-option';
        btn.dataset.field = field;
        btn.dataset.value = option.value;
        btn.innerHTML = `
          ${option.display || (option.icon ? `<i class="${option.icon}" style="font-size: 1.5rem; color: var(--primary);"></i>` : '')}
          ${option.label}
        `;
        container.appendChild(btn);
      });
    }

    function renderOccasions() {
      const container = document.getElementById('occasionGrid');
      container.innerHTML = '';
      CONTENT_DATA.occasions.forEach(occasion => {
        const btn = document.createElement('button');
        btn.className = 'card card-compact';
        btn.dataset.occasion = occasion.value;
        btn.style.cssText = 'cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease;';
        btn.innerHTML = `<i class="${occasion.icon}" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i><span style="color: #000000; font-weight: 500;">${occasion.label}</span>`;
        container.appendChild(btn);
      });
    }

    function renderSubcategories() {
      ['tops', 'bottoms', 'shoes'].forEach(type => {
        const containerId = type === 'tops' ? 'superioresSubcategories' : 
                           type === 'bottoms' ? 'inferioresSubcategories' : 'calzadoSubcategories';
        const container = document.getElementById(containerId);
        
        if (!container) {
          console.warn(`‚ö†Ô∏è Container ${containerId} no encontrado`);
          return;
        }
        
        container.innerHTML = '';
        
        if (!CONTENT_DATA.subcategories[type]) {
          console.error(`‚ùå No hay subcategor√≠as definidas para ${type}`);
          return;
        }
        
        CONTENT_DATA.subcategories[type].forEach(subcategory => {
          const section = document.createElement('div');
          section.className = 'subcategory-section';
          
          const itemCount = getSubcategoryItemCount(type, subcategory.id);
          const hasItems = itemCount > 0;
          
          section.innerHTML = `
            <div class="subcategory-title">
              <div class="subcategory-icon">${subcategory.icon}</div>
              <span>${subcategory.name}</span>
              <div class="subcategory-count">${itemCount} prendas</div>
            </div>
            <div class="subcategory-grid">
              <div class="subcategory-item ${hasItems ? 'has-items' : ''}" onclick="uploadToSubcategory('${type}', '${subcategory.id}')">
                <i class="fas fa-plus" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"></i>
                <p style="font-size: 0.8rem; opacity: 0.8;">${subcategory.desc}</p>
                ${hasItems ? `<div class="subcategory-count">${itemCount} items</div>` : ''}
              </div>
            </div>
          `;
          
          container.appendChild(section);
        });
      });
    }

    function getSubcategoryItemCount(type, subcategoryId) {
      return closetItems[type] ? closetItems[type].length : 0;
    }

    window.uploadToSubcategory = function(type, subcategoryId) {
      const input = document.getElementById(`${type}-upload`) || createHiddenFileInput(type);
      input.dataset.subcategory = subcategoryId;
      input.click();
    };

    function createHiddenFileInput(type) {
      const input = document.createElement('input');
      input.type = 'file';
      input.id = `${type}-upload`;
      input.className = 'file-input';
      input.accept = 'image/*';
      input.multiple = true;
      input.style.display = 'none';
      document.body.appendChild(input);
      
      input.addEventListener('change', (e) => {
        handleFileUpload(type, e.target);
      });
      
      return input;
    }

    function renderUploadArea() {
      const container = document.getElementById('uploadGrid');
      container.innerHTML = '';
      CONTENT_DATA.uploadTypes.forEach(upload => {
        const div = document.createElement('div');
        div.className = 'card card-compact';
        div.innerHTML = `
          <i class="${upload.icon}" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem;"></i>
          <h4 style="color: #000000; margin-bottom: 0.5rem;">${upload.title}</h4>
          <p style="color: #000000; opacity: 0.8; margin-bottom: 1rem;">${upload.desc}</p>
          <label for="${upload.type}-upload" class="file-label" id="${upload.type}-label">${upload.label}</label>
          <input type="file" id="${upload.type}-upload" class="file-input" accept="image/*" multiple />
          <div id="${upload.type}-preview" class="preview-area"></div>
        `;
        container.appendChild(div);
      });
    }

    // ============================================
    // GESTI√ìN DE CONTADORES
    // ============================================
    function updateDirectModeCounters() {
      if (closetMode) return;
      
      ['tops', 'bottoms', 'shoes'].forEach(type => {
        const counter = document.getElementById(`${type}Counter`);
        if (!counter) return;
        
        const count = uploadedImages[type].length;
        const max = CONFIG.DIRECT_MODE_LIMITS[type];
        
        counter.textContent = `${type.charAt(0).toUpperCase() + type.slice(1)}: ${count}/${max}`;
        counter.className = 'counter-item';
        
        if (count >= max) {
          counter.classList.add('counter-warning');
        } else if (count >= 1) {
          counter.classList.add('counter-success');
        }
      });
    }

    // ============================================
    // GESTI√ìN DE ARCHIVOS
    // ============================================
    function handleFileUpload(type, input) {
      const files = Array.from(input.files);
      
      for (let file of files) {
        const validation = validateFileCategory(file, type);
        if (!validation.valid) {
          showCategoryError(validation, type, file.name);
          input.value = '';
          return;
        }
      }
      
      if (closetMode) {
        const totalItems = getTotalClosetItems();
        const remainingSpace = CONFIG.CLOSET_MAX_TOTAL - totalItems;
        if (files.length > remainingSpace) {
          showNotification(`Solo puedes subir ${remainingSpace} prendas m√°s. Total m√°ximo: ${CONFIG.CLOSET_MAX_TOTAL}`, 'error');
          input.value = '';
          return;
        }
      } else {
        const currentCount = uploadedFiles[type].length;
        const maxAllowed = CONFIG.DIRECT_MODE_LIMITS[type] - currentCount;
        if (files.length > maxAllowed) {
          showNotification(`Solo puedes subir ${maxAllowed} ${type} m√°s. M√°ximo: ${CONFIG.DIRECT_MODE_LIMITS[type]}`, 'error');
          input.value = '';
          return;
        }
      }

      const startIndex = uploadedFiles[type].length;
      const endIndex = startIndex + files.length;
      
      uploadedFiles[type].length = endIndex;
      uploadedImages[type].length = endIndex;
      
      for (let i = startIndex; i < endIndex; i++) {
        uploadedFiles[type][i] = null;
        uploadedImages[type][i] = null;
      }

      let completedReads = 0;

      files.forEach((file, fileIndex) => {
        const targetIndex = startIndex + fileIndex;
        
        const reader = new FileReader();
        reader.onload = (e) => {
          uploadedFiles[type][targetIndex] = file;
          uploadedImages[type][targetIndex] = e.target.result;
          
          completedReads++;
          
          if (completedReads === files.length) {
            if (closetMode) {
              files.forEach((file, idx) => {
                closetItems[type].push(uploadedImages[type][startIndex + idx]);
              });
              saveUserClosetData();
              updateClosetRemaining();
              renderSubcategories();
            } else {
              updatePreview(type);
              updateDirectModeCounters();
            }
            
            updateCombinationsDisplay();
            updateGenerateButton();
          }
        };
        
        reader.readAsDataURL(file);
      });
      
      input.value = '';
      const typeNames = { tops: 'superiores', bottoms: 'inferiores', shoes: 'zapatos' };
      showNotification(`${files.length} ${typeNames[type]} subidas correctamente`, 'success');
    }

    function updatePreview(type) {
      const preview = document.getElementById(`${type}-preview`);
      if (!preview) return;
      
      preview.innerHTML = '';
      uploadedImages[type].forEach((imageUrl, index) => {
        if (imageUrl) {
          const container = document.createElement('div');
          container.className = 'preview-container';
          container.innerHTML = `
            <img src="${imageUrl}" class="preview-image" alt="${type} ${index + 1}">
            <button class="remove-image" onclick="removeImage('${type}', ${index})">√ó</button>
          `;
          preview.appendChild(container);
        }
      });
    }

    window.removeImage = function(type, index) {
      uploadedFiles[type].splice(index, 1);
      uploadedImages[type].splice(index, 1);
      
      if (closetMode) {
        closetItems[type].splice(index, 1);
        saveUserClosetData();
        updateClosetRemaining();
        renderSubcategories();
      } else {
        updatePreview(type);
        updateDirectModeCounters();
      }
      
      updateCombinationsDisplay();
      updateGenerateButton();
    };

    function updateCombinationsDisplay() {
      const display = document.getElementById('combinationsDisplay');
      if (!display) return;
      
      const formula = document.getElementById('combinationsFormula');
      const result = document.getElementById('combinationsResult');
      
      const topsCount = uploadedImages.tops.length;
      const bottomsCount = uploadedImages.bottoms.length;
      const shoesCount = uploadedImages.shoes.length;
      
      if (topsCount > 0 || bottomsCount > 0 || shoesCount > 0) {
        display.classList.remove('hidden');
        
        const totalCombinations = topsCount * bottomsCount * shoesCount;
        formula.textContent = `${topsCount} √ó ${bottomsCount} √ó ${shoesCount} = ${totalCombinations} combinaciones posibles`;
        
        const maxRecommendations = Math.min(3, totalCombinations);
        
        result.textContent = `Se mostrar√°n las mejores ${maxRecommendations} recomendaciones`;
      } else {
        display.classList.add('hidden');
      }
    }

    function updateGenerateButton() {
      const generateBtn = document.getElementById('generateBtn');
      if (!generateBtn) return;
      
      const topsCount = uploadedImages.tops.length;
      const bottomsCount = uploadedImages.bottoms.length;
      const shoesCount = uploadedImages.shoes.length;
      
      const hasMinimum = topsCount >= 1 && bottomsCount >= 1 && shoesCount >= 1 && selectedOccasion;
      
      if (hasMinimum) {
        const totalCombinations = topsCount * bottomsCount * shoesCount;
        const recommendationsToShow = Math.min(3, totalCombinations);
        
        generateBtn.disabled = false;
        generateBtn.style.opacity = '1';
        
        const hasResults = !document.getElementById('result').classList.contains('hidden');
        if (hasResults) {
          generateBtn.innerHTML = `<i class="fas fa-magic"></i> Generar para ${selectedOccasion} (${recommendationsToShow})`;
        } else {
          generateBtn.innerHTML = `<i class="fas fa-magic"></i> Generar ${recommendationsToShow} Recomendaci√≥n${recommendationsToShow > 1 ? 'es' : ''}`;
        }
      } else {
        generateBtn.disabled = true;
        generateBtn.style.opacity = '0.6';
        
        if (!selectedOccasion) {
          generateBtn.innerHTML = '<i class="fas fa-magic"></i> Selecciona una ocasi√≥n primero';
        } else {
          generateBtn.innerHTML = '<i class="fas fa-magic"></i> Sube al menos 1 prenda de cada tipo';
        }
      }
    }

    // ============================================
    // GENERACI√ìN DE RECOMENDACIONES - CORREGIDO
    // ============================================
    window.getRecommendation = function() {
      if (window.isProcessingRecommendation) {
        console.log('‚ö†Ô∏è Ya hay una recomendaci√≥n en proceso, ignorando llamada duplicada');
        return;
      }
      
      if (!selectedOccasion) { 
        showNotification('Selecciona una ocasi√≥n primero', 'error'); 
        return; 
      }
      
      const topsCount = uploadedImages.tops.length;
      const bottomsCount = uploadedImages.bottoms.length;
      const shoesCount = uploadedImages.shoes.length;
      
      if (topsCount < 1 || bottomsCount < 1 || shoesCount < 1) {
        showNotification('Sube al menos 1 prenda de cada tipo', 'error'); 
        return; 
      }

      window.isProcessingRecommendation = true;

      const resultDiv = document.getElementById('result');
      const changeNotice = document.getElementById('occasionChangeNotice');
      if (changeNotice) {
        changeNotice.remove();
      }
      if (resultDiv) {
        resultDiv.style.opacity = '1';
      }

      const processingTimer = document.getElementById('processingTimer');
      const generateBtn = document.getElementById('generateBtn');
      
      processingTimer.classList.remove('hidden');
      generateBtn.disabled = true;
      generateBtn.innerHTML = '<div class="loading"></div> Procesando con IA...';

      let startTime = Date.now();
      const timerInterval = setInterval(() => {
        document.getElementById('timerDisplay').textContent = ((Date.now() - startTime) / 1000).toFixed(1) + 's';
      }, 100);

      const formData = new FormData();
      
      const validTops = uploadedFiles.tops.filter(file => file instanceof File);
      const validBottoms = uploadedFiles.bottoms.filter(file => file instanceof File);
      const validShoes = uploadedFiles.shoes.filter(file => file instanceof File);
      
      if (validTops.length === 0 || validBottoms.length === 0 || validShoes.length === 0) {
        clearInterval(timerInterval);
        processingTimer.classList.add('hidden');
        generateBtn.disabled = false;
        showNotification('Error: Archivos no v√°lidos', 'error');
        window.isProcessingRecommendation = false;
        return;
      }
      
      validTops.forEach(file => formData.append('tops', file));
      validBottoms.forEach(file => formData.append('bottoms', file));
      validShoes.forEach(file => formData.append('shoes', file));
      
      formData.append('occasion', selectedOccasion);
      
      // CORRECCI√ìN CR√çTICA: Estructura correcta del fetch sin c√≥digo roto
      fetch(`${CONFIG.BACKEND_URL}/api/recommend`, {
        method: 'POST',
        headers: {
          'Accept': 'application/json',
          'User-Agent': 'NoShopiA-Frontend/1.0'
        },
        body: formData
      })
      .then(async response => {
        console.log('üì° RESPONSE STATUS:', response.status);
        
        const responseText = await response.text();
        console.log('üì° RESPONSE BODY (raw):', responseText);
        
        if (!response.ok) {
          throw new Error(`Error HTTP ${response.status}: ${responseText}`);
        }
        
        let parsedData;
        try {
          parsedData = JSON.parse(responseText);
          console.log('‚úÖ JSON parseado correctamente:', parsedData);
        } catch (parseError) {
          throw new Error(`JSON inv√°lido: ${parseError.message}`);
        }
        
        if (!parsedData.results || !Array.isArray(parsedData.results)) {
          throw new Error('Respuesta sin resultados v√°lidos');
        }
        
        return parsedData;
      })
      .then(data => {
        console.log('‚úÖ RESPUESTA EXITOSA DEL BACKEND');
        
        clearInterval(timerInterval);
        processingTimer.classList.add('hidden');
        generateBtn.disabled = false;
        generateBtn.innerHTML = `<i class="fas fa-magic"></i> Generar para otra ocasi√≥n`;
        
        renderRecommendations(data);
        showNotification(`Recomendaciones generadas para ${selectedOccasion}`, 'success');
        
        window.isProcessingRecommendation = false;
      })
      .catch(error => {
        console.error('‚ùå ERROR - La llamada al backend fall√≥:', error);
        
        clearInterval(timerInterval);
        processingTimer.classList.add('hidden');
        generateBtn.disabled = false;
        generateBtn.innerHTML = '<i class="fas fa-magic"></i> Reintentar';
        
        if (error.message.includes('422')) {
          showNotification('Error 422: El backend rechaza los datos', 'error');
        } else if (error.message.includes('500')) {
          showNotification('Error 500: Problema interno del servidor', 'error');
        } else {
          showNotification('Error de red. Verificar conexi√≥n al backend', 'error');
        }
        
        window.isProcessingRecommendation = false;
      });
    };
    // AGREGAR despu√©s de: formData.append('occasion', selectedOccasion);
    if (currentUser?.email) {
      formData.append('email', currentUser.email);
      console.log('üìß Email agregado:', currentUser.email);
    } else {
      console.error('‚ùå Usuario no tiene email');
      showNotification('Error: Usuario no autenticado', 'error');
      window.isProcessingRecommendation = false;
      return;
    }
    
    // AGREGAR antes del fetch para debugging:
    console.log('üöÄ DEBUGGING COMPLETO:');
    console.log('- Occasion:', selectedOccasion);
    console.log('- User Email:', currentUser?.email);
    console.log('- Valid Tops:', validTops.length, 'archivos');
    console.log('- Valid Bottoms:', validBottoms.length, 'archivos');
    console.log('- Valid Shoes:', validShoes.length, 'archivos');
    
    // Debug FormData
    console.log('üì¶ FormData entries:');
    for (let [key, value] of formData.entries()) {
      if (value instanceof File) {
        console.log(`${key}:`, value.name, value.type, value.size, 'bytes');
      } else {
        console.log(`${key}:`, value);
      }
    }
    // ============================================
    // INICIALIZACI√ìN Y DELEGACI√ìN DE EVENTOS
    // ============================================
    function initializeApp() {
      console.log('üöÄ Inicializando NoShopiA con correcciones aplicadas...');
      
      renderHeroStats();
      renderImpactBars();
      
      renderCards('pricingCards', CONTENT_DATA.pricingPlans, (card, plan) => {
        if (plan.badge) {
          const badge = document.createElement('div');
          badge.style.cssText = 'position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 0.5rem 2rem; border-radius: 20px; font-weight: 800; font-size: 0.9rem;';
          badge.textContent = plan.badge;
          card.appendChild(badge);
          card.style.position = 'relative';
          card.style.borderColor = 'var(--primary)';
          card.style.background = 'rgba(59, 130, 246, 0.02)';
        }
        card.innerHTML += `
          <div style="font-size: 3rem; margin-bottom: 1rem;">${plan.icon}</div>
          <h3 class="card-title">${plan.title}</h3>
          <div style="font-size: 3rem; font-weight: 900; color: #000000; margin: 1rem 0;">${plan.price}</div>
          <div style="font-size: 1rem; color: #000000; opacity: 0.7; margin-bottom: 2rem; font-weight: 600;">${plan.period}</div>
          <ul style="list-style: none; text-align: left; margin-bottom: 2rem;">${plan.features.map(f => `<li style="padding: 0.5rem 0; color: #000000; line-height: 1.6;">‚úÖ ${f}</li>`).join('')}</ul>
          <button class="btn ${plan.btnClass}" onclick="${plan.btnAction}" style="width: 100%;">${plan.btnText}</button>
        `;
      });
      
      renderCards('featuresGrid', CONTENT_DATA.features, (card, feature) => {
        card.innerHTML = `
          <div style="font-size: 4rem; margin-bottom: 2rem; display: block;">${feature.icon}</div>
          <h3 class="card-title">${feature.title}</h3>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">${feature.desc}</p>
        `;
      });
      
      renderCards('teamGrid', CONTENT_DATA.team, (card, member) => {
        card.innerHTML = `
          <h3 class="card-title">${member.name}</h3>
          <p style="font-size: 1rem; color: var(--primary); font-weight: 600; margin-bottom: 1rem;">${member.role}</p>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">${member.desc}</p>
        `;
      });
      
      renderOptions('skinColorOptions', CONTENT_DATA.profileOptions.skinColor, 'skin_color');
      renderOptions('ageRangeOptions', CONTENT_DATA.profileOptions.ageRange, 'age_range');
      renderOptions('genderOptions', CONTENT_DATA.profileOptions.gender, 'gender');
      
      setupEventDelegation();
    }

    function setupEventDelegation() {
      console.log('üîß Configurando event delegation...');
      
      document.addEventListener('click', (e) => {
        // Navigation
        if (e.target.matches('[data-section]')) {
          e.preventDefault();
          const section = document.getElementById(e.target.dataset.section);
          if (section) section.scrollIntoView({ behavior: 'smooth' });
          document.querySelectorAll('.nav-pill').forEach(pill => pill.classList.remove('active'));
          e.target.classList.add('active');
        }
        
        // Profile options
        if (e.target.matches('.form-option')) {
          const field = e.target.dataset.field;
          document.querySelectorAll(`[data-field="${field}"]`).forEach(opt => opt.classList.remove('selected'));
          e.target.classList.add('selected');
          checkProfileCompletion();
        }
        
        // Occasion selection - MEJORADO
        if (e.target.matches('[data-occasion]') || e.target.closest('[data-occasion]')) {
          const btn = e.target.closest('[data-occasion]') || e.target;
          console.log('üéØ Ocasi√≥n seleccionada:', btn.dataset.occasion);
          
          document.querySelectorAll('[data-occasion]').forEach(b => {
            b.classList.remove('selected');
            b.style.borderColor = '';
            b.style.background = '';
          });
          
          btn.classList.add('selected');
          btn.style.borderColor = 'var(--success)';
          btn.style.background = 'rgba(16, 185, 129, 0.1)';
          
          const previousOccasion = selectedOccasion;
          selectedOccasion = btn.dataset.occasion;
          
          const hasPhotos = uploadedImages.tops.length > 0 && uploadedImages.bottoms.length > 0 && uploadedImages.shoes.length > 0;
          
          if (hasPhotos && previousOccasion && previousOccasion !== selectedOccasion) {
            showNotification(`Ocasi√≥n cambiada a ${selectedOccasion}`, 'info');
            
            const resultDiv = document.getElementById('result');
            if (resultDiv && !resultDiv.classList.contains('hidden')) {
              resultDiv.style.opacity = '0.5';
              
              const changeNotice = document.createElement('div');
              changeNotice.id = 'occasionChangeNotice';
              changeNotice.style.cssText = `
                position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
                background: rgba(59, 130, 246, 0.95); color: white; padding: 2rem;
                border-radius: 15px; text-align: center; font-weight: 600; z-index: 10;
              `;
              changeNotice.innerHTML = `
                <div style="font-size: 2rem; margin-bottom: 1rem;">üîÑ</div>
                <div>Ocasi√≥n cambiada a: ${selectedOccasion}</div>
                <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 0.5rem;">Genera para ver nuevos scores</div>
              `;
              resultDiv.style.position = 'relative';
              resultDiv.appendChild(changeNotice);
            }
          } else {
            showNotification(`Ocasi√≥n seleccionada: ${selectedOccasion}`, 'success');
          }
          
          if (!closetMode) {
            const uploadArea = document.getElementById('uploadArea');
            const directModeCounters = document.getElementById('directModeCounters');
            
            if (uploadArea) uploadArea.classList.remove('hidden');
            if (directModeCounters) directModeCounters.classList.remove('hidden');
            
            if (!hasPhotos) {
              setTimeout(() => renderUploadArea(), 100);
            }
          }
          
          updateGenerateButton();
        }
        
        // Closet tabs - MEJORADO
        if (e.target.matches('.closet-tab') || e.target.closest('.closet-tab')) {
          const tab = e.target.closest('.closet-tab') || e.target;
          const tabName = tab.dataset.tab;
          
          console.log('üìÅ Cambiando a tab:', tabName);
          
          document.querySelectorAll('.closet-tab').forEach(t => t.classList.remove('active'));
          document.querySelectorAll('.closet-tab-content').forEach(content => content.classList.add('hidden'));
          
          tab.classList.add('active');
          const content = document.getElementById(tabName);
          if (content) {
            content.classList.remove('hidden');
          } else {
            console.error(`‚ùå Tab content ${tabName} no encontrado`);
          }
        }
      });
      
      // File upload delegation - MEJORADO
      document.addEventListener('change', (e) => {
        if (e.target.matches('.file-input')) {
          const type = e.target.id.replace('-upload', '');
          console.log('üìÅ File upload detected for type:', type);
          handleFileUpload(type, e.target);
        }
      });
      
      // Close modal on overlay click
      document.addEventListener('click', (e) => {
        if (e.target.matches('.modal-overlay')) {
          if (e.target.id === 'logoutModal') closeLogoutModal();
          if (e.target.id === 'categoryErrorModal') closeCategoryErrorModal();
        }
      });
      
      console.log('‚úÖ Event delegation configurado correctamente');
    }

    // ============================================
    // RESTO DE FUNCIONES AUXILIARES
    // ============================================
    function checkProfileCompletion() {
      const requiredFields = ['skin_color', 'age_range', 'gender'];
      const selections = {};
      
      document.querySelectorAll('.form-option.selected').forEach(option => {
        selections[option.dataset.field] = option.dataset.value;
      });
      
      const isComplete = requiredFields.every(field => selections[field]);
      const createBtn = document.getElementById('createProfileBtn');
      
      createBtn.disabled = !isComplete;
      createBtn.style.opacity = isComplete ? '1' : '0.6';
      createBtn.innerHTML = isComplete ? 
        '<i class="fas fa-user-plus"></i> Crear Mi Perfil' : 
        '<i class="fas fa-user-plus"></i> Selecciona todas las opciones';
      
      window.selectedProfileData = selections;
    }

    window.submitUserProfile = function() {
      if (!currentUser || !window.selectedProfileData) {
        showNotification('Error: Datos de usuario no v√°lidos', 'error');
        return;
      }

      const profileData = {
        email: currentUser.email,
        name: currentUser.name,
        picture: currentUser.picture,
        ...window.selectedProfileData,
        created_at: new Date().toISOString()
      };

      localStorage.setItem(`noshopia_profile_${currentUser.email}`, JSON.stringify(profileData));
      userProfile = profileData; // ‚úÖ AHORA EST√Å DECLARADA
      
      showNotification('Perfil creado exitosamente', 'success');
      
      setTimeout(() => {
        showModeSelector();
      }, 1000);
    };

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 4000);
    }

    window.saveRecommendationToCloset = function(recommendationIndex) {
      if (!window.currentResults || !window.currentResults[recommendationIndex]) {
        showNotification('Error: No se pudo guardar la recomendaci√≥n', 'error');
        return;
      }
      
      const recommendation = window.currentResults[recommendationIndex];
      savedRecommendations.push({
        ...recommendation,
        savedAt: new Date().toISOString(),
        occasion: selectedOccasion
      });
      
      if (currentUser?.email) {
        localStorage.setItem(`noshopia_saved_${currentUser.email}`, JSON.stringify(savedRecommendations));
      }
      
      showNotification('Recomendaci√≥n guardada en favoritos', 'success');
    };

    // Placeholder functions
    window.startFreePlan = () => showNotification('Plan gratuito activado', 'success');
    window.upgradeToPremium = () => showNotification('Funci√≥n de upgrade disponible pr√≥ximamente', 'info');

    // ============================================
    // INICIALIZACI√ìN - MEJORADA CON DEBUGGING
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
      console.log('üöÄ DOM Content Loaded - Iniciando NoShopiA...');
      
      // Verificar elementos cr√≠ticos del DOM
      const criticalElements = ['closetQuestion', 'closetContainer', 'occasionSelector', 'uploadArea', 'result'];
      criticalElements.forEach(id => {
        const element = document.getElementById(id);
        if (!element) {
          console.error(`‚ùå ELEMENTO CR√çTICO NO ENCONTRADO: ${id}`);
        } else {
          console.log(`‚úÖ Elemento encontrado: ${id}`);
        }
      });
      
      // Verificar que las funciones cr√≠ticas est√©n disponibles
      const criticalFunctions = ['enableCloset', 'useDirectMode', 'getRecommendation', 'handleCredentialResponse'];
      criticalFunctions.forEach(funcName => {
        if (typeof window[funcName] !== 'function') {
          console.error(`‚ùå FUNCI√ìN CR√çTICA NO DISPONIBLE: ${funcName}`);
        } else {
          console.log(`‚úÖ Funci√≥n disponible: ${funcName}`);
        }
      });
      
      console.log('üîß Inicializando componentes...');
      try {
        initializeApp();
        updateAuthUI();
        console.log('‚úÖ Componentes inicializados correctamente');
      } catch (error) {
        console.error('‚ùå Error inicializando componentes:', error);
      }
      
      // Observer para animaciones de impacto
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.querySelectorAll('.impact-fill').forEach(fill => {
              const width = fill.dataset.width;
              if (width) fill.style.width = width + '%';
            });
          }
        });
      }, { threshold: 0.5 });
      
      setTimeout(() => {
        const impactSection = document.getElementById('impacto');
        if (impactSection) {
          observer.observe(impactSection);
          console.log('‚úÖ Observer de animaciones configurado');
        }
      }, 1000);
      
      console.log('üéâ NoShopiA inicializado completamente - TODAS LAS CORRECCIONES APLICADAS');
      
      // Test de funcionalidad post-carga
      setTimeout(() => {
        console.log('üîç Estado actual de variables:');
        console.log('  - isLoggedIn:', isLoggedIn);
        console.log('  - currentUser:', currentUser ? 'disponible' : 'null');
        console.log('  - userProfile:', userProfile ? 'disponible' : 'null');
        console.log('  - closetMode:', closetMode);
        console.log('  - selectedOccasion:', selectedOccasion);
      }, 2000);
    });
  </script>
</body>
</html>
