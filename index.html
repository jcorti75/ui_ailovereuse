<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NoShopiA - Reutiliza tu ropa con IA</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --primary: #3b82f6; --text-primary: #1f2937; --text-secondary: #6b7280; --background: #ffffff;
      --border: #e5e7eb; --accent: #10b981; --warning: #f59e0b; --error: #ef4444; --success: #10b981; --gold: #fbbf24;
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.6; overflow-x: hidden;
      background: var(--background); color: #000000; min-height: 100vh; font-size: 1.2em;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
    .section { padding: 6rem 5%; position: relative; z-index: 2; background: var(--background); }
    .section-title { text-align: center; margin-bottom: 4rem; }
    .section-title h2 { font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; color: #000000; }
    .section-subtitle { font-size: 1.2rem; max-width: 600px; margin: 0 auto; color: #000000; opacity: 0.8; }
    
    /* Header & Navigation */
    header {
      position: fixed; top: 0; width: 100%; padding: 1rem 5%; background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); z-index: 1000; transition: all 0.3s ease;
    }
    nav { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
    .logo { font-size: 3rem; font-weight: 900; display: flex; align-items: center; letter-spacing: 1px; }
    .logo-no { color: #ef4444; } .logo-shop { color: #000000; } .logo-i, .logo-a { color: #22c55e; }
    .nav-pills {
      display: flex; background: rgba(59, 130, 246, 0.1); padding: 0.5rem; border-radius: 50px; gap: 0.5rem;
    }
    .nav-pill {
      padding: 0.7rem 1.5rem; border-radius: 25px; color: #000000; text-decoration: none; font-weight: 500;
      transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;
    }
    .nav-pill:hover, .nav-pill.active { background: rgba(59, 130, 246, 0.2); transform: translateY(-2px); }
    
    /* Buttons & Interactive Elements */
    .btn {
      padding: 1.2rem 3rem; border: none; border-radius: 50px; font-weight: 600; font-size: 1.1rem;
      cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.8rem;
      text-decoration: none; outline: none; box-sizing: border-box;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #1d4ed8); color: white;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4); }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .btn-secondary {
      background: rgba(59, 130, 246, 0.1); color: var(--primary); border: 2px solid var(--primary);
    }
    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669); color: white;
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    }
    .btn-success:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4); }
    
    /* Hero Section */
    .hero {
      min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; position: relative; z-index: 2; padding: 6rem 2rem 4rem; background: var(--background);
    }
    .hero h1 { font-size: clamp(2.5rem, 6vw, 4rem); font-weight: 800; margin-bottom: 1rem; color: #000000; line-height: 1.2; }
    .hero-subtitle { font-size: 1.3rem; margin-bottom: 0.5rem; font-weight: 600; color: #000000; }
    
    /* Grid Layouts */
    .grid { display: grid; gap: 2rem; }
    .grid-2 { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    .grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
    .grid-5 { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
    
    /* Card Components */
    .card {
      background: var(--background); border-radius: 25px; padding: 3rem 2rem; border: 1px solid var(--border);
      transition: all 0.3s ease; text-align: center;
    }
    .card:hover { transform: translateY(-10px); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1); }
    .card-compact { padding: 2rem 1.5rem; }
    .card-icon { font-size: 3rem; margin-bottom: 1rem; color: var(--primary); }
    .card-title { font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #000000; }
    
    /* Form Sections */
    .form-section {
      background: rgba(59, 130, 246, 0.05); border: 2px solid rgba(59, 130, 246, 0.2);
      border-radius: 20px; padding: 3rem 2rem; margin: 2rem 0; animation: fadeInUp 0.6s ease-out;
    }
    .form-options { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 2rem; }
    .form-option {
      background: var(--background); border: 2px solid var(--border); border-radius: 15px; padding: 1rem 0.5rem;
      cursor: pointer; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center;
      gap: 0.5rem; font-size: 0.9rem; font-weight: 500; color: #000000; text-align: center;
      min-height: 80px; justify-content: center;
    }
    .form-option:hover { transform: translateY(-3px); border-color: var(--primary); background: rgba(59, 130, 246, 0.1); }
    .form-option.selected {
      border-color: var(--primary); background: rgba(59, 130, 246, 0.15); transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
    }
    
    /* Upload Components */
    .upload-area {
      background: rgba(59, 130, 246, 0.02); border: 2px dashed var(--border);
      border-radius: 25px; padding: 4rem 2rem; margin: 2rem 0;
    }
    .file-input { display: none; }
    .file-label {
      display: block; padding: 1rem 2rem; background: var(--primary); border-radius: 25px;
      color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 1rem;
    }
    .file-label:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3); }
    .preview-area {
      margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;
    }
    .preview-image {
      width: 120px; height: 120px; object-fit: cover; border-radius: 15px;
      border: 2px solid var(--primary); position: relative;
    }
    .remove-image {
      position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border: none;
      border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 12px;
      display: flex; align-items: center; justify-content: center;
    }
    
    /* Closet Components */
    .closet-container {
      display: none; background: var(--background); border-radius: 25px; margin: 2rem 0;
      border: 2px solid var(--border); overflow: hidden; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    }
    .closet-header {
      background: linear-gradient(135deg, var(--primary), #1d4ed8); padding: 1.5rem 2rem;
      color: white; display: flex; align-items: center; gap: 1rem;
    }
    .closet-stats {
      background: rgba(255, 255, 255, 0.1); padding: 1rem 2rem; display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; text-align: center;
    }
    .closet-stat { color: white; }
    .closet-stat-number { font-size: 1.5rem; font-weight: 700; display: block; }
    .closet-tabs {
      display: flex; background: #f8fafc; border-bottom: 1px solid var(--border); overflow-x: auto;
    }
    .closet-tab {
      padding: 1rem 2rem; background: transparent; border: none; cursor: pointer; font-weight: 600;
      color: #000000; opacity: 0.7; transition: all 0.3s ease; white-space: nowrap;
      border-bottom: 3px solid transparent; display: flex; align-items: center; gap: 0.5rem;
    }
    .closet-tab.active {
      background: var(--background); color: var(--primary); opacity: 1; border-bottom-color: var(--primary);
    }
    .closet-content { padding: 2rem; min-height: 300px; }
    
    /* Impact Bars */
    .impact-bar {
      height: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; overflow: hidden; margin-bottom: 0.5rem;
    }
    .impact-fill {
      height: 100%; background: linear-gradient(135deg, var(--primary), #1d4ed8); border-radius: 10px;
      transition: width 2s ease; width: 0%;
    }
    .impact-fill[data-width="85"] { width: 85%; }
    .impact-fill[data-width="72"] { width: 72%; }
    .impact-fill[data-width="68"] { width: 68%; }
    .impact-fill[data-width="63"] { width: 63%; }
    
    /* Notifications */
    .notification {
      position: fixed; top: 20px; right: 20px; padding: 1rem 2rem; border-radius: 15px; color: white;
      font-weight: 600; z-index: 10000; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      animation: slideInRight 0.3s ease;
    }
    .notification.success { background: linear-gradient(135deg, #10b981, #059669); }
    .notification.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .notification.info { background: linear-gradient(135deg, var(--primary), #1d4ed8); }
    
    /* Mode Indicator */
    .mode-indicator {
      position: fixed; top: 100px; right: 20px; background: var(--primary); color: white;
      padding: 0.5rem 1rem; border-radius: 25px; font-size: 0.8rem; font-weight: 600; z-index: 1000;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); display: none;
    }
    .mode-indicator.closet { background: var(--gold); color: #000000; }
    
    /* Animations */
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading {
      display: inline-block; width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%; border-top-color: #ffffff; animation: spin 1s ease-in-out infinite;
    }
    
    /* Utility Classes */
    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mb-2 { margin-bottom: 2rem; }
    .mt-2 { margin-top: 2rem; }
    
    /* Responsive */
    @media (max-width: 768px) {
      .nav-pills { display: none; }
      .logo { font-size: 2rem; }
      .form-options { grid-template-columns: 1fr; }
      .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
      .grid-5 { grid-template-columns: repeat(2, 1fr); }
    }
    @media (max-width: 480px) {
      .grid-5 { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- Templates -->
  <template id="stat-item-tpl">
    <div class="card card-compact">
      <span class="card-number"></span>
      <span class="card-desc"></span>
    </div>
  </template>
  
  <template id="impact-item-tpl">
    <div class="impact-item">
      <div class="impact-label">
        <span class="impact-title"></span>
        <span class="impact-percent"></span>
      </div>
      <div class="impact-bar">
        <div class="impact-fill"></div>
      </div>
      <p class="impact-desc"></p>
    </div>
  </template>
  
  <template id="pricing-card-tpl">
    <div class="card">
      <div class="card-icon"></div>
      <h3 class="card-title"></h3>
      <div class="pricing-price"></div>
      <div class="pricing-period"></div>
      <ul class="pricing-features"></ul>
      <button class="pricing-btn"></button>
    </div>
  </template>
  
  <template id="folder-item-tpl">
    <div class="card card-compact folder-item">
      <div class="card-icon folder-icon"></div>
      <div class="folder-name"></div>
      <div class="folder-count"></div>
    </div>
  </template>

  <header>
    <nav>
      <div class="logo">
        <span class="logo-no">No</span><span class="logo-shop">shop</span><span class="logo-i">i</span><span class="logo-a">A</span>
      </div>
      
      <div style="display: flex; align-items: center;">
        <div class="nav-pills">
          <a href="#inicio" class="nav-pill active" data-section="inicio">üè† Inicio</a>
          <a href="#impacto" class="nav-pill" data-section="impacto">üåç Impacto</a>
          <a href="#precios" class="nav-pill" data-section="precios">$ Precios</a>
          <a href="#funcionamiento" class="nav-pill" data-section="funcionamiento">‚öôÔ∏è C√≥mo funciona</a>
          <a href="#equipo" class="nav-pill" data-section="equipo">üë• Equipo</a>
        </div>
        
        <div class="auth-container">
          <!-- Real Google Sign-In Button -->
          <div id="g_id_onload"
               data-client_id="326940877598-ko13n1qcqkkugkoo6gu2n1avs46al09p.apps.googleusercontent.com"
               data-context="signin"
               data-ux_mode="popup"
               data-callback="handleCredentialResponse"
               data-auto_prompt="false">
          </div>
          
          <div id="googleSignInBtn" class="g_id_signin" 
               data-type="standard"
               data-shape="pill"
               data-theme="outline"
               data-text="signin_with"
               data-size="large"
               data-logo_alignment="left">
          </div>
          
          <div class="user-info" id="userInfo" style="display: none;">
            <img class="user-avatar" id="userAvatar" alt="Usuario" style="width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--primary);"/>
            <span id="userName" style="color: #000000;"></span>
            <button onclick="logout()" class="btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Salir</button>
          </div>
        </div>
      </div>
    </nav>
  </header>

  <div id="modeIndicator" class="mode-indicator">Modo no seleccionado</div>

  <!-- Hero Section -->
  <section id="inicio" class="hero">
    <div style="max-width: 900px;">
      <span style="font-size: 4rem; margin-bottom: 1rem; display: block;">üö´üõçÔ∏èüëï</span>
      <h1>Reutiliza tu ropa con IA y minimiza tu Impacto Ambiental</h1>
      <p class="hero-subtitle">¬øTardas mucho eligiendo qu√© ponerte cada ma√±ana?</p>
      <p style="font-size: 1.1rem; color: #000000; opacity: 0.8; margin-bottom: 3rem; max-width: 700px; margin-left: auto; margin-right: auto;">
        Descubre combinaciones √∫nicas con tu ropa actual gracias a nuestra inteligencia artificial. Sin estr√©s, sin p√©rdida de tiempo, solo outfits perfectos que cuidan el planeta.
      </p>
      
      <!-- Real Google Sign-In displayed in hero -->
      <div id="heroGoogleAuth" style="display: flex; justify-content: center; margin-bottom: 2rem;">
        <div class="g_id_signin" 
             data-type="standard"
             data-shape="pill"
             data-theme="filled_blue"
             data-text="signin_with"
             data-size="large"
             data-logo_alignment="left">
        </div>
      </div>
      
      <div class="grid grid-3 mt-2" id="heroStats" style="max-width: 800px;"></div>
    </div>
  </section>

  <!-- Impact Section -->
  <section id="impacto" class="section">
    <div class="container">
      <div class="section-title">
        <h2>üåç Impacto Ambiental</h2>
        <p class="section-subtitle">La industria de la moda es una de las m√°s contaminantes del planeta. Reutilizar tu ropa tiene un impacto positivo inmediato.</p>
      </div>
      <div id="impactBars" style="max-width: 800px; margin: 0 auto;"></div>
    </div>
  </section>

  <!-- Pricing Section -->
  <section id="precios" class="section" style="background: rgba(249, 250, 251, 0.5);">
    <div class="container">
      <div class="section-title">
        <h2>$ Precios Simples y Claros</h2>
        <p class="section-subtitle">Elige el plan que mejor se adapte a tu estilo de vida</p>
      </div>
      <div class="grid grid-2 mt-2" id="pricingCards" style="max-width: 800px; margin: 0 auto;"></div>
    </div>
  </section>

  <!-- How it Works Section -->
  <section id="funcionamiento" class="section">
    <div class="container">
      <div class="section-title">
        <h2>‚öôÔ∏è C√≥mo Funciona</h2>
        <p class="section-subtitle">Descubre combinaciones √∫nicas con tu ropa actual en solo tres simples pasos</p>
      </div>
      <div class="grid grid-3 mt-2" id="featuresGrid"></div>
    </div>
  </section>

  <!-- Upload Section -->
  <section id="upload" class="section" style="background: rgba(249, 250, 251, 0.5);">
    <div class="container">
      <div class="section-title">
        <h2>‚ú® Tu Guardarropa Digital Personalizado</h2>
        <p class="section-subtitle">Sube fotos de la ropa que ya tienes y descubre combinaciones incre√≠bles</p>
      </div>

      <!-- Welcome Section -->
      <div id="welcomeSection" class="form-section" style="display: none; background: rgba(34, 197, 94, 0.05); border-color: rgba(34, 197, 94, 0.2);">
        <h3 class="text-center mb-2">üéâ ¬°Bienvenido a NoshopiA!</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Tu perfil ha sido creado exitosamente. Para darte mejores recomendaciones, necesitamos conocerte un poco m√°s.</p>
        <div class="closet-stats">
          <div class="closet-stat"><span class="closet-stat-number" id="visitCounter">1</span><span>Visitas</span></div>
          <div class="closet-stat"><span class="closet-stat-number" id="recommendationCounter">0</span><span>Recomendaciones</span></div>
          <div class="closet-stat"><span class="closet-stat-number" id="outfitCounter">0</span><span>Outfits Guardados</span></div>
        </div>
      </div>

      <!-- Profile Form -->
      <div id="profileForm" class="form-section hidden">
        <h3 class="text-center mb-2">üë§ Completa tu Perfil (Solo una vez)</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Para personalizar mejor tus recomendaciones futuras</p>
        
        <div style="max-width: 600px; margin: 0 auto;">
          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Color de piel:</label>
            <div class="form-options" id="skinColorOptions"></div>
          </div>
          
          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Rango de edad:</label>
            <div class="form-options" id="ageRangeOptions"></div>
          </div>
          
          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">G√©nero:</label>
            <div class="form-options" id="genderOptions"></div>
          </div>
        </div>
        
        <div class="text-center mt-2">
          <button id="createProfileBtn" class="btn btn-primary" onclick="submitUserProfile()" disabled style="opacity: 0.6;">
            <i class="fas fa-user-plus"></i>
            Selecciona todas las opciones
          </button>
        </div>
      </div>

      <!-- Mode Selector -->
      <div id="closetQuestion" class="form-section hidden">
        <h3 class="text-center mb-2">üëó ¬øC√≥mo quieres usar NoshopiA?</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Elige la forma que mejor se adapte a tu estilo</p>
        
        <div class="grid grid-2">
          <div class="card card-compact" onclick="enableCloset()" style="cursor: pointer;">
            <div class="card-icon">üì¶</div>
            <h4 class="card-title">Mi Closet Digital</h4>
            <p style="opacity: 0.7; font-size: 0.9rem;">Guarda hasta 15 prendas, organiza por categor√≠as y guarda tus outfits favoritos</p>
          </div>
          
          <div class="card card-compact" onclick="useDirectMode()" style="cursor: pointer;">
            <div class="card-icon">‚ö°</div>
            <h4 class="card-title">Recomendaciones R√°pidas</h4>
            <p style="opacity: 0.7; font-size: 0.9rem;">Sube fotos directamente y obt√©n recomendaciones instant√°neas (m√°x: 3-3-5)</p>
          </div>
        </div>
      </div>

      <!-- Closet Container -->
      <div id="closetContainer" class="closet-container">
        <div class="closet-header">
          <i class="fas fa-folder-open" style="font-size: 1.5rem;"></i>
          <div><h2>Mi Closet Digital</h2><span id="userEmail" style="opacity: 0.8; font-size: 0.9rem;"></span></div>
        </div>
        
        <div class="closet-stats">
          <div class="closet-stat"><span class="closet-stat-number" id="closetVisits">1</span><span>Visitas</span></div>
          <div class="closet-stat"><span class="closet-stat-number" id="closetRecommendations">0</span><span>Recomendaciones</span></div>
          <div class="closet-stat"><span class="closet-stat-number" id="closetOutfits">0</span><span>Outfits Guardados</span></div>
        </div>
        
        <div class="closet-tabs">
          <button class="closet-tab active" data-tab="superiores"><i class="fas fa-tshirt"></i> Superiores</button>
          <button class="closet-tab" data-tab="inferiores"><i class="fas fa-user-tie"></i> Inferiores</button>
          <button class="closet-tab" data-tab="calzado"><i class="fas fa-shoe-prints"></i> Calzado</button>
          <button class="closet-tab" data-tab="recomendaciones"><i class="fas fa-star"></i> Recomendaciones</button>
        </div>

        <div class="closet-content">
          <div id="superiores" class="closet-tab-content">
            <h3 class="mb-2">üî∏ Prendas Superiores</h3>
            <div class="grid grid-4" id="superioresGrid"></div>
          </div>
          <div id="inferiores" class="closet-tab-content hidden">
            <h3 class="mb-2">üî∏ Prendas Inferiores</h3>
            <div class="grid grid-4" id="inferioresGrid"></div>
          </div>
          <div id="calzado" class="closet-tab-content hidden">
            <h3 class="mb-2">üî∏ Calzado</h3>
            <div class="grid grid-4" id="calzadoGrid"></div>
          </div>
          <div id="recomendaciones" class="closet-tab-content hidden">
            <h3 class="mb-2">‚≠ê Mis Recomendaciones Guardadas</h3>
            <div id="savedRecommendationsList" class="text-center" style="opacity: 0.7; padding: 2rem;">Aqu√≠ aparecer√°n tus combinaciones favoritas guardadas</div>
          </div>
        </div>
      </div>

      <!-- Occasion Selector -->
      <div id="occasionSelector" class="form-section hidden">
        <h3 class="text-center mb-2">¬øQu√© planes tienes para esta ocasi√≥n?</h3>
        <div class="grid grid-5" id="occasionGrid"></div>
      </div>

      <!-- Upload Area -->
      <div class="upload-area hidden" id="uploadArea">
        <div class="grid grid-3" id="uploadGrid"></div>

        <div class="card mt-2" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(34, 197, 94, 0.05));">
          <h3 class="mb-2">üöÄ ¬°Genera tus Recomendaciones!</h3>
          <p class="mb-2" style="opacity: 0.8;">Nuestra IA analizar√° todas las combinaciones posibles</p>
          <div class="notification info hidden" id="processingTimer">‚è±Ô∏è Procesando... <span id="timerDisplay">0.0s</span></div>
          <button class="btn btn-success mt-2" onclick="getRecommendation()" id="generateBtn" disabled>
            <i class="fas fa-magic"></i>Sube fotos de cada categor√≠a para continuar
          </button>
        </div>

        <div id="result" class="hidden mt-2"></div>
      </div>
    </div>
  </section>

  <!-- Team Section -->
  <section id="equipo" class="section">
    <div class="container">
      <div class="section-title">
        <h2>üë• Nuestro Equipo</h2>
        <p class="section-subtitle">Conoce a las personas detr√°s de NoshopiA</p>
      </div>
      <div class="grid grid-2 mt-2" id="teamGrid"></div>
    </div>
  </section>

  <!-- Footer CTA -->
  <section class="section" style="background: rgba(59, 130, 246, 0.05);">
    <div class="container">
      <div class="section-title">
        <h3>üöÄ ¬°Comienza Ahora!</h3>
        <p class="section-subtitle">√önete a miles de personas que ya est√°n revolucionando su estilo de manera sostenible</p>
      </div>
      <div class="grid grid-2 mt-2" style="max-width: 600px; margin: 0 auto;">
        <div class="card card-compact">
          <div style="font-size: 4rem; margin-bottom: 1rem; color: var(--success);">üéÅ</div>
          <h4 style="font-weight: 700; font-size: 1.5rem;">Gratis</h4>
          <p style="opacity: 0.7;">Sin costo inicial</p>
        </div>
        <div class="card card-compact">
          <div style="font-size: 4rem; margin-bottom: 1rem; color: var(--primary);">‚ö°</div>
          <h4 style="font-weight: 700; font-size: 1.5rem;">Instant√°neo</h4>
          <p style="opacity: 0.7;">Resultados en 10 segundos</p>
        </div>
      </div>
    </div>
  </section>

  <footer class="section" style="border-top: 1px solid var(--border);">
    <div class="container">
      <div class="grid grid-2" style="align-items: start; text-align: left;">
        <div>
          <h3><span class="logo-no">No</span><span class="logo-shop">shop</span><span class="logo-i">i</span><span class="logo-a">A</span></h3>
          <p>Maximiza tu ropa, minimiza tu impacto ambiental con IA.</p>
        </div>
        <div>
          <h3>Enlaces R√°pidos</h3>
          <div style="display: flex; flex-direction: column; gap: 0.5rem;">
            <a href="#inicio" data-section="inicio" style="color: inherit; text-decoration: none; opacity: 0.7;">Inicio</a>
            <a href="#impacto" data-section="impacto" style="color: inherit; text-decoration: none; opacity: 0.7;">Impacto Ambiental</a>
            <a href="#precios" data-section="precios" style="color: inherit; text-decoration: none; opacity: 0.7;">Precios</a>
            <a href="#funcionamiento" data-section="funcionamiento" style="color: inherit; text-decoration: none; opacity: 0.7;">C√≥mo Funciona</a>
            <a href="#equipo" data-section="equipo" style="color: inherit; text-decoration: none; opacity: 0.7;">Nuestro Equipo</a>
          </div>
        </div>
      </div>
      <div style="padding-top: 2rem; border-top: 1px solid var(--border); text-align: center; opacity: 0.7;">
        <p>&copy; 2024 NoshopiA. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <script>
    // ============================================
    // CONFIGURACI√ìN Y VARIABLES GLOBALES
    // ============================================
    const CONFIG = {
      GOOGLE_CLIENT_ID: "326940877598-ko13n1qcqkkugkoo6gu2n1avs46al09p.apps.googleusercontent.com",
      RECOMMENDATION_LIMITS: { tops: 3, bottoms: 3, shoes: 5 },
      CLOSET_MAX_TOTAL: 15,
      MIN_REQUIRED: { tops: 1, bottoms: 1, shoes: 1 },
      OCCASIONS: ['casual', 'oficina', 'deportivo', 'formal', 'matrimonio']
    };

    let isLoggedIn = false, currentUser = null, closetMode = false, selectedOccasion = '', userProfile = {};
    let uploadedFiles = { tops: [], bottoms: [], shoes: [] };
    let uploadedImages = { tops: [], bottoms: [], shoes: [] };
    let closetItems = { tops: [], bottoms: [], shoes: [] };

    // ============================================
    // GOOGLE AUTH REAL - CALLBACK FUNCTION
    // ============================================
    window.handleCredentialResponse = function(response) {
      try {
        console.log('Google Auth callback received:', response);
        
        // Decode JWT token to get user info
        const responsePayload = decodeJwtResponse(response.credential);
        console.log('Decoded user data:', responsePayload);
        
        currentUser = {
          email: responsePayload.email,
          name: responsePayload.name,
          picture: responsePayload.picture,
          sub: responsePayload.sub
        };
        
        isLoggedIn = true;
        updateAuthUI();
        
        // Check if user has existing profile
        const existingProfile = localStorage.getItem(`noshopia_profile_${currentUser.email}`);
        
        if (existingProfile) {
          userProfile = JSON.parse(existingProfile);
          showNotification('¬°Bienvenido de vuelta!', 'success');
          showModeSelector();
        } else {
          // New user - show welcome and profile form
          document.getElementById('welcomeSection').classList.remove('hidden');
          document.getElementById('profileForm').classList.remove('hidden');
          document.getElementById('profileForm').scrollIntoView({ behavior: 'smooth', block: 'center' });
          showNotification('¬°Bienvenido a NoShopiA! Completa tu perfil', 'success');
        }
        
      } catch (error) {
        console.error('Error processing Google Auth:', error);
        showNotification('Error en autenticaci√≥n. Intenta nuevamente.', 'error');
      }
    };

    // Decode JWT token function
    function decodeJwtResponse(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    // ============================================
    // FUNCIONES PRINCIPALES FALTANTES
    // ============================================
    window.showModeSelector = function() {
      console.log('Showing mode selector...');
      document.getElementById('profileForm').classList.add('hidden');
      const selector = document.getElementById('closetQuestion');
      selector.classList.remove('hidden');
      selector.scrollIntoView({ behavior: 'smooth', block: 'center' });
      showNotification('Elige tu modo preferido para las recomendaciones', 'info');
    };

    window.enableCloset = function() {
      console.log('Usuario eligi√≥: Modo Closet');
      closetMode = true;
      updateModeIndicator('Modo Closet Digital', true);
      document.getElementById('closetQuestion').classList.add('hidden');
      document.getElementById('closetContainer').classList.remove('hidden');
      document.getElementById('occasionSelector').classList.remove('hidden');
      document.getElementById('userEmail').textContent = currentUser?.email || '';
      renderOccasions();
      showNotification('Modo Closet activado - M√°ximo 15 prendas totales', 'success');
    };

    window.useDirectMode = function() {
      console.log('Usuario eligi√≥: Modo Recomendaciones Directas');
      closetMode = false;
      updateModeIndicator('Modo Recomendaciones R√°pidas', false);
      document.getElementById('closetQuestion').classList.add('hidden');
      document.getElementById('closetContainer').classList.add('hidden');
      document.getElementById('occasionSelector').classList.remove('hidden');
      renderOccasions();
      showNotification('Modo Recomendaciones Directas activado - M√°x: 3 superiores, 3 inferiores, 5 zapatos', 'info');
    };

    // ============================================
    // FUNCIONES AUXILIARES NECESARIAS
    // ============================================
    function updateModeIndicator(text, isCloset) {
      const indicator = document.getElementById('modeIndicator');
      indicator.textContent = text;
      indicator.style.display = 'block';
      indicator.classList.toggle('closet', isCloset);
    }

    function updateAuthUI() {
      const googleSignIn = document.getElementById('googleSignInBtn');
      const heroAuth = document.getElementById('heroGoogleAuth');
      const userInfo = document.getElementById('userInfo');
      
      if (isLoggedIn && currentUser) {
        googleSignIn.style.display = 'none';
        heroAuth.style.display = 'none';
        userInfo.style.display = 'flex';
        document.getElementById('userName').textContent = currentUser.name;
        document.getElementById('userAvatar').src = currentUser.picture;
      } else {
        googleSignIn.style.display = 'block';
        heroAuth.style.display = 'flex';
        userInfo.style.display = 'none';
      }
    }

    window.logout = function() {
      isLoggedIn = false; currentUser = null; closetMode = false; selectedOccasion = '';
      uploadedFiles = { tops: [], bottoms: [], shoes: [] };
      uploadedImages = { tops: [], bottoms: [], shoes: [] };
      closetItems = { tops: [], bottoms: [], shoes: [] };
      
      updateAuthUI();
      
      // Hide all sections
      ['welcomeSection', 'profileForm', 'closetQuestion', 'closetContainer', 'occasionSelector', 'uploadArea'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
      
      document.getElementById('modeIndicator').style.display = 'none';
      showNotification('Sesi√≥n cerrada exitosamente', 'info');
      
      // Google Sign Out
      if (window.google && google.accounts) {
        google.accounts.id.disableAutoSelect();
      }
    };

    // ============================================
    // DATOS DE CONTENIDO COMPONENTIZADOS
    // ============================================
    const CONTENT_DATA = {
      heroStats: [
        { number: '15min', desc: 'Ahorrados cada ma√±ana' },
        { number: '10s', desc: 'Para generar outfit' },
        { number: '25kg', desc: 'CO‚ÇÇ reducido' }
      ],
      impactItems: [
        { title: 'Reducci√≥n en consumo de agua', percent: '85%', width: '85', desc: 'Cada prenda nueva requiere miles de litros de agua en su producci√≥n.' },
        { title: 'Menos emisiones de CO‚ÇÇ', percent: '72%', width: '72', desc: 'El transporte y manufactura textil son grandes emisores de carbono.' },
        { title: 'Reducci√≥n residuos textiles', percent: '68%', width: '68', desc: 'Millones de toneladas de ropa terminan en vertederos anualmente.' },
        { title: 'Menos uso de qu√≠micos', percent: '63%', width: '63', desc: 'Los tintes y tratamientos textiles contaminan r√≠os y oc√©anos.' }
      ],
      pricingPlans: [
        { icon: 'üéÅ', title: 'Plan Free', price: 'Gratis', period: 'Primer mes completo', features: ['30 combinaciones incluidas', 'An√°lisis b√°sico de IA', '3 prendas superiores', '3 prendas inferiores', '5 zapatos diferentes', 'Recomendaciones instant√°neas', 'Sin compromiso'], btnClass: 'btn-secondary', btnText: 'Empezar Gratis', btnAction: 'startFreePlan()' },
        { icon: '‚≠ê', title: 'Plan Premium', price: '$5,000', period: 'por mes', features: ['Recomendaciones ilimitadas', 'IA avanzada personalizada', 'Prendas ilimitadas', 'Zapatos ilimitados', 'An√°lisis en tiempo real', 'Sugerencias de estilo', 'Soporte prioritario'], btnClass: 'btn-primary', btnText: 'Actualizar a Premium', btnAction: 'upgradeToPremium()', badge: 'M√°s Popular' }
      ],
      features: [
        { icon: 'üì±', title: '1. Sube tus prendas', desc: 'Fotograf√≠a las prendas que quieres incluir: superiores, inferiores y calzado. Nuestra IA analiza cada pieza autom√°ticamente.' },
        { icon: 'ü§ñ', title: '2. IA genera recomendaciones', desc: 'Nuestro algoritmo avanzado analiza colores, estilos, ocasiones y tendencias para crear outfits √∫nicos y balanceados.' },
        { icon: '‚ú®', title: '3. Recibe sugerencias', desc: 'Obt√©n recomendaciones personalizadas rankeadas por score de compatibilidad en menos de 10 segundos.' }
      ],
      team: [
        { name: 'Jos√© Francisco Corti Badia', role: 'Founder & CEO', desc: 'Ingeniero Comercial, Diplomado en GenAI U. De Chile 2025 y Diplomado en AI PUC 2022. Experto en Inteligencia Artificial con m√°s de 15 a√±os creando soluciones tecnol√≥gicas innovadoras en distintas industrias.' },
        { name: 'Paola Andrea Curti Simpson', role: 'Directora Creativa', desc: 'Arquitecta especialista en moda sustentable con amplia experiencia en dise√±o consciente y sostenibilidad. Lidera la visi√≥n creativa y el impacto ambiental de nuestras soluciones.' }
      ],
      profileOptions: {
        skinColor: [
          { value: 'claro', label: 'Claro', display: '<div style="background: #F5DEB3; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>' },
          { value: 'medio', label: 'Medio', display: '<div style="background: #DEB887; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>' },
          { value: 'oscuro', label: 'Oscuro', display: '<div style="background: #8B4513; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>' }
        ],
        ageRange: [
          { value: 'menor_18', label: 'Menor 18', icon: 'fas fa-child' },
          { value: '18-24', label: '18-24', icon: 'fas fa-user-graduate' },
          { value: '25-34', label: '25-34', icon: 'fas fa-user-tie' },
          { value: '35-44', label: '35-44', icon: 'fas fa-user' },
          { value: '45-54', label: '45-54', icon: 'fas fa-user-check' },
          { value: 'mas_54', label: 'M√°s de 54', icon: 'fas fa-user-clock' }
        ],
        gender: [
          { value: 'hombre', label: 'Hombre', icon: 'fas fa-mars' },
          { value: 'mujer', label: 'Mujer', icon: 'fas fa-venus' },
          { value: 'no_binario', label: 'No binario', icon: 'fas fa-genderless' }
        ]
      },
      occasions: [
        { value: 'oficina', label: 'Toca Oficina', icon: 'fas fa-briefcase' },
        { value: 'deportivo', label: 'Deportes/Gym', icon: 'fas fa-dumbbell' },
        { value: 'casual', label: 'Junta casual', icon: 'fas fa-users' },
        { value: 'formal', label: 'Outfit Formal', icon: 'fas fa-black-tie' },
        { value: 'matrimonio', label: 'Matrimonio', icon: 'fas fa-ring' }
      ],
      uploadTypes: [
        { type: 'tops', title: 'Parte Superior', desc: 'Camisas, blusas, su√©teres', icon: 'fas fa-tshirt', label: 'Subir Superiores' },
        { type: 'bottoms', title: 'Parte Inferior', desc: 'Pantalones, faldas, shorts', icon: 'fas fa-user-tie', label: 'Subir Inferiores' },
        { type: 'shoes', title: 'Calzado', desc: 'Zapatos, sneakers, botas', icon: 'fas fa-shoe-prints', label: 'Subir Zapatos' }
      ],
      closetFolders: {
        superiores: [
          { icon: 'üëï', name: 'Poleras', desc: 'poleras lisas, con estampados, polerones' },
          { icon: 'üëî', name: 'Camisas', desc: 'camisas de vestir, casuales, mezclilla' },
          { icon: 'üß•', name: 'Sweaters', desc: 'sweaters, cardiganes, poleras con capucha' },
          { icon: 'üè∑Ô∏è', name: 'Chaquetas', desc: 'casacas, blazers, de cuero' },
          { icon: 'üß•', name: 'Abrigos', desc: 'parkas, de invierno, Montgomery' }
        ],
        inferiores: [
          { icon: 'üëñ', name: 'Pantalones', desc: 'jeans, de tela, de vestir' },
          { icon: 'ü©≥', name: 'Shorts', desc: 'bermudas, deportivos, de playa' },
          { icon: 'üëó', name: 'Faldas', desc: 'minifalda, falda tubo, largas' },
          { icon: 'ü©±', name: 'Calzas', desc: 'leggins, deportivas, t√©rmicas' },
          { icon: 'üëó', name: 'Vestidos', desc: 'casuales, formales, largos' }
        ],
        calzado: [
          { icon: 'üëû', name: 'Zapatos', desc: 'de vestir, mocasines, con tacos' },
          { icon: 'üëü', name: 'Zapatillas', desc: 'deportivas, urbanas' },
          { icon: 'ü•æ', name: 'Botas', desc: 'bototos, de lluvia, botines' },
          { icon: 'üë°', name: 'Sandalias', desc: 'chalas, con taco, deportivas' },
          { icon: '‚öΩ', name: 'Especializados', desc: 'running, trekking, trabajo' }
        ]
      }
    };

    // ============================================
    // FUNCIONES DE RENDERIZADO COMPLETAS
    // ============================================
    function renderWithTemplate(templateId, container, data, customizer) {
      container.innerHTML = '';
      data.forEach(item => {
        const tpl = document.getElementById(templateId).content.cloneNode(true);
        if (customizer) customizer(tpl, item);
        container.appendChild(tpl);
      });
    }

    function renderHeroStats() {
      const container = document.getElementById('heroStats');
      renderWithTemplate('stat-item-tpl', container, CONTENT_DATA.heroStats, (tpl, item) => {
        tpl.querySelector('.card-number').textContent = item.number;
        tpl.querySelector('.card-number').style.cssText = 'font-size: 2.5rem; font-weight: 900; color: var(--primary); margin-bottom: 0.5rem; display: block;';
        tpl.querySelector('.card-desc').textContent = item.desc;
        tpl.querySelector('.card-desc').style.cssText = 'color: #000000; opacity: 0.7;';
      });
    }

    function renderImpactBars() {
      const container = document.getElementById('impactBars');
      renderWithTemplate('impact-item-tpl', container, CONTENT_DATA.impactItems, (tpl, item) => {
        tpl.querySelector('.impact-title').textContent = item.title;
        tpl.querySelector('.impact-percent').textContent = item.percent;
        tpl.querySelector('.impact-fill').dataset.width = item.width;
        tpl.querySelector('.impact-desc').textContent = item.desc;
        tpl.querySelector('.impact-desc').style.cssText = 'margin-top: 0.5rem; font-size: 0.9rem; color: #000000; opacity: 0.7;';
        tpl.querySelector('.impact-label').style.cssText = 'display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-weight: 600; color: #000000;';
      });
    }

    function renderCards(containerId, data, customizer) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      data.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        if (customizer) customizer(card, item);
        container.appendChild(card);
      });
    }

    function renderOptions(containerId, options, field) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      options.forEach(option => {
        const btn = document.createElement('button');
        btn.className = 'form-option';
        btn.dataset.field = field;
        btn.dataset.value = option.value;
        btn.innerHTML = `
          ${option.display || (option.icon ? `<i class="${option.icon}" style="font-size: 1.5rem; color: var(--primary);"></i>` : '')}
          ${option.label}
        `;
        container.appendChild(btn);
      });
    }

    function renderOccasions() {
      const container = document.getElementById('occasionGrid');
      container.innerHTML = '';
      CONTENT_DATA.occasions.forEach(occasion => {
        const btn = document.createElement('button');
        btn.className = 'card card-compact';
        btn.dataset.occasion = occasion.value;
        btn.style.cssText = 'cursor: pointer; border: 2px solid var(--border); transition: all 0.3s ease;';
        btn.innerHTML = `<i class="${occasion.icon}" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i><span style="color: #000000; font-weight: 500;">${occasion.label}</span>`;
        container.appendChild(btn);
      });
    }

    function renderUploadArea() {
      const container = document.getElementById('uploadGrid');
      container.innerHTML = '';
      CONTENT_DATA.uploadTypes.forEach(upload => {
        const div = document.createElement('div');
        div.className = 'card card-compact';
        div.innerHTML = `
          <i class="${upload.icon}" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem;"></i>
          <h4 style="color: #000000; margin-bottom: 0.5rem;">${upload.title}</h4>
          <p style="color: #000000; opacity: 0.8; margin-bottom: 1rem;">${upload.desc}</p>
          <label for="${upload.type}-upload" class="file-label">${upload.label} (m√°x ${CONFIG.RECOMMENDATION_LIMITS[upload.type] || 15})</label>
          <input type="file" id="${upload.type}-upload" class="file-input" accept="image/*" multiple />
          <div id="${upload.type}-preview" class="preview-area"></div>
        `;
        container.appendChild(div);
      });
    }

    // ============================================
    // INICIALIZACI√ìN Y DELEGACI√ìN DE EVENTOS
    // ============================================
    function initializeApp() {
      console.log('Inicializando NoShopiA con Google Auth real...');
      
      renderHeroStats();
      renderImpactBars();
      
      // Render all content
      renderCards('pricingCards', CONTENT_DATA.pricingPlans, (card, plan) => {
        if (plan.badge) {
          const badge = document.createElement('div');
          badge.style.cssText = 'position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: var(--primary); color: white; padding: 0.5rem 2rem; border-radius: 20px; font-weight: 800; font-size: 0.9rem;';
          badge.textContent = plan.badge;
          card.appendChild(badge);
          card.style.position = 'relative';
          card.style.borderColor = 'var(--primary)';
          card.style.background = 'rgba(59, 130, 246, 0.02)';
        }
        card.innerHTML += `
          <div style="font-size: 3rem; margin-bottom: 1rem;">${plan.icon}</div>
          <h3 class="card-title">${plan.title}</h3>
          <div style="font-size: 3rem; font-weight: 900; color: #000000; margin: 1rem 0;">${plan.price}</div>
          <div style="font-size: 1rem; color: #000000; opacity: 0.7; margin-bottom: 2rem; font-weight: 600;">${plan.period}</div>
          <ul style="list-style: none; text-align: left; margin-bottom: 2rem;">${plan.features.map(f => `<li style="padding: 0.5rem 0; color: #000000; line-height: 1.6;">‚úÖ ${f}</li>`).join('')}</ul>
          <button class="btn ${plan.btnClass}" onclick="${plan.btnAction}" style="width: 100%;">${plan.btnText}</button>
        `;
      });
      
      renderCards('featuresGrid', CONTENT_DATA.features, (card, feature) => {
        card.innerHTML = `
          <div style="font-size: 4rem; margin-bottom: 2rem; display: block;">${feature.icon}</div>
          <h3 class="card-title">${feature.title}</h3>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">${feature.desc}</p>
        `;
      });
      
      renderCards('teamGrid', CONTENT_DATA.team, (card, member) => {
        card.innerHTML = `
          <h3 class="card-title">${member.name}</h3>
          <p style="font-size: 1rem; color: var(--primary); font-weight: 600; margin-bottom: 1rem;">${member.role}</p>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">${member.desc}</p>
        `;
      });
      
      renderOptions('skinColorOptions', CONTENT_DATA.profileOptions.skinColor, 'skin_color');
      renderOptions('ageRangeOptions', CONTENT_DATA.profileOptions.ageRange, 'age_range');
      renderOptions('genderOptions', CONTENT_DATA.profileOptions.gender, 'gender');
      
      // Render closet folders
      ['superiores', 'inferiores', 'calzado'].forEach(type => {
        const container = document.getElementById(`${type}Grid`);
        if (container) {
          renderWithTemplate('folder-item-tpl', container, CONTENT_DATA.closetFolders[type], (tpl, folder) => {
            tpl.querySelector('.folder-icon').textContent = folder.icon;
            tpl.querySelector('.folder-name').textContent = folder.name;
            tpl.querySelector('.folder-count').textContent = folder.desc;
            tpl.querySelector('.folder-count').style.cssText = 'font-size: 0.85rem; color: #000000; opacity: 0.7; line-height: 1.4;';
          });
        }
      });
      
      renderUploadArea();
      setupEventDelegation();
    }

    function setupEventDelegation() {
      document.addEventListener('click', (e) => {
        // Navigation
        if (e.target.matches('[data-section]')) {
          e.preventDefault();
          const section = document.getElementById(e.target.dataset.section);
          if (section) section.scrollIntoView({ behavior: 'smooth' });
          document.querySelectorAll('.nav-pill').forEach(pill => pill.classList.remove('active'));
          e.target.classList.add('active');
        }
        
        // Profile options
        if (e.target.matches('.form-option')) {
          const field = e.target.dataset.field;
          document.querySelectorAll(`[data-field="${field}"]`).forEach(opt => opt.classList.remove('selected'));
          e.target.classList.add('selected');
          checkProfileCompletion();
        }
        
        // Occasion selection
        if (e.target.matches('[data-occasion]') || e.target.closest('[data-occasion]')) {
          const btn = e.target.closest('[data-occasion]') || e.target;
          document.querySelectorAll('[data-occasion]').forEach(b => b.classList.remove('selected'));
          btn.classList.add('selected');
          selectedOccasion = btn.dataset.occasion;
          document.getElementById('uploadArea').classList.remove('hidden');
          document.getElementById('uploadArea').scrollIntoView({ behavior: 'smooth' });
          showNotification(`Ocasi√≥n seleccionada: ${selectedOccasion}`, 'info');
        }
        
        // Closet tabs
        if (e.target.matches('.closet-tab')) {
          document.querySelectorAll('.closet-tab').forEach(tab => tab.classList.remove('active'));
          document.querySelectorAll('.closet-tab-content').forEach(content => content.classList.add('hidden'));
          e.target.classList.add('active');
          document.getElementById(e.target.dataset.tab).classList.remove('hidden');
        }
        
        // Remove image
        if (e.target.matches('.remove-image')) {
          const preview = e.target.closest('.preview-area');
          const type = preview.id.replace('-preview', '');
          const index = Array.from(preview.children).indexOf(e.target.parentElement);
          removeImage(type, index);
        }
      });
      
      // File upload delegation
      document.addEventListener('change', (e) => {
        if (e.target.matches('.file-input')) {
          const type = e.target.id.replace('-upload', '');
          handleFileUpload(type, e.target);
        }
      });
    }

    // ============================================
    // RESTO DE FUNCIONES AUXILIARES
    // ============================================
    function handleFileUpload(type, input) {
      const files = Array.from(input.files);
      const limits = closetMode ? { tops: 15, bottoms: 15, shoes: 15 } : CONFIG.RECOMMENDATION_LIMITS;
      
      if (closetMode) {
        const totalItems = getTotalClosetItems();
        const remainingSpace = CONFIG.CLOSET_MAX_TOTAL - totalItems;
        if (files.length > remainingSpace) {
          showNotification(`Solo puedes subir ${remainingSpace} prendas m√°s. Total m√°ximo: ${CONFIG.CLOSET_MAX_TOTAL}`, 'error');
          input.value = '';
          return;
        }
      } else {
        const currentCount = uploadedFiles[type].length;
        const maxAllowed = limits[type] - currentCount;
        if (files.length > maxAllowed) {
          showNotification(`Solo puedes subir ${maxAllowed} ${type} m√°s. M√°ximo: ${limits[type]}`, 'error');
          input.value = '';
          return;
        }
      }

      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = (e) => {
          uploadedFiles[type].push(file);
          uploadedImages[type].push(e.target.result);
          if (closetMode) {
            closetItems[type].push(e.target.result);
            saveUserClosetData();
          }
          updatePreview(type);
          updateUploadLabels();
          updateGenerateButton();
        };
        reader.readAsDataURL(file);
      });
      input.value = '';
    }

    function updatePreview(type) {
      const preview = document.getElementById(`${type}-preview`);
      if (!preview) return;
      
      preview.innerHTML = '';
      uploadedImages[type].forEach((imageUrl, index) => {
        const container = document.createElement('div');
        container.style.cssText = 'position: relative; display: inline-block; margin: 0.5rem;';
        container.innerHTML = `
          <img src="${imageUrl}" class="preview-image" alt="${type} ${index + 1}">
          <button class="remove-image">√ó</button>
        `;
        preview.appendChild(container);
      });
    }

    function removeImage(type, index) {
      uploadedFiles[type].splice(index, 1);
      uploadedImages[type].splice(index, 1);
      if (closetMode) {
        closetItems[type].splice(index, 1);
        saveUserClosetData();
      }
      updatePreview(type);
      updateUploadLabels();
      updateGenerateButton();
    }

    function updateUploadLabels() {
      ['tops', 'bottoms', 'shoes'].forEach(type => {
        const label = document.querySelector(`label[for="${type}-upload"]`);
        if (!label) return;
        
        const currentCount = uploadedImages[type].length;
        const limits = closetMode ? { tops: 15, bottoms: 15, shoes: 15 } : CONFIG.RECOMMENDATION_LIMITS;
        
        if (closetMode) {
          const totalItems = getTotalClosetItems();
          const totalRemaining = CONFIG.CLOSET_MAX_TOTAL - totalItems;
          label.innerHTML = `üì§ Subir ${type} (${currentCount}/${CONFIG.CLOSET_MAX_TOTAL}) - Quedan ${totalRemaining}`;
        } else {
          const typeNames = { tops: 'Superiores', bottoms: 'Inferiores', shoes: 'Zapatos' };
          label.innerHTML = `üì§ Subir ${typeNames[type]} (${currentCount}/${limits[type]})`;
        }
      });
    }

    function updateGenerateButton() {
      const generateBtn = document.getElementById('generateBtn');
      const topsCount = uploadedImages.tops.length;
      const bottomsCount = uploadedImages.bottoms.length;
      const shoesCount = uploadedImages.shoes.length;
      const hasMinimum = topsCount >= 1 && bottomsCount >= 1 && shoesCount >= 1;
      
      generateBtn.disabled = !hasMinimum;
      generateBtn.innerHTML = hasMinimum ? 
        '<i class="fas fa-magic"></i> ¬°Generar Recomendaciones!' : 
        '<i class="fas fa-magic"></i> Sube al menos 1 prenda de cada tipo';
      generateBtn.style.opacity = hasMinimum ? '1' : '0.6';
    }

    function checkProfileCompletion() {
      const requiredFields = ['skin_color', 'age_range', 'gender'];
      const selections = {};
      
      document.querySelectorAll('.form-option.selected').forEach(option => {
        selections[option.dataset.field] = option.dataset.value;
      });
      
      const isComplete = requiredFields.every(field => selections[field]);
      const createBtn = document.getElementById('createProfileBtn');
      
      createBtn.disabled = !isComplete;
      createBtn.style.opacity = isComplete ? '1' : '0.6';
      createBtn.innerHTML = isComplete ? 
        '<i class="fas fa-user-plus"></i> Crear Mi Perfil' : 
        '<i class="fas fa-user-plus"></i> Selecciona todas las opciones';
      
      window.selectedProfileData = selections;
    }

    window.submitUserProfile = function() {
      if (!currentUser || !window.selectedProfileData) {
        showNotification('Error: Datos de usuario no v√°lidos', 'error');
        return;
      }

      const profileData = {
        email: currentUser.email,
        name: currentUser.name,
        picture: currentUser.picture,
        ...window.selectedProfileData,
        created_at: new Date().toISOString()
      };

      localStorage.setItem(`noshopia_profile_${currentUser.email}`, JSON.stringify(profileData));
      userProfile = profileData;
      showNotification('Perfil creado exitosamente', 'success');
      
      setTimeout(() => showModeSelector(), 1000);
    };

    function getTotalClosetItems() {
      return closetItems.tops.length + closetItems.bottoms.length + closetItems.shoes.length;
    }

    function saveUserClosetData() {
      if (!currentUser?.email) return;
      const userData = { email: currentUser.email, closetItems, lastUpdated: new Date().toISOString(), totalItems: getTotalClosetItems() };
      localStorage.setItem(`noshopia_closet_${currentUser.email}`, JSON.stringify(userData));
    }

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 4000);
    }

    window.getRecommendation = function() {
      if (!selectedOccasion) { showNotification('Selecciona una ocasi√≥n primero', 'error'); return; }
      if (uploadedImages.tops.length < 1 || uploadedImages.bottoms.length < 1 || uploadedImages.shoes.length < 1) {
        showNotification('Sube al menos 1 prenda de cada tipo', 'error'); return;
      }

      const processingTimer = document.getElementById('processingTimer');
      const generateBtn = document.getElementById('generateBtn');
      processingTimer.classList.remove('hidden');
      generateBtn.disabled = true;
      generateBtn.innerHTML = '<div class="loading"></div> Generando...';

      let startTime = Date.now();
      const timerInterval = setInterval(() => {
        document.getElementById('timerDisplay').textContent = ((Date.now() - startTime) / 1000).toFixed(1) + 's';
      }, 100);

      setTimeout(() => {
        clearInterval(timerInterval);
        processingTimer.classList.add('hidden');
        generateBtn.disabled = false;
        generateBtn.innerHTML = '<i class="fas fa-magic"></i> ¬°Generar Otra Recomendaci√≥n!';
        showMockRecommendation();
      }, 3000);
    };

    function showMockRecommendation() {
      const resultDiv = document.getElementById('result');
      resultDiv.innerHTML = `
        <div class="card" style="border: 2px solid var(--success);">
          <h3 style="color: var(--success); margin-bottom: 2rem;">‚ú® Tu Recomendaci√≥n para ${selectedOccasion}</h3>
          <div class="grid grid-3" style="margin-bottom: 2rem;">
            <div class="text-center">
              <img src="${uploadedImages.tops[0]}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 15px; border: 3px solid var(--success);">
              <h4 style="color: #000; margin-top: 1rem;">Parte Superior</h4>
            </div>
            <div class="text-center">
              <img src="${uploadedImages.bottoms[0]}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 15px; border: 3px solid var(--success);">
              <h4 style="color: #000; margin-top: 1rem;">Parte Inferior</h4>
            </div>
            <div class="text-center">
              <img src="${uploadedImages.shoes[0]}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 15px; border: 3px solid var(--success);">
              <h4 style="color: #000; margin-top: 1rem;">Calzado</h4>
            </div>
          </div>
          <div class="text-center" style="background: rgba(16, 185, 129, 0.1); padding: 1rem; border-radius: 15px;">
            <h4 style="color: var(--success);">Puntuaci√≥n de Compatibilidad: 92%</h4>
            <p style="color: #000; opacity: 0.8;">Esta combinaci√≥n es perfecta para la ocasi√≥n seleccionada</p>
          </div>
          ${closetMode ? '<div class="text-center mt-2"><button onclick="saveCurrentRecommendation()" class="btn" style="background: var(--gold); color: #000;">‚≠ê Guardar en Mi Closet</button></div>' : ''}
        </div>
      `;
      resultDiv.classList.remove('hidden');
      resultDiv.scrollIntoView({ behavior: 'smooth' });
      showNotification('¬°Recomendaci√≥n generada exitosamente!', 'success');
    }

    // Placeholder functions
    window.startFreePlan = () => showNotification('Plan gratuito activado', 'success');
    window.upgradeToPremium = () => showNotification('Funci√≥n de upgrade disponible pr√≥ximamente', 'info');
    window.saveCurrentRecommendation = () => showNotification('Recomendaci√≥n guardada en tu closet', 'success');

    // ============================================
    // INICIALIZACI√ìN
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
      console.log('Initializing NoShopiA with real Google Auth...');
      initializeApp();
      updateAuthUI();
      
      // Observer para animaciones de impacto
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.querySelectorAll('.impact-fill').forEach(fill => {
              const width = fill.dataset.width;
              if (width) fill.style.width = width + '%';
            });
          }
        });
      }, { threshold: 0.5 });
      
      setTimeout(() => {
        const impactSection = document.getElementById('impacto');
        if (impactSection) observer.observe(impactSection);
      }, 1000);
      
      console.log('NoShopiA loaded successfully with real Google Auth');
    });
  </script>
</body>
</html>
