<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NoShopiA - Reutiliza tu ropa con IA</title>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary: #3b82f6; --text-primary: #1f2937; --text-secondary: #6b7280; --background: #ffffff;
      --border: #e5e7eb; --accent: #10b981; --warning: #f59e0b; --error: #ef4444; --success: #10b981; --gold: #fbbf24;
    }
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif; line-height: 1.6; overflow-x: hidden;
      background: var(--background); color: #000000; min-height: 100vh; font-size: 1.2em;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 2rem; }
    .section { padding: 6rem 5%; position: relative; z-index: 2; background: var(--background); }
    .section-title { text-align: center; margin-bottom: 4rem; }
    .section-title h2 { font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem; color: #000000; }
    .section-subtitle { font-size: 1.2rem; max-width: 600px; margin: 0 auto; color: #000000; opacity: 0.8; }

    /* Header & Navigation - RESTAURADO COMPLETO */
    header {
      position: fixed; top: 0; width: 100%; padding: 1rem 5%; background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px); border-bottom: 1px solid var(--border); z-index: 1000; transition: all 0.3s ease;
    }
    nav { display: flex; justify-content: space-between; align-items: center; max-width: 1200px; margin: 0 auto; }
    .logo { font-size: 3rem; font-weight: 900; display: flex; align-items: center; letter-spacing: 1px; }
    .logo-no { color: #ef4444; } .logo-shop { color: #000000; } .logo-i, .logo-a { color: #22c55e; }
    
    .nav-pills {
      display: flex; background: rgba(59, 130, 246, 0.1); padding: 0.5rem; border-radius: 50px; gap: 0.5rem;
    }
    .nav-pill {
      padding: 0.7rem 1.5rem; border-radius: 25px; color: #000000; text-decoration: none; font-weight: 500;
      transition: all 0.3s ease; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem;
    }
    .nav-pill:hover, .nav-pill.active { background: rgba(59, 130, 246, 0.2); transform: translateY(-2px); }

    .mobile-menu-toggle {
      display: none; background: none; border: none; font-size: 1.5rem; color: var(--primary); cursor: pointer;
    }
    .mobile-nav {
      display: none; position: fixed; top: 100%; left: 0; right: 0; background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(20px); padding: 2rem; border-bottom: 1px solid var(--border);
      transform: translateY(-100%); transition: transform 0.3s ease;
    }
    .mobile-nav.active { transform: translateY(0); }
    .mobile-nav-item {
      display: block; padding: 1rem; color: #000000; text-decoration: none; border-radius: 10px;
      margin-bottom: 0.5rem; transition: background 0.3s ease;
    }
    .mobile-nav-item:hover { background: rgba(59, 130, 246, 0.1); }
    
    .auth-container { display: flex; align-items: center; gap: 1rem; margin-left: 1rem; }
    .user-info { display: none; align-items: center; gap: 1rem; }
    .user-info.show { display: flex; }
    .user-avatar { width: 35px; height: 35px; border-radius: 50%; border: 2px solid var(--primary); }
    .logout-btn {
      background: transparent; border: 1px solid var(--primary); color: var(--primary); padding: 0.5rem 1rem;
      border-radius: 20px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s ease;
    }
    .logout-btn:hover { background: var(--primary); color: white; }

    .btn {
      padding: 1.2rem 3rem; border: none; border-radius: 50px; font-weight: 600; font-size: 1.1rem;
      cursor: pointer; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.8rem;
      text-decoration: none; outline: none; box-sizing: border-box;
    }
    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #1d4ed8); color: white;
      box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }
    .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4); }
    .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .btn-secondary {
      background: rgba(59, 130, 246, 0.1); color: var(--primary); border: 2px solid var(--primary);
    }
    .btn-secondary:hover { background: var(--primary); color: white; transform: translateY(-2px); }
    .btn-success {
      background: linear-gradient(135deg, var(--success), #059669); color: white;
      box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
    }
    .btn-success:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(16, 185, 129, 0.4); }
    .btn-gold {
      background: linear-gradient(135deg, var(--gold), #f59e0b); color: #000;
      box-shadow: 0 4px 15px rgba(251, 191, 36, 0.3);
    }
    .btn-gold:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(251, 191, 36, 0.4); }

    .hero {
      min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center;
      text-align: center; position: relative; z-index: 2; padding: 6rem 2rem 4rem; background: var(--background);
    }
    .hero h1 { font-size: clamp(2rem, 5vw, 4rem); font-weight: 800; margin-bottom: 1rem; color: #000000; line-height: 1.2; }
    .hero-subtitle { font-size: 1.3rem; margin-bottom: 0.5rem; font-weight: 600; color: #000000; }

    .grid { display: grid; gap: 2rem; }
    .grid-2 { grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); }
    .grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    .grid-4 { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
    .grid-5 { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }

    .card {
      background: var(--background); border-radius: 25px; padding: 3rem 2rem; border: 1px solid var(--border);
      transition: all 0.3s ease; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .card:hover { transform: translateY(-10px); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15); }
    .card-compact { padding: 2rem 1.5rem; }
    .card-icon { font-size: 3rem; margin-bottom: 1rem; color: var(--primary); }

    .form-section {
      background: rgba(59, 130, 246, 0.05); border: 2px solid rgba(59, 130, 246, 0.2);
      border-radius: 20px; padding: 3rem 2rem; margin: 2rem 0; animation: fadeInUp 0.6s ease-out;
    }
    .form-options { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .form-option {
      background: var(--background); border: 2px solid var(--border); border-radius: 15px; padding: 1rem 0.5rem;
      cursor: pointer; transition: all 0.3s ease; display: flex; flex-direction: column; align-items: center;
      gap: 0.5rem; font-size: 0.9rem; font-weight: 500; color: #000000; text-align: center;
      min-height: 80px; justify-content: center;
    }
    .form-option:hover { transform: translateY(-3px); border-color: var(--primary); background: rgba(59, 130, 246, 0.1); }
    .form-option.selected {
      border-color: var(--primary); background: rgba(59, 130, 246, 0.15); transform: translateY(-3px);
      box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
    }

    /* Impact Bars - RESTAURADO */
    .impact-item { text-align: left; margin-bottom: 2rem; }
    .impact-label { 
      display: flex; justify-content: space-between; margin-bottom: 0.5rem; 
      font-weight: 600; color: #000000; 
    }
    .impact-bar {
      height: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 10px; 
      overflow: hidden; margin-bottom: 0.5rem;
    }
    .impact-fill {
      height: 100%; background: linear-gradient(135deg, var(--primary), #1d4ed8); 
      border-radius: 10px; transition: width 2s ease; width: 0%;
    }
    .impact-fill[data-width="85"] { width: 85%; }
    .impact-fill[data-width="72"] { width: 72%; }
    .impact-fill[data-width="68"] { width: 68%; }
    .impact-fill[data-width="63"] { width: 63%; }

    /* Pricing Cards - RESTAURADO */
    .pricing-card {
      background: var(--background); border-radius: 25px; padding: 3rem 2rem; 
      border: 1px solid var(--border); transition: all 0.3s ease; position: relative; text-align: center;
    }
    .pricing-card:hover { transform: translateY(-10px); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1); }
    .pricing-card.premium { border-color: var(--primary); background: rgba(59, 130, 246, 0.02); }
    .pricing-badge {
      position: absolute; top: -15px; left: 50%; transform: translateX(-50%); 
      background: var(--primary); color: white; padding: 0.5rem 2rem; border-radius: 20px; 
      font-weight: 800; font-size: 0.9rem;
    }
    .pricing-icon { font-size: 3rem; margin-bottom: 1rem; }
    .pricing-title { font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem; color: #000000; }
    .pricing-price { font-size: 3rem; font-weight: 900; color: #000000; margin: 1rem 0; }
    .pricing-period { font-size: 1rem; color: #000000; opacity: 0.7; margin-bottom: 2rem; font-weight: 600; }
    .pricing-features { list-style: none; text-align: left; margin-bottom: 2rem; }
    .pricing-features li { padding: 0.5rem 0; color: #000000; line-height: 1.6; }
    .pricing-btn {
      width: 100%; padding: 1rem 2rem; border: none; border-radius: 25px; font-weight: 600; 
      cursor: pointer; transition: all 0.3s ease; font-size: 1rem;
    }
    .pricing-btn.free { background: rgba(59, 130, 246, 0.1); color: var(--primary); border: 2px solid var(--primary); }
    .pricing-btn.premium { background: var(--primary); color: white; }
    .pricing-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3); }

    /* Team Cards - RESTAURADO */
    .team-card {
      background: var(--background); border-radius: 25px; padding: 2rem; border: 1px solid var(--border);
      transition: all 0.3s ease; text-align: center;
    }
    .team-card:hover { transform: translateY(-10px); box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1); }
    .team-card h3 { font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #000000; }
    .team-role { font-size: 1rem; color: var(--primary); font-weight: 600; margin-bottom: 1rem; }

    /* CLOSET STYLES - INTELIGENTE */
    .closet-container {
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(59, 130, 246, 0.05));
      border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 25px; padding: 2rem; margin: 2rem 0;
    }
    .closet-header {
      display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;
      background: linear-gradient(135deg, var(--gold), #f59e0b); color: #000;
      padding: 1.5rem; border-radius: 15px; font-weight: 700;
    }
    .closet-stats {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem;
      background: rgba(255, 255, 255, 0.2); padding: 1rem; border-radius: 10px; margin-top: 1rem;
    }
    .closet-stat { text-align: center; }
    .closet-stat-number { font-size: 1.5rem; font-weight: 900; display: block; }
    .closet-tabs {
      display: flex; background: rgba(255, 255, 255, 0.5); border-radius: 15px; padding: 0.5rem;
      gap: 0.5rem; margin-bottom: 2rem;
    }
    .closet-tab {
      flex: 1; padding: 1rem; background: transparent; border: none; border-radius: 10px;
      cursor: pointer; font-weight: 600; color: #000; transition: all 0.3s ease;
    }
    .closet-tab.active {
      background: var(--background); color: var(--primary); box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .closet-categories {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;
    }
    .category-card {
      background: var(--background); border: 2px solid var(--border); border-radius: 15px;
      padding: 1.5rem; transition: all 0.3s ease; cursor: pointer;
    }
    .category-card:hover { transform: translateY(-5px); border-color: var(--gold); }
    .category-card.has-items { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
    .category-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem; }
    .category-icon {
      font-size: 2rem; width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;
      background: linear-gradient(135deg, var(--primary), #1d4ed8); color: white; border-radius: 12px;
    }
    .category-info h4 { margin: 0; font-size: 1.1rem; font-weight: 700; }
    .category-info p { margin: 0; font-size: 0.9rem; opacity: 0.7; }
    .category-count {
      background: var(--gold); color: #000; padding: 0.3rem 0.8rem; border-radius: 20px;
      font-weight: 700; font-size: 0.8rem; margin-top: 0.5rem; display: inline-block;
    }
    .category-items {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 0.5rem; margin-top: 1rem;
    }
    .category-item {
      position: relative; background: #f8fafc; border-radius: 8px; overflow: hidden;
      aspect-ratio: 1; cursor: pointer; transition: all 0.3s ease;
    }
    .category-item:hover { transform: scale(1.05); }
    .category-item img { width: 100%; height: 100%; object-fit: cover; }
    .item-remove {
      position: absolute; top: 2px; right: 2px; background: #ef4444; color: white;
      border: none; border-radius: 50%; width: 20px; height: 20px; font-size: 10px;
      cursor: pointer; display: flex; align-items: center; justify-content: center;
    }

    .upload-area {
      background: rgba(59, 130, 246, 0.02); border: 2px dashed var(--border);
      border-radius: 25px; padding: 4rem 2rem; margin: 2rem 0;
    }
    .file-input { display: none; }
    .file-label {
      display: block; padding: 1rem 2rem; background: var(--primary); border-radius: 25px;
      color: white; font-weight: 600; cursor: pointer; transition: all 0.3s ease; margin-top: 1rem;
    }
    .file-label:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3); }
    .preview-area { margin-top: 1rem; display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; }
    .preview-container { position: relative; display: inline-block; }
    .preview-image {
      width: 120px; height: 120px; object-fit: cover; border-radius: 15px;
      border: 2px solid var(--primary); position: relative;
    }
    .remove-image {
      position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border: none;
      border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 12px;
      display: flex; align-items: center; justify-content: center;
    }

    .notification {
      position: fixed; top: 20px; right: 20px; padding: 1rem 2rem; border-radius: 15px; color: white;
      font-weight: 600; z-index: 10000; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      animation: slideInRight 0.3s ease;
    }
    .notification.success { background: linear-gradient(135deg, #10b981, #059669); }
    .notification.error { background: linear-gradient(135deg, #ef4444, #dc2626); }
    .notification.info { background: linear-gradient(135deg, var(--primary), #1d4ed8); }

    .counter-display {
      background: rgba(59, 130, 246, 0.1); border-radius: 15px; padding: 1rem;
      margin: 1rem 0; text-align: center; font-weight: 600;
    }
    .counter-item {
      display: inline-block; margin: 0 1rem; padding: 0.5rem 1rem;
      background: var(--background); border-radius: 10px; border: 1px solid var(--border);
    }
    .counter-success { background: rgba(16, 185, 129, 0.1); border-color: var(--success); color: var(--success); }

    .combinations-info {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
      border-radius: 15px; padding: 1.5rem; margin: 1rem 0; text-align: center;
    }
    .combinations-formula { font-size: 1.2rem; font-weight: 700; color: var(--primary); margin-bottom: 0.5rem; }
    .combinations-result { font-size: 1rem; color: #000000; opacity: 0.8; }

    /* Footer - RESTAURADO */
    .footer-cta {
      background: rgba(59, 130, 246, 0.05); padding: 4rem 5%; text-align: center;
    }
    .footer-cta h3 { font-size: 2rem; font-weight: 700; margin-bottom: 1rem; color: #000000; }
    .footer-cta p { font-size: 1.1rem; color: #000000; opacity: 0.8; margin-bottom: 3rem; }
    .cta-features {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem; 
      max-width: 600px; margin: 0 auto 3rem;
    }
    .cta-feature {
      text-align: center; padding: 2rem; background: var(--background); border-radius: 20px; 
      border: 2px solid var(--border); transition: all 0.3s ease;
    }
    .cta-feature:hover { transform: translateY(-5px); box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1); }

    footer {
      background: var(--background); color: #000000; padding: 3rem 5% 2rem; border-top: 1px solid var(--border);
    }
    .footer-content {
      max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: 2fr 1fr; 
      gap: 3rem; margin-bottom: 2rem;
    }
    .footer-column h3 { font-size: 1.3rem; font-weight: 700; margin-bottom: 1.5rem; color: #000000; }
    .footer-column p, .footer-column a {
      color: #000000; opacity: 0.7; text-decoration: none; line-height: 1.8; 
      transition: color 0.3s ease; display: block; margin-bottom: 0.5rem; cursor: pointer;
    }
    .footer-column a:hover { opacity: 1; }

    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading {
      display: inline-block; width: 20px; height: 20px; border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%; border-top-color: #ffffff; animation: spin 1s ease-in-out infinite;
    }

    .hidden { display: none !important; }
    .text-center { text-align: center; }
    .mb-2 { margin-bottom: 2rem; }

    /* Responsive - RESTAURADO COMPLETO */
    @media (max-width: 768px) {
      .nav-pills { display: none; }
      .mobile-menu-toggle { display: block; }
      .mobile-nav { display: block; }
      .logo { font-size: 2rem; }
      .section { padding: 4rem 3%; }
      .form-options { grid-template-columns: 1fr; }
      .grid-2, .grid-3 { grid-template-columns: 1fr; }
      .grid-4, .grid-5 { grid-template-columns: repeat(2, 1fr); }
      .hero { padding: 4rem 1rem 2rem; }
      .card { padding: 2rem 1rem; }
      .closet-categories { grid-template-columns: 1fr; }
      .closet-tabs { flex-direction: column; }
      .footer-content { grid-template-columns: 1fr; text-align: center; gap: 2rem; }
    }
    @media (max-width: 480px) {
      .grid-4, .grid-5 { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <!-- Header - RESTAURADO COMPLETO -->
  <header>
    <nav>
      <div class="logo">
        <span class="logo-no">No</span><span class="logo-shop">shop</span><span class="logo-i">i</span><span class="logo-a">A</span>
      </div>
      
      <div style="display: flex; align-items: center;">
        <div class="nav-pills">
          <a href="#inicio" class="nav-pill active" data-section="inicio">üè† Inicio</a>
          <a href="#impacto" class="nav-pill" data-section="impacto">üåç Impacto Ambiental</a>
          <a href="#precios" class="nav-pill" data-section="precios">$ Precios</a>
          <a href="#funcionamiento" class="nav-pill" data-section="funcionamiento">‚öôÔ∏è C√≥mo funciona</a>
          <a href="#equipo" class="nav-pill" data-section="equipo">üë• Equipo</a>
        </div>
        
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
          <i class="fas fa-bars"></i>
        </button>

        <div class="auth-container">
          <div id="googleLoginContainer">
            <div id="g_id_onload"
                 data-client_id="326940877598-ko13n1qcqkkugkoo6gu2n1avs46al09p.apps.googleusercontent.com"
                 data-context="signin"
                 data-ux_mode="popup"
                 data-callback="handleCredentialResponse"
                 data-auto_prompt="false">
            </div>
            <div class="g_id_signin"
                 data-type="standard"
                 data-shape="pill"
                 data-theme="outline"
                 data-text="signin_with"
                 data-size="large">
            </div>
          </div>

          <div class="user-info" id="userInfo">
            <img class="user-avatar" id="userAvatar" alt="Usuario"/>
            <span id="userName" style="color: #000000; font-weight: 500;"></span>
            <button class="logout-btn" onclick="logout()">Salir</button>
          </div>
        </div>
      </div>
    </nav>
    
    <!-- Mobile Menu - RESTAURADO -->
    <div class="mobile-nav" id="mobileNav">
      <a href="#inicio" class="mobile-nav-item" onclick="scrollToSection('inicio'); toggleMobileMenu()">üè† Inicio</a>
      <a href="#impacto" class="mobile-nav-item" onclick="scrollToSection('impacto'); toggleMobileMenu()">üåç Impacto Ambiental</a>
      <a href="#precios" class="mobile-nav-item" onclick="scrollToSection('precios'); toggleMobileMenu()">$ Precios</a>
      <a href="#funcionamiento" class="mobile-nav-item" onclick="scrollToSection('funcionamiento'); toggleMobileMenu()">‚öôÔ∏è C√≥mo funciona</a>
      <a href="#equipo" class="mobile-nav-item" onclick="scrollToSection('equipo'); toggleMobileMenu()">üë• Equipo</a>
    </div>
  </header>

  <!-- Hero Section -->
  <section id="inicio" class="hero">
    <div style="max-width: 900px;">
      <span style="font-size: 4rem; margin-bottom: 1rem; display: block;">üö´üõçÔ∏èüëï</span>
      <h1>Reutiliza tu ropa con IA y minimiza tu Impacto Ambiental</h1>
      <p class="hero-subtitle">¬øTardas mucho eligiendo qu√© ponerte cada ma√±ana?</p>
      <p style="font-size: 1.1rem; color: #000000; opacity: 0.8; margin-bottom: 3rem; max-width: 700px; margin-left: auto; margin-right: auto;">
        Descubre combinaciones √∫nicas con tu ropa actual gracias a nuestra inteligencia artificial. Sin estr√©s, sin p√©rdida de tiempo, solo outfits perfectos que cuidan el planeta.
      </p>

      <div id="heroAuth" class="text-center" style="margin-bottom: 2rem;">
        <p style="margin-bottom: 1rem; color: #666;">Inicia sesi√≥n con Google para comenzar:</p>
        <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="filled_blue" data-text="continue_with" data-size="large"></div>
      </div>

      <div class="grid grid-3" style="max-width: 800px;">
        <div class="card card-compact">
          <span style="font-size: 2.5rem; font-weight: 900; color: var(--primary); margin-bottom: 0.5rem; display: block;">15min</span>
          <span style="color: #000000; opacity: 0.7;">Ahorrados cada ma√±ana</span>
        </div>
        <div class="card card-compact">
          <span style="font-size: 2.5rem; font-weight: 900; color: var(--primary); margin-bottom: 0.5rem; display: block;">10s</span>
          <span style="color: #000000; opacity: 0.7;">Para generar outfit</span>
        </div>
        <div class="card card-compact">
          <span style="font-size: 2.5rem; font-weight: 900; color: var(--primary); margin-bottom: 0.5rem; display: block;">25kg</span>
          <span style="color: #000000; opacity: 0.7;">CO‚ÇÇ reducido</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Impact Section - RESTAURADO -->
  <section id="impacto" class="section">
    <div class="container">
      <div class="section-title">
        <h2>üåç Impacto Ambiental</h2>
        <p class="section-subtitle">La industria de la moda es una de las m√°s contaminantes del planeta. Reutilizar tu ropa tiene un impacto positivo inmediato.</p>
      </div>
      <div style="max-width: 800px; margin: 0 auto;">
        <div class="impact-item">
          <div class="impact-label">
            <span>Reducci√≥n en consumo de agua</span>
            <span>85%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" data-width="85"></div>
          </div>
          <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #000000; opacity: 0.7;">
            Cada prenda nueva requiere miles de litros de agua en su producci√≥n.
          </p>
        </div>
        <div class="impact-item">
          <div class="impact-label">
            <span>Menos emisiones de CO‚ÇÇ</span>
            <span>72%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" data-width="72"></div>
          </div>
          <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #000000; opacity: 0.7;">
            El transporte y manufactura textil son grandes emisores de carbono.
          </p>
        </div>
        <div class="impact-item">
          <div class="impact-label">
            <span>Reducci√≥n residuos textiles</span>
            <span>68%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" data-width="68"></div>
          </div>
          <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #000000; opacity: 0.7;">
            Millones de toneladas de ropa terminan en vertederos anualmente.
          </p>
        </div>
        <div class="impact-item">
          <div class="impact-label">
            <span>Menos uso de qu√≠micos</span>
            <span>63%</span>
          </div>
          <div class="impact-bar">
            <div class="impact-fill" data-width="63"></div>
          </div>
          <p style="margin-top: 0.5rem; font-size: 0.9rem; color: #000000; opacity: 0.7;">
            Los tintes y tratamientos textiles contaminan r√≠os y oc√©anos.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Pricing Section - RESTAURADO -->
  <section id="precios" class="section" style="background: rgba(249, 250, 251, 0.5);">
    <div class="container">
      <div class="section-title">
        <h2>$ Precios Simples y Claros</h2>
        <p class="section-subtitle">Elige el plan que mejor se adapte a tu estilo de vida</p>
      </div>
      <div class="grid grid-2" style="max-width: 800px; margin: 0 auto;">
        <div class="pricing-card">
          <div class="pricing-icon">üéÅ</div>
          <h3 class="pricing-title">Plan Free</h3>
          <div class="pricing-price">Gratis</div>
          <div class="pricing-period">Primer mes completo</div>
          <ul class="pricing-features">
            <li>‚úÖ 30 combinaciones incluidas</li>
            <li>‚úÖ An√°lisis b√°sico de IA</li>
            <li>‚úÖ 3 prendas superiores</li>
            <li>‚úÖ 3 prendas inferiores</li>
            <li>‚úÖ 5 zapatos diferentes</li>
            <li>‚úÖ Recomendaciones instant√°neas</li>
            <li>‚úÖ Sin compromiso</li>
          </ul>
          <button class="pricing-btn free" onclick="startFreePlan()">Empezar Gratis</button>
        </div>
        <div class="pricing-card premium">
          <div class="pricing-badge">M√°s Popular</div>
          <div class="pricing-icon">‚≠ê</div>
          <h3 class="pricing-title">Plan Premium</h3>
          <div class="pricing-price">$5,000</div>
          <div class="pricing-period">por mes</div>
          <ul class="pricing-features">
            <li>üöÄ Recomendaciones ilimitadas</li>
            <li>üß† IA avanzada personalizada</li>
            <li>üëó Prendas ilimitadas</li>
            <li>üë† Zapatos ilimitados</li>
            <li>‚ö° An√°lisis en tiempo real</li>
            <li>üé® Sugerencias de estilo</li>
            <li>üì± Soporte prioritario</li>
          </ul>
          <button class="pricing-btn premium" onclick="upgradeToPremium()">Actualizar a Premium</button>
        </div>
      </div>
    </div>
  </section>

  <!-- How it Works Section - RESTAURADO -->
  <section id="funcionamiento" class="section">
    <div class="container">
      <div class="section-title">
        <h2>‚öôÔ∏è C√≥mo Funciona</h2>
        <p class="section-subtitle">Descubre combinaciones √∫nicas con tu ropa actual en solo tres simples pasos</p>
      </div>
      <div class="grid grid-3">
        <div class="card">
          <div style="font-size: 4rem; margin-bottom: 2rem; display: block;">üì±</div>
          <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #000000;">1. Sube tus prendas</h3>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">Fotograf√≠a las prendas que quieres incluir: superiores, inferiores y calzado. Nuestra IA analiza cada pieza autom√°ticamente.</p>
        </div>
        <div class="card">
          <div style="font-size: 4rem; margin-bottom: 2rem; display: block;">ü§ñ</div>
          <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #000000;">2. IA genera recomendaciones</h3>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">Nuestro algoritmo avanzado analiza colores, estilos, ocasiones y tendencias para crear outfits √∫nicos y balanceados.</p>
        </div>
        <div class="card">
          <div style="font-size: 4rem; margin-bottom: 2rem; display: block;">‚ú®</div>
          <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #000000;">3. Recibe sugerencias</h3>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">Obt√©n recomendaciones personalizadas rankeadas por score de compatibilidad en menos de 10 segundos.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Upload Section CON CLOSET INTELIGENTE -->
  <section id="upload" class="section" style="background: rgba(249, 250, 251, 0.5);">
    <div class="container">
      <div class="section-title">
        <h2>‚ú® Tu Guardarropa Digital Personalizado</h2>
        <p class="section-subtitle">Sube fotos de la ropa que ya tienes y descubre combinaciones incre√≠bles</p>
      </div>

      <!-- Welcome Section -->
      <div id="welcomeSection" class="form-section hidden" style="background: rgba(34, 197, 94, 0.05); border-color: rgba(34, 197, 94, 0.2);">
        <h3 class="text-center mb-2">üéâ ¬°Bienvenido a NoShopiA!</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Tu perfil ha sido creado exitosamente. Para darte mejores recomendaciones, necesitamos conocerte un poco m√°s.</p>
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; text-align: center;">
          <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: 10px;">
            <span style="font-size: 1.5rem; font-weight: 700; display: block;" id="visitCounter">1</span>
            <span>Visitas</span>
          </div>
          <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: 10px;">
            <span style="font-size: 1.5rem; font-weight: 700; display: block;" id="recommendationCounter">0</span>
            <span>Recomendaciones</span>
          </div>
          <div style="background: rgba(255, 255, 255, 0.1); padding: 1rem; border-radius: 10px;">
            <span style="font-size: 1.5rem; font-weight: 700; display: block;" id="outfitCounter">0</span>
            <span>Outfits Guardados</span>
          </div>
        </div>
      </div>

      <!-- Profile Form -->
      <div id="profileForm" class="form-section hidden">
        <h3 class="text-center mb-2">üë§ Completa tu Perfil (Solo una vez)</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Para personalizar mejor tus recomendaciones futuras</p>

        <div style="max-width: 600px; margin: 0 auto;">
          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Color de piel:</label>
            <div class="form-options" id="skinColorOptions">
              <button type="button" class="form-option" data-field="skin_color" data-value="claro">
                <div style="background: #F5DEB3; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>
                Claro
              </button>
              <button type="button" class="form-option" data-field="skin_color" data-value="medio">
                <div style="background: #DEB887; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>
                Medio
              </button>
              <button type="button" class="form-option" data-field="skin_color" data-value="oscuro">
                <div style="background: #8B4513; width: 30px; height: 30px; border-radius: 50%; margin: 0 auto 0.5rem;"></div>
                Oscuro
              </button>
            </div>
          </div>

          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">Rango de edad:</label>
            <div class="form-options" id="ageRangeOptions">
              <button type="button" class="form-option" data-field="age_range" data-value="menor_18">
                <i class="fas fa-child" style="font-size: 1.5rem; color: var(--primary);"></i>
                Menor 18
              </button>
              <button type="button" class="form-option" data-field="age_range" data-value="18-24">
                <i class="fas fa-user-graduate" style="font-size: 1.5rem; color: var(--primary);"></i>
                18-24
              </button>
              <button type="button" class="form-option" data-field="age_range" data-value="25-34">
                <i class="fas fa-user-tie" style="font-size: 1.5rem; color: var(--primary);"></i>
                25-34
              </button>
              <button type="button" class="form-option" data-field="age_range" data-value="35-44">
                <i class="fas fa-user" style="font-size: 1.5rem; color: var(--primary);"></i>
                35-44
              </button>
              <button type="button" class="form-option" data-field="age_range" data-value="45-54">
                <i class="fas fa-user-check" style="font-size: 1.5rem; color: var(--primary);"></i>
                45-54
              </button>
              <button type="button" class="form-option" data-field="age_range" data-value="mas_54">
                <i class="fas fa-user-clock" style="font-size: 1.5rem; color: var(--primary);"></i>
                M√°s de 54
              </button>
            </div>
          </div>

          <div class="profile-field">
            <label style="display: block; font-weight: 600; margin-bottom: 1rem; font-size: 1.1rem;">G√©nero:</label>
            <div class="form-options" id="genderOptions">
              <button type="button" class="form-option" data-field="gender" data-value="hombre">
                <i class="fas fa-mars" style="font-size: 1.5rem; color: var(--primary);"></i>
                Hombre
              </button>
              <button type="button" class="form-option" data-field="gender" data-value="mujer">
                <i class="fas fa-venus" style="font-size: 1.5rem; color: var(--primary);"></i>
                Mujer
              </button>
              <button type="button" class="form-option" data-field="gender" data-value="no_binario">
                <i class="fas fa-genderless" style="font-size: 1.5rem; color: var(--primary);"></i>
                No binario
              </button>
            </div>
          </div>
        </div>

        <div class="text-center mt-2">
          <button id="createProfileBtn" class="btn btn-primary" onclick="submitUserProfile()" disabled style="opacity: 0.6;">
            <i class="fas fa-user-plus"></i>
            Selecciona todas las opciones
          </button>
        </div>
      </div>

      <!-- Mode Selector -->
      <div id="modeSelector" class="form-section hidden">
        <h3 class="text-center mb-2">üëó ¬øC√≥mo quieres usar NoShopiA?</h3>
        <p class="text-center mb-2" style="opacity: 0.8;">Elige la forma que mejor se adapte a tu estilo</p>

        <div class="grid grid-2">
          <div class="card card-compact" onclick="enableClosetMode()" style="cursor: pointer;">
            <div class="card-icon">üì¶</div>
            <h4 style="color: #000000; margin-bottom: 0.5rem;">Mi Closet Digital Inteligente</h4>
            <p style="opacity: 0.7; font-size: 0.9rem;">IA organiza autom√°ticamente tus prendas por categor√≠as (m√°x 15)</p>
          </div>

          <div class="card card-compact" onclick="enableDirectMode()" style="cursor: pointer;">
            <div class="card-icon">‚ö°</div>
            <h4 style="color: #000000; margin-bottom: 0.5rem;">Recomendaciones R√°pidas</h4>
            <p style="opacity: 0.7; font-size: 0.9rem;">Sube fotos directamente (m√°x: 3-3-5)</p>
          </div>
        </div>
      </div>

      <!-- CLOSET DIGITAL INTELIGENTE -->
      <div id="closetContainer" class="closet-container hidden">
        <div class="closet-header">
          <div>
            <h2 style="margin: 0; font-size: 1.8rem;">üì¶ Mi Closet Digital Inteligente</h2>
            <p style="margin: 0.5rem 0 0 0; opacity: 0.8;" id="userEmailCloset">usuario@email.com</p>
          </div>
          <button class="btn btn-secondary" onclick="enableDirectMode()">‚ö° Modo R√°pido</button>
        </div>

        <div class="closet-stats">
          <div class="closet-stat">
            <span class="closet-stat-number" id="closetItemCount">0</span>
            <span>Prendas</span>
          </div>
          <div class="closet-stat">
            <span class="closet-stat-number" id="closetCategoryCount">0</span>
            <span>Categor√≠as</span>
          </div>
          <div class="closet-stat">
            <span class="closet-stat-number" id="closetSavedCount">0</span>
            <span>Favoritos</span>
          </div>
          <div class="closet-stat">
            <span class="closet-stat-number" id="closetRemainingCount">15</span>
            <span>Restantes</span>
          </div>
        </div>

        <div class="closet-tabs">
          <button class="closet-tab active" data-type="tops">
            <i class="fas fa-tshirt"></i> Superiores (<span id="topsCount">0</span>)
          </button>
          <button class="closet-tab" data-type="bottoms">
            <i class="fas fa-user-tie"></i> Inferiores (<span id="bottomsCount">0</span>)
          </button>
          <button class="closet-tab" data-type="shoes">
            <i class="fas fa-shoe-prints"></i> Calzado (<span id="shoesCount">0</span>)
          </button>
        </div>

        <div id="closetContent">
          <!-- Contenido din√°mico de categor√≠as -->
        </div>

        <div class="text-center" style="margin: 2rem 0;">
          <button class="btn btn-primary" onclick="uploadToCloset()">
            <i class="fas fa-plus"></i> Agregar Prendas al Closet
          </button>
          <button class="btn btn-gold" onclick="generateFromCloset()" id="closetGenerateBtn" disabled style="margin-left: 1rem;">
            <i class="fas fa-magic"></i> Generar desde Closet
          </button>
        </div>
      </div>

      <!-- Occasion Selector -->
      <div id="occasionSelector" class="form-section hidden">
        <h3 class="text-center mb-2">¬øQu√© planes tienes para esta ocasi√≥n?</h3>
        <div class="grid grid-5" id="occasionGrid">
          <button class="card card-compact" style="cursor: pointer;" data-occasion="oficina">
            <i class="fas fa-briefcase" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i>
            <span style="color: #000000; font-weight: 500;">Toca Oficina</span>
          </button>
          <button class="card card-compact" style="cursor: pointer;" data-occasion="deportivo">
            <i class="fas fa-dumbbell" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i>
            <span style="color: #000000; font-weight: 500;">Deportes/Gym</span>
          </button>
          <button class="card card-compact" style="cursor: pointer;" data-occasion="casual">
            <i class="fas fa-users" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i>
            <span style="color: #000000; font-weight: 500;">Junta casual</span>
          </button>
          <button class="card card-compact" style="cursor: pointer;" data-occasion="formal">
            <i class="fas fa-black-tie" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i>
            <span style="color: #000000; font-weight: 500;">Outfit Formal</span>
          </button>
          <button class="card card-compact" style="cursor: pointer;" data-occasion="matrimonio">
            <i class="fas fa-ring" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.8rem;"></i>
            <span style="color: #000000; font-weight: 500;">Matrimonio</span>
          </button>
        </div>
      </div>

      <!-- Upload Area -->
      <div class="upload-area hidden" id="uploadArea">
        <div id="countersDisplay" class="counter-display">
          <div class="counter-item" id="topsCounter">Superiores: 0/3</div>
          <div class="counter-item" id="bottomsCounter">Inferiores: 0/3</div>
          <div class="counter-item" id="shoesCounter">Zapatos: 0/5</div>
        </div>

        <div class="grid grid-3">
          <div class="card card-compact">
            <i class="fas fa-tshirt" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem;"></i>
            <h4 style="color: #000000;">Parte Superior</h4>
            <p style="color: #000000; opacity: 0.8;">Camisas, blusas, su√©teres</p>
            <label for="tops-upload" class="file-label">üì§ Subir Superiores</label>
            <input type="file" id="tops-upload" class="file-input" accept="image/*" multiple />
            <div id="tops-preview" class="preview-area"></div>
          </div>

          <div class="card card-compact">
            <i class="fas fa-user-tie" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem;"></i>
            <h4 style="color: #000000;">Parte Inferior</h4>
            <p style="color: #000000; opacity: 0.8;">Pantalones, faldas, shorts</p>
            <label for="bottoms-upload" class="file-label">üì§ Subir Inferiores</label>
            <input type="file" id="bottoms-upload" class="file-input" accept="image/*" multiple />
            <div id="bottoms-preview" class="preview-area"></div>
          </div>

          <div class="card card-compact">
            <i class="fas fa-shoe-prints" style="font-size: 2.5rem; color: var(--primary); margin-bottom: 1rem;"></i>
            <h4 style="color: #000000;">Calzado</h4>
            <p style="color: #000000; opacity: 0.8;">Zapatos, sneakers, botas</p>
            <label for="shoes-upload" class="file-label">üì§ Subir Zapatos</label>
            <input type="file" id="shoes-upload" class="file-input" accept="image/*" multiple />
            <div id="shoes-preview" class="preview-area"></div>
          </div>
        </div>

        <div id="combinationsDisplay" class="combinations-info hidden">
          <div class="combinations-formula" id="combinationsFormula">1 √ó 1 √ó 1 = 1 combinaci√≥n posible</div>
          <div class="combinations-result" id="combinationsResult">Se mostrar√°n 1 recomendaci√≥n</div>
        </div>

        <div class="card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(34, 197, 94, 0.05));">
          <h3 class="mb-2">üöÄ ¬°Genera tus Recomendaciones!</h3>
          <p class="mb-2" style="opacity: 0.8;">Nuestra IA analizar√° todas las combinaciones posibles</p>
          <div class="notification info hidden" id="processingTimer" style="position: static; margin: 1rem 0; animation: none;">
            ‚è±Ô∏è Procesando... <span id="timerDisplay">0.0s</span>
          </div>
          <button class="btn btn-success" onclick="generateRecommendations()" id="generateBtn" disabled>
            <i class="fas fa-magic"></i>Sube fotos de cada categor√≠a para continuar
          </button>
        </div>

        <div id="result" class="hidden"></div>
      </div>

      <!-- Invisible file input for closet -->
      <input type="file" id="closet-upload" class="file-input" accept="image/*" multiple />
    </div>
  </section>

  <!-- Team Section - RESTAURADO -->
  <section id="equipo" class="section">
    <div class="container">
      <div class="section-title">
        <h2>üë• Nuestro Equipo</h2>
        <p class="section-subtitle">Conoce a las personas detr√°s de NoShopiA</p>
      </div>
      <div class="grid grid-2">
        <div class="team-card">
          <h3>Jos√© Francisco Corti Badia</h3>
          <p class="team-role">Founder & CEO</p>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">Ingeniero Comercial, Diplomado en GenAI U. De Chile 2025 y Diplomado en AI PUC 2022. Experto en Inteligencia Artificial con m√°s de 15 a√±os creando soluciones tecnol√≥gicas innovadoras en distintas industrias.</p>
        </div>
        <div class="team-card">
          <h3>Paola Andrea Curti Simpson</h3>
          <p class="team-role">Directora Creativa</p>
          <p style="color: #000000; opacity: 0.8; line-height: 1.6;">Arquitecta especialista en moda sustentable con amplia experiencia en dise√±o consciente y sostenibilidad. Lidera la visi√≥n creativa y el impacto ambiental de nuestras soluciones.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer CTA - RESTAURADO -->
  <section class="footer-cta">
    <div class="container">
      <h3>üöÄ ¬°Comienza Ahora!</h3>
      <p>√önete a miles de personas que ya est√°n revolucionando su estilo de manera sostenible</p>
      <div class="cta-features">
        <div class="cta-feature">
          <div style="font-size: 4rem; margin-bottom: 1rem; color: var(--success);">üéÅ</div>
          <h4 style="color: #000000; font-weight: 700; font-size: 1.5rem;">Gratis</h4>
          <p style="color: #000000; opacity: 0.7;">Sin costo inicial</p>
        </div>
        <div class="cta-feature">
          <div style="font-size: 4rem; margin-bottom: 1rem; color: var(--primary);">‚ö°</div>
          <h4 style="color: #000000; font-weight: 700; font-size: 1.5rem;">Instant√°neo</h4>
          <p style="color: #000000; opacity: 0.7;">Resultados en 10 segundos</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer - RESTAURADO COMPLETO -->
  <footer>
    <div class="footer-content">
      <div class="footer-column">
        <h3>
          <span class="logo-no">No</span><span class="logo-shop">shop</span><span class="logo-i">i</span><span class="logo-a">A</span>
        </h3>
        <p>Maximiza tu ropa, minimiza tu impacto ambiental con IA.</p>
      </div>
      <div class="footer-column">
        <h3>Enlaces R√°pidos</h3>
        <a onclick="scrollToSection('inicio')">Inicio</a>
        <a onclick="scrollToSection('impacto')">Impacto Ambiental</a>
        <a onclick="scrollToSection('precios')">Precios</a>
        <a onclick="scrollToSection('funcionamiento')">C√≥mo Funciona</a>
        <a onclick="scrollToSection('equipo')">Nuestro Equipo</a>
      </div>
    </div>
    <div style="padding-top: 2rem; border-top: 1px solid var(--border); color: #000000; opacity: 0.7; text-align: center;">
      <p>&copy; 2025 NoshopiA. Todos los derechos reservados.</p>
    </div>
  </footer>

  <script>
    // CONFIGURACI√ìN Y VARIABLES GLOBALES COMPLETAS
    const CONFIG = {
      GOOGLE_CLIENT_ID: "326940877598-ko13n1qcqkkugkoo6gu2n1avs46al09p.apps.googleusercontent.com",
      DIRECT_MODE_LIMITS: { tops: 3, bottoms: 3, shoes: 5 },
      CLOSET_MAX_TOTAL: 15,
      BACKEND_URL: 'https://noshopia-production.up.railway.app'
    };

    // SISTEMA DE CATEGORIZACI√ìN INTELIGENTE - COMPLETO
    const CLOTHING_CATEGORIES = {
      tops: {
        "shirt": { name: "Camisas", icon: "üëî", keywords: ["shirt", "dress shirt", "button"], color: "#3b82f6" },
        "blouse": { name: "Blusas", icon: "üëö", keywords: ["blouse", "silk blouse"], color: "#ec4899" },
        "sweater": { name: "Su√©teres", icon: "üß•", keywords: ["sweater", "knitted sweater", "wool pullover", "cardigan"], color: "#f59e0b" },
        "tshirt": { name: "Poleras", icon: "üëï", keywords: ["t-shirt", "graphic t-shirt", "tank top"], color: "#10b981" },
        "jacket": { name: "Chaquetas", icon: "üß•", keywords: ["jacket", "leather jacket", "denim jacket", "blazer"], color: "#6b7280" },
        "dress": { name: "Vestidos", icon: "üëó", keywords: ["dress", "summer dress", "evening dress"], color: "#8b5cf6" },
        "hoodie": { name: "Hoodies", icon: "üëò", keywords: ["hoodie", "zip-up hoodie"], color: "#ef4444" },
        "coat": { name: "Abrigos", icon: "üß•", keywords: ["coat", "winter coat"], color: "#1f2937" },
        "vest": { name: "Chalecos", icon: "ü¶∫", keywords: ["vest"], color: "#059669" }
      },
      bottoms: {
        "pants": { name: "Pantalones", icon: "üëñ", keywords: ["pants", "trousers", "formal pants", "dress pants", "chinos"], color: "#3b82f6" },
        "jeans": { name: "Jeans", icon: "üëñ", keywords: ["jeans", "blue denim jeans", "ripped jeans"], color: "#1e40af" },
        "skirt": { name: "Faldas", icon: "üëó", keywords: ["skirt", "midi skirt", "pencil skirt"], color: "#ec4899" },
        "shorts": { name: "Shorts", icon: "ü©≥", keywords: ["shorts", "athletic shorts"], color: "#10b981" },
        "leggings": { name: "Calzas", icon: "ü©±", keywords: ["leggings", "sweatpants"], color: "#6b7280" }
      },
      shoes: {
        "dress_shoes": { name: "Zapatos Formales", icon: "üëû", keywords: ["dress shoes", "leather shoes", "shoes"], color: "#1f2937" },
        "sneakers": { name: "Zapatillas", icon: "üëü", keywords: ["sneakers", "running shoes", "athletic shoes"], color: "#3b82f6" },
        "boots": { name: "Botas", icon: "ü•æ", keywords: ["boots", "ankle boots", "hiking boots"], color: "#92400e" },
        "heels": { name: "Tacones", icon: "üë†", keywords: ["heels", "stiletto heels"], color: "#ec4899" },
        "sandals": { name: "Sandalias", icon: "üë°", keywords: ["sandals", "leather sandals"], color: "#f59e0b" },
        "loafers": { name: "Mocasines", icon: "üëû", keywords: ["loafers"], color: "#374151" },
        "flats": { name: "Ballerinas", icon: "ü•ø", keywords: ["flats"], color: "#6b7280" }
      }
    };

    // Variables globales
    let isLoggedIn = false, currentUser = null, userProfile = null;
    let selectedOccasion = '', closetMode = false, activeClosetType = 'tops';
    let uploadedFiles = { tops: [], bottoms: [], shoes: [] };
    let uploadedImages = { tops: [], bottoms: [], shoes: [] };
    let selectedProfileData = {};
    let closetItems = { tops: [], bottoms: [], shoes: [] };
    let closetCategories = { tops: {}, bottoms: {}, shoes: {} };
    let savedRecommendations = [];

    // NOTIFICACIONES
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => notification.remove(), 4000);
    }

    // MOBILE MENU
    window.toggleMobileMenu = function() {
      const mobileNav = document.getElementById('mobileNav');
      mobileNav.classList.toggle('active');
    };

    // SMOOTH SCROLLING
    function scrollToSection(sectionId) {
      const section = document.getElementById(sectionId);
      if (section) {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Update active nav pill
        document.querySelectorAll('.nav-pill').forEach(pill => pill.classList.remove('active'));
        const navPill = document.querySelector(`[data-section="${sectionId}"]`);
        if (navPill) navPill.classList.add('active');
      }
    }

    // GOOGLE AUTH
    window.handleCredentialResponse = function(response) {
      console.log('üîê Google Auth Response:', response);
      
      try {
        if (!response?.credential) throw new Error('No credential received');

        const responsePayload = decodeJwtResponse(response.credential);
        if (!responsePayload?.email) throw new Error('Invalid user data');

        currentUser = {
          email: responsePayload.email,
          name: responsePayload.name || responsePayload.email,
          picture: responsePayload.picture || '',
          sub: responsePayload.sub
        };

        isLoggedIn = true;
        updateAuthUI();
        loadUserData();

        const existingProfile = localStorage.getItem(`noshopia_profile_${currentUser.email}`);

        if (existingProfile) {
          userProfile = JSON.parse(existingProfile);
          showNotification(`¬°Bienvenido de vuelta, ${currentUser.name}!`, 'success');
          showModeSelector();
        } else {
          document.getElementById('welcomeSection').classList.remove('hidden');
          document.getElementById('profileForm').classList.remove('hidden');
          showNotification('¬°Completa tu perfil para comenzar!', 'success');
          scrollToSection('upload');
        }

      } catch (error) {
        console.error('‚ùå Auth Error:', error);
        showNotification(`Error de autenticaci√≥n: ${error.message}`, 'error');
        currentUser = null;
        isLoggedIn = false;
        updateAuthUI();
      }
    };

    function decodeJwtResponse(token) {
      const base64Url = token.split('.')[1];
      const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      const jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }

    function updateAuthUI() {
      const googleLoginContainer = document.getElementById('googleLoginContainer');
      const userInfo = document.getElementById('userInfo');
      const heroAuth = document.getElementById('heroAuth');

      if (isLoggedIn && currentUser) {
        if (googleLoginContainer) googleLoginContainer.style.display = 'none';
        if (heroAuth) heroAuth.style.display = 'none';
        if (userInfo) {
          userInfo.classList.add('show');
          document.getElementById('userName').textContent = currentUser.name;
          if (currentUser.picture) document.getElementById('userAvatar').src = currentUser.picture;
        }
      } else {
        if (googleLoginContainer) googleLoginContainer.style.display = 'block';
        if (heroAuth) heroAuth.style.display = 'block';
        if (userInfo) userInfo.classList.remove('show');
      }
    }

    window.logout = function() {
      currentUser = null; isLoggedIn = false; userProfile = null; selectedOccasion = '';
      uploadedFiles = { tops: [], bottoms: [], shoes: [] };
      uploadedImages = { tops: [], bottoms: [], shoes: [] };
      closetItems = { tops: [], bottoms: [], shoes: [] };
      closetCategories = { tops: {}, bottoms: {}, shoes: {} };
      savedRecommendations = []; closetMode = false;

      updateAuthUI(); hideAllSections();
      
      if (window.google?.accounts) window.google.accounts.id.disableAutoSelect();
      showNotification('Sesi√≥n cerrada exitosamente', 'info');
      window.scrollTo({top: 0, behavior: 'smooth'});
    };

    // GESTI√ìN DE DATOS DEL USUARIO
    function loadUserData() {
      if (!currentUser?.email) return;
      
      const closetData = localStorage.getItem(`noshopia_closet_${currentUser.email}`);
      if (closetData) {
        const data = JSON.parse(closetData);
        closetItems = data.closetItems || { tops: [], bottoms: [], shoes: [] };
        closetCategories = data.closetCategories || { tops: {}, bottoms: {}, shoes: {} };
        console.log('üì¶ Closet cargado:', getTotalClosetItems(), 'prendas');
      }
      
      const savedData = localStorage.getItem(`noshopia_saved_${currentUser.email}`);
      if (savedData) {
        savedRecommendations = JSON.parse(savedData);
        console.log('‚≠ê Recomendaciones guardadas:', savedRecommendations.length);
      }
    }

    function saveUserData() {
      if (!currentUser?.email) return;
      
      const closetData = {
        email: currentUser.email,
        closetItems,
        closetCategories,
        lastUpdated: new Date().toISOString(),
        totalItems: getTotalClosetItems()
      };
      localStorage.setItem(`noshopia_closet_${currentUser.email}`, JSON.stringify(closetData));
      
      if (savedRecommendations.length > 0) {
        localStorage.setItem(`noshopia_saved_${currentUser.email}`, JSON.stringify(savedRecommendations));
      }
    }

    // PROFILE MANAGEMENT
    function checkProfileCompletion() {
      const requiredFields = ['skin_color', 'age_range', 'gender'];
      const selections = {};

      document.querySelectorAll('.form-option.selected').forEach(option => {
        selections[option.dataset.field] = option.dataset.value;
      });

      const isComplete = requiredFields.every(field => selections[field]);
      const createBtn = document.getElementById('createProfileBtn');

      createBtn.disabled = !isComplete;
      createBtn.style.opacity = isComplete ? '1' : '0.6';
      createBtn.innerHTML = isComplete ? 
        '<i class="fas fa-user-plus"></i> Crear Mi Perfil' : 
        '<i class="fas fa-user-plus"></i> Selecciona todas las opciones';

      selectedProfileData = selections;
    }

    window.submitUserProfile = function() {
      if (!currentUser || !selectedProfileData) {
        showNotification('Error: Datos incompletos', 'error');
        return;
      }

      const profileData = {
        email: currentUser.email,
        name: currentUser.name,
        picture: currentUser.picture,
        ...selectedProfileData,
        created_at: new Date().toISOString()
      };

      localStorage.setItem(`noshopia_profile_${currentUser.email}`, JSON.stringify(profileData));
      userProfile = profileData;

      hideAllSections();
      showNotification('¬°Perfil creado exitosamente!', 'success');
      setTimeout(() => showModeSelector(), 1000);
    };

    // MODE SELECTION
    function showModeSelector() {
      hideAllSections();
      document.getElementById('modeSelector').classList.remove('hidden');
      scrollToSection('upload');
    }

    window.enableClosetMode = function() {
      closetMode = true;
      hideAllSections();
      
      const container = document.getElementById('closetContainer');
      container.classList.remove('hidden');
      
      document.getElementById('userEmailCloset').textContent = currentUser.email;
      
      updateClosetUI();
      renderClosetContent();
      showNotification('¬°Closet Digital Inteligente activado!', 'success');
      scrollToSection('upload');
    };

    window.enableDirectMode = function() {
      closetMode = false;
      hideAllSections();
      showNotification('Modo Recomendaciones R√°pidas activado', 'success');
      showOccasionSelector();
    };

    function showOccasionSelector() {
      document.getElementById('occasionSelector').classList.remove('hidden');
      scrollToSection('upload');
    }

    // CLOSET FUNCTIONS - FUNCIONALIDAD COMPLETA
    function getTotalClosetItems() {
      return closetItems.tops.length + closetItems.bottoms.length + closetItems.shoes.length;
    }

    function updateClosetUI() {
      const total = getTotalClosetItems();
      const categories = getTotalCategories();
      const saved = savedRecommendations.length;
      const remaining = Math.max(0, CONFIG.CLOSET_MAX_TOTAL - total);
      
      document.getElementById('closetItemCount').textContent = total;
      document.getElementById('closetCategoryCount').textContent = categories;
      document.getElementById('closetSavedCount').textContent = saved;
      document.getElementById('closetRemainingCount').textContent = remaining;
      
      document.getElementById('topsCount').textContent = closetItems.tops.length;
      document.getElementById('bottomsCount').textContent = closetItems.bottoms.length;
      document.getElementById('shoesCount').textContent = closetItems.shoes.length;
      
      updateClosetGenerateButton();
    }

    function getTotalCategories() {
      let total = 0;
      Object.keys(closetCategories.tops).forEach(cat => { if (closetCategories.tops[cat].length > 0) total++; });
      Object.keys(closetCategories.bottoms).forEach(cat => { if (closetCategories.bottoms[cat].length > 0) total++; });
      Object.keys(closetCategories.shoes).forEach(cat => { if (closetCategories.shoes[cat].length > 0) total++; });
      return total;
    }

    function renderClosetContent() {
      const content = document.getElementById('closetContent');
      const type = activeClosetType;
      
      if (!closetItems[type] || closetItems[type].length === 0) {
        content.innerHTML = `
          <div class="text-center" style="padding: 3rem;">
            <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">üì¶</div>
            <h3 style="color: #666; margin-bottom: 1rem;">Tu ${type === 'tops' ? 'closet de superiores' : type === 'bottoms' ? 'closet de inferiores' : 'closet de calzado'} est√° vac√≠o</h3>
            <p style="opacity: 0.7;">Agrega prendas para que la IA las organice autom√°ticamente</p>
          </div>
        `;
        return;
      }
      
      content.innerHTML = renderCategoriesForType(type);
    }

    function renderCategoriesForType(type) {
      const categories = closetCategories[type];
      if (!categories || Object.keys(categories).length === 0) {
        return `<div class="text-center" style="padding: 2rem; opacity: 0.7;">No hay categor√≠as generadas a√∫n</div>`;
      }
      
      let html = '<div class="closet-categories">';
      
      Object.entries(categories).forEach(([categoryId, items]) => {
        if (items.length === 0) return;
        
        const categoryInfo = CLOTHING_CATEGORIES[type][categoryId];
        if (!categoryInfo) return;
        
        html += `
          <div class="category-card has-items">
            <div class="category-header">
              <div class="category-icon" style="background: ${categoryInfo.color};">
                ${categoryInfo.icon}
              </div>
              <div class="category-info">
                <h4>${categoryInfo.name}</h4>
                <p>${items.length} prenda${items.length !== 1 ? 's' : ''}</p>
              </div>
            </div>
            <div class="category-items">
              ${items.map((item, index) => `
                <div class="category-item" onclick="selectClosetItem('${type}', '${categoryId}', ${index})">
                  <img src="${item.imageUrl}" alt="${categoryInfo.name}">
                  <button class="item-remove" onclick="event.stopPropagation(); removeClosetItem('${type}', '${categoryId}', ${index})">√ó</button>
                </div>
              `).join('')}
            </div>
          </div>
        `;
      });
      
      html += '</div>';
      return html;
    }

    function categorizeClothingItem(type, detectedItem, imageUrl, file) {
      console.log(`üß† Categorizando: ${detectedItem} (tipo: ${type})`);
      
      const itemLower = detectedItem.toLowerCase();
      const categories = CLOTHING_CATEGORIES[type];
      
      let bestCategory = null;
      let maxMatches = 0;
      
      Object.entries(categories).forEach(([categoryId, categoryInfo]) => {
        const matches = categoryInfo.keywords.filter(keyword => 
          itemLower.includes(keyword.toLowerCase())
        ).length;
        
        if (matches > maxMatches) {
          maxMatches = matches;
          bestCategory = categoryId;
        }
      });
      
      if (!bestCategory) {
        if (type === 'tops') bestCategory = 'tshirt';
        else if (type === 'bottoms') bestCategory = 'pants';
        else if (type === 'shoes') bestCategory = 'sneakers';
      }
      
      console.log(`üìÅ Asignado a categor√≠a: ${bestCategory} (${maxMatches} matches)`);
      
      const item = {
        imageUrl,
        file,
        detectedItem,
        category: bestCategory,
        addedAt: new Date().toISOString()
      };
      
      if (!closetCategories[type][bestCategory]) {
        closetCategories[type][bestCategory] = [];
      }
      
      closetCategories[type][bestCategory].push(item);
      closetItems[type].push(item);
      
      return { category: bestCategory, item };
    }

    window.uploadToCloset = function() {
      const remaining = CONFIG.CLOSET_MAX_TOTAL - getTotalClosetItems();
      
      if (remaining <= 0) {
        showNotification(`Closet lleno (${CONFIG.CLOSET_MAX_TOTAL}/15). Elimina prendas para agregar nuevas.`, 'error');
        return;
      }
      
      const input = document.getElementById('closet-upload');
      input.onchange = handleClosetUpload;
      input.click();
    };

    function handleClosetUpload(event) {
      const files = Array.from(event.target.files);
      if (files.length === 0) return;
      
      const remaining = CONFIG.CLOSET_MAX_TOTAL - getTotalClosetItems();
      
      if (files.length > remaining) {
        showNotification(`Solo puedes subir ${remaining} prendas m√°s`, 'error');
        event.target.value = '';
        return;
      }
      
      showNotification('Subiendo y categorizando prendas...', 'info');
      
      // Fallback: agregar sin detecci√≥n
      files.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          categorizeClothingItem(activeClosetType, `${activeClosetType} ${index + 1}`, e.target.result, file);
          if (index === files.length - 1) {
            finishClosetUpload(files.length);
          }
        };
        reader.readAsDataURL(file);
      });
      
      event.target.value = '';
    }

    function finishClosetUpload(count) {
      saveUserData();
      updateClosetUI();
      renderClosetContent();
      
      const remaining = CONFIG.CLOSET_MAX_TOTAL - getTotalClosetItems();
      showNotification(`¬°${count} prenda${count !== 1 ? 's' : ''} agregada${count !== 1 ? 's' : ''} y categorizadas! Te quedan ${remaining} espacios.`, 'success');
    }

    window.removeClosetItem = function(type, categoryId, index) {
      const categoryInfo = CLOTHING_CATEGORIES[type][categoryId];
      const itemName = categoryInfo ? categoryInfo.name : categoryId;
      
      if (!confirm(`¬øEliminar esta prenda de ${itemName}?`)) return;
      
      closetCategories[type][categoryId].splice(index, 1);
      
      const item = closetCategories[type][categoryId][index];
      if (item) {
        const generalIndex = closetItems[type].findIndex(i => i === item);
        if (generalIndex !== -1) {
          closetItems[type].splice(generalIndex, 1);
        }
      }
      
      saveUserData();
      updateClosetUI();
      renderClosetContent();
      
      showNotification(`Prenda eliminada de ${itemName}`, 'info');
    };

    window.selectClosetItem = function(type, categoryId, index) {
      console.log('Item seleccionado:', type, categoryId, index);
    };

    function updateClosetGenerateButton() {
      const btn = document.getElementById('closetGenerateBtn');
      if (!btn) return;
      
      const hasMinimum = closetItems.tops.length > 0 && closetItems.bottoms.length > 0 && closetItems.shoes.length > 0;
      
      if (hasMinimum && selectedOccasion) {
        btn.disabled = false;
        btn.style.opacity = '1';
        btn.innerHTML = '<i class="fas fa-magic"></i> Generar desde Closet';
      } else {
        btn.disabled = true;
        btn.style.opacity = '0.6';
        if (!selectedOccasion) {
          btn.innerHTML = '<i class="fas fa-magic"></i> Selecciona ocasi√≥n primero';
        } else {
          btn.innerHTML = '<i class="fas fa-magic"></i> Necesitas prendas de cada tipo';
        }
      }
    }

    window.generateFromCloset = function() {
      if (!selectedOccasion) {
        showOccasionSelector();
        showNotification('Primero selecciona una ocasi√≥n', 'info');
        return;
      }
      
      const hasMinimum = closetItems.tops.length > 0 && closetItems.bottoms.length > 0 && closetItems.shoes.length > 0;
      
      if (!hasMinimum) {
        showNotification('Necesitas al menos 1 prenda de cada tipo en tu closet', 'error');
        return;
      }
      
      const selectedFiles = {
        tops: [closetItems.tops[0].file],
        bottoms: [closetItems.bottoms[0].file],
        shoes: [closetItems.shoes[0].file]
      };
      
      generateRecommendationsWithFiles(selectedFiles);
    };

    // FILE UPLOAD (MODO DIRECTO) - Todas las funciones necesarias
    function handleFileUpload(type, input) {
      const files = Array.from(input.files);
      if (files.length === 0) return;

      const currentCount = uploadedFiles[type].length;
      const maxAllowed = CONFIG.DIRECT_MODE_LIMITS[type] - currentCount;

      if (files.length > maxAllowed) {
        showNotification(`Solo puedes subir ${maxAllowed} ${type} m√°s. M√°ximo: ${CONFIG.DIRECT_MODE_LIMITS[type]}`, 'error');
        input.value = '';
        return;
      }

      files.forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          uploadedFiles[type].push(file);
          uploadedImages[type].push(e.target.result);
          
          updatePreview(type);
          updateCounters();
          updateCombinationsDisplay();
          updateGenerateButton();
        };
        reader.readAsDataURL(file);
      });

      input.value = '';
      showNotification(`${files.length} archivo(s) subidos correctamente`, 'success');
    }

    function updatePreview(type) {
      const preview = document.getElementById(`${type}-preview`);
      if (!preview) return;

      preview.innerHTML = '';
      uploadedImages[type].forEach((imageUrl, index) => {
        const container = document.createElement('div');
        container.className = 'preview-container';
        container.innerHTML = `
          <img src="${imageUrl}" class="preview-image" alt="${type} ${index + 1}">
          <button class="remove-image" onclick="removeImage('${type}', ${index})">√ó</button>
        `;
        preview.appendChild(container);
      });
    }

    window.removeImage = function(type, index) {
      uploadedFiles[type].splice(index, 1);
      uploadedImages[type].splice(index, 1);
      updatePreview(type);
      updateCounters();
      updateCombinationsDisplay();
      updateGenerateButton();
    };

    function updateCounters() {
      ['tops', 'bottoms', 'shoes'].forEach(type => {
        const counter = document.getElementById(`${type}Counter`);
        if (!counter) return;

        const count = uploadedImages[type].length;
        const max = CONFIG.DIRECT_MODE_LIMITS[type];
        
        counter.textContent = `${type.charAt(0).toUpperCase() + type.slice(1)}: ${count}/${max}`;
        counter.className = 'counter-item';
        if (count >= 1) counter.classList.add('counter-success');
      });
    }

    function updateCombinationsDisplay() {
      const display = document.getElementById('combinationsDisplay');
      const formula = document.getElementById('combinationsFormula');
      const result = document.getElementById('combinationsResult');
      
      const topsCount = uploadedImages.tops.length;
      const bottomsCount = uploadedImages.bottoms.length;
      const shoesCount = uploadedImages.shoes.length;

      if (topsCount > 0 || bottomsCount > 0 || shoesCount > 0) {
        display.classList.remove('hidden');
        const totalCombinations = topsCount * bottomsCount * shoesCount;
        const maxRecommendations = Math.min(3, totalCombinations);
        
        formula.textContent = `${topsCount} √ó ${bottomsCount} √ó ${shoesCount} = ${totalCombinations} combinaciones posibles`;
        result.textContent = `Se mostrar√°n las mejores ${maxRecommendations} recomendaciones`;
      } else {
        display.classList.add('hidden');
      }
    }

    function updateGenerateButton() {
      const generateBtn = document.getElementById('generateBtn');
      if (!generateBtn) return;

      const topsCount = uploadedImages.tops.length;
      const bottomsCount = uploadedImages.bottoms.length;
      const shoesCount = uploadedImages.shoes.length;

      const hasMinimum = topsCount >= 1 && bottomsCount >= 1 && shoesCount >= 1 && selectedOccasion;

      if (hasMinimum) {
        const totalCombinations = topsCount * bottomsCount * shoesCount;
        const recommendationsToShow = Math.min(3, totalCombinations);
        generateBtn.disabled = false;
        generateBtn.style.opacity = '1';
        generateBtn.innerHTML = `<i class="fas fa-magic"></i> Generar ${recommendationsToShow} Recomendaci√≥n${recommendationsToShow > 1 ? 'es' : ''}`;
      } else {
        generateBtn.disabled = true;
        generateBtn.style.opacity = '0.6';
        if (!selectedOccasion) {
          generateBtn.innerHTML = '<i class="fas fa-magic"></i> Selecciona una ocasi√≥n primero';
        } else {
          generateBtn.innerHTML = '<i class="fas fa-magic"></i> Sube al menos 1 prenda de cada tipo';
        }
      }
    }

    // RECOMMENDATIONS
    window.generateRecommendations = function() {
      const files = {
        tops: uploadedFiles.tops,
        bottoms: uploadedFiles.bottoms,
        shoes: uploadedFiles.shoes
      };
      generateRecommendationsWithFiles(files);
    };

    function generateRecommendationsWithFiles(files) {
      if (!selectedOccasion) {
        showNotification('Selecciona una ocasi√≥n primero', 'error');
        return;
      }

      const topsCount = files.tops.length;
      const bottomsCount = files.bottoms.length;
      const shoesCount = files.shoes.length;

      if (topsCount < 1 || bottomsCount < 1 || shoesCount < 1) {
        showNotification('Necesitas al menos 1 prenda de cada tipo', 'error');
        return;
      }

      const processingTimer = document.getElementById('processingTimer');
      const generateBtn = document.getElementById('generateBtn') || document.getElementById('closetGenerateBtn');

      processingTimer.classList.remove('hidden');
      if (generateBtn) {
        generateBtn.disabled = true;
        generateBtn.innerHTML = '<div class="loading"></div> Procesando con IA...';
      }

      let startTime = Date.now();
      const timerInterval = setInterval(() => {
        document.getElementById('timerDisplay').textContent = ((Date.now() - startTime) / 1000).toFixed(1) + 's';
      }, 100);

      const formData = new FormData();
      files.tops.forEach(file => formData.append('tops', file));
      files.bottoms.forEach(file => formData.append('bottoms', file));
      files.shoes.forEach(file => formData.append('shoes', file));
      formData.append('occasion', selectedOccasion);
      if (currentUser?.email) formData.append('user_email', currentUser.email);

      fetch(`${CONFIG.BACKEND_URL}/api/recommend`, {
        method: 'POST',
        body: formData
      })
      .then(async response => {
        const data = await response.json();
        if (!response.ok) throw new Error(data.message || `Error ${response.status}`);
        return data;
      })
      .then(data => {
        clearInterval(timerInterval);
        processingTimer.classList.add('hidden');
        if (generateBtn) {
          generateBtn.disabled = false;
          generateBtn.innerHTML = closetMode ? 
            '<i class="fas fa-magic"></i> Generar Nuevamente' :
            '<i class="fas fa-magic"></i> Generar para otra ocasi√≥n';
        }
        
        renderRecommendations(data);
        showNotification(`¬°Recomendaciones generadas para ${selectedOccasion}!`, 'success');
      })
      .catch(error => {
        console.error('‚ùå Error:', error);
        clearInterval(timerInterval);
        processingTimer.classList.add('hidden');
        if (generateBtn) {
          generateBtn.disabled = false;
          generateBtn.innerHTML = '<i class="fas fa-magic"></i> Reintentar';
        }
        showNotification(`Error: ${error.message}`, 'error');
      });
    }

    function renderRecommendations(data) {
      const result = document.getElementById('result');
      const results = data.results || [];

      if (results.length === 0) {
        result.innerHTML = '<p style="text-align: center; padding: 2rem;">No se encontraron recomendaciones.</p>';
        result.classList.remove('hidden');
        return;
      }

      let bestIndex = 0;
      let highestScore = 0;
      results.forEach((item, index) => {
        const score = item.final_score || 0;
        if (score > highestScore) {
          highestScore = score;
          bestIndex = index;
        }
      });

      const occasionText = {
        'oficina': 'Oficina/Trabajo',
        'deportivo': 'Deportes/Gym',
        'casual': 'Casual',
        'formal': 'Formal',
        'matrimonio': 'Matrimonio'
      };

      let html = `
        <div style="text-align: center; margin-bottom: 2rem;">
          <h2 style="color: #000000;">ü™Ñ Recomendaciones para ${occasionText[selectedOccasion] || selectedOccasion}</h2>
          <p style="color: #000000; opacity: 0.8;">${results.length} combinaciones ${closetMode ? 'desde tu Closet Digital' : 'optimizadas'}</p>
        </div>
        <div style="display: grid; gap: 2rem;">
      `;

      results.forEach((item, idx) => {
        const scorePercent = Math.round((item.final_score || 0) * 100);
        const isBest = idx === bestIndex;

        const topImage = getImageForCombination('tops', item);
        const bottomImage = getImageForCombination('bottoms', item);
        const shoeImage = getImageForCombination('shoes', item);

        html += `
          <div style="background: var(--background); border: 2px solid ${isBest ? 'var(--gold)' : 'var(--border)'}; border-radius: 20px; padding: 2rem; position: relative;">
            ${isBest ? '<div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); background: var(--gold); color: #000000; padding: 0.5rem 1.5rem; border-radius: 20px; font-weight: 800;">‚≠ê MEJOR</div>' : ''}
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; ${isBest ? 'margin-top: 1rem;' : ''}">
              <h3 style="color: #000000; margin: 0;">${closetMode ? 'üì¶' : ''} Combinaci√≥n ${idx + 1}</h3>
              <div style="display: flex; gap: 0.5rem; align-items: center;">
                <span style="background: ${isBest ? 'var(--gold)' : 'var(--primary)'}; color: ${isBest ? '#000000' : 'white'}; padding: 0.5rem 1rem; border-radius: 15px; font-weight: 700;">${scorePercent}%</span>
                ${closetMode ? '<button onclick="saveToFavorites(' + idx + ')" style="background: var(--success); color: white; border: none; padding: 0.5rem 1rem; border-radius: 10px; cursor: pointer;">‚≠ê Guardar</button>' : ''}
              </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1rem;">
              <div style="text-align: center;">
                <div style="font-size: 0.8rem; color: #000000; font-weight: 600; margin-bottom: 0.5rem;">üëï SUPERIOR</div>
                <div style="border-radius: 20px; padding: 1rem; min-height: 200px; display: flex; align-items: center; justify-content: center; border: 1px dashed rgba(59, 130, 246, 0.3);">
                  ${topImage ? `<img src="${topImage}" style="max-width: 150px; max-height: 150px; object-fit: contain; border-radius: 15px;" alt="Superior">` : '<div style="color: #666; font-size: 2rem;">üëï</div>'}
                </div>
                <div style="font-size: 0.9rem; color: #000000; opacity: 0.8; margin-top: 0.5rem;">${item.top?.detected_item || 'Superior'}</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 0.8rem; color: #000000; font-weight: 600; margin-bottom: 0.5rem;">üëñ INFERIOR</div>
                <div style="border-radius: 20px; padding: 1rem; min-height: 200px; display: flex; align-items: center; justify-content: center; border: 1px dashed rgba(59, 130, 246, 0.3);">
                  ${bottomImage ? `<img src="${bottomImage}" style="max-width: 150px; max-height: 150px; object-fit: contain; border-radius: 15px;" alt="Inferior">` : '<div style="color: #666; font-size: 2rem;">üëñ</div>'}
                </div>
                <div style="font-size: 0.9rem; color: #000000; opacity: 0.8; margin-top: 0.5rem;">${item.bottom?.detected_item || 'Inferior'}</div>
              </div>
              <div style="text-align: center;">
                <div style="font-size: 0.8rem; color: #000000; font-weight: 600; margin-bottom: 0.5rem;">üë¢ CALZADO</div>
                <div style="border-radius: 20px; padding: 1rem; min-height: 200px; display: flex; align-items: center; justify-content: center; border: 1px dashed rgba(59, 130, 246, 0.3);">
                  ${shoeImage ? `<img src="${shoeImage}" style="max-width: 150px; max-height: 150px; object-fit: contain; border-radius: 15px;" alt="Calzado">` : '<div style="color: #666; font-size: 2rem;">üë¢</div>'}
                </div>
                <div style="font-size: 0.9rem; color: #000000; opacity: 0.8; margin-top: 0.5rem;">${item.shoe?.detected_item || 'Calzado'}</div>
              </div>
            </div>
            
            <div style="background: rgba(59, 130, 246, 0.1); border-radius: 10px; padding: 1rem; text-align: center;">
              <div style="color: #000000; font-weight: 600; margin-bottom: 0.5rem;">
                ${item.harmony_type || 'Combinaci√≥n Equilibrada'}
              </div>
              <div style="color: #000000; opacity: 0.8; font-size: 0.9rem;">
                ${item.harmony_description || 'Una mezcla balanceada de colores y estilos'}
              </div>
            </div>
          </div>
        `;
      });

      html += '</div>';
      result.innerHTML = html;
      result.classList.remove('hidden');
      
      window.currentResults = results;
      
      setTimeout(() => {
        result.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }, 100);
    }

    function getImageForCombination(type, item) {
      const images = closetMode ? 
        (closetItems[type]?.map(item => item.imageUrl) || []) :
        (uploadedImages[type] || []);
      
      if (!images || images.length === 0) return null;

      let backendIndex;
      if (type === 'tops' && item.top) backendIndex = item.top.index;
      else if (type === 'bottoms' && item.bottom) backendIndex = item.bottom.index;
      else if (type === 'shoes' && item.shoe) backendIndex = item.shoe.index;
      else return null;

      if (typeof backendIndex === 'number' && backendIndex >= 0 && backendIndex < images.length) {
        return images[backendIndex];
      }

      return images[0];
    }

    // GUARDADO DE FAVORITOS
    window.saveToFavorites = function(index) {
      if (!closetMode || !window.currentResults) return;
      
      const recommendation = window.currentResults[index];
      savedRecommendations.push({
        id: Date.now(),
        recommendation,
        occasion: selectedOccasion,
        savedAt: new Date().toISOString()
      });
      
      saveUserData();
      updateClosetUI();
      showNotification('Recomendaci√≥n guardada en favoritos', 'success');
    };

    // UTILITY FUNCTIONS
    function hideAllSections() {
      ['welcomeSection', 'profileForm', 'modeSelector', 'occasionSelector', 'uploadArea', 'closetContainer', 'result'].forEach(id => {
        document.getElementById(id).classList.add('hidden');
      });
    }

    // Pricing & Team Functions
    window.startFreePlan = () => showNotification('Plan gratuito activado', 'success');
    window.upgradeToPremium = () => showNotification('Funci√≥n de upgrade disponible pr√≥ximamente', 'info');

    // EVENT DELEGATION - COMPLETO
    document.addEventListener('click', (e) => {
      // Navigation
      if (e.target.matches('[data-section]')) {
        e.preventDefault();
        const section = e.target.dataset.section;
        scrollToSection(section);
      }

      // Profile options
      if (e.target.matches('.form-option')) {
        const field = e.target.dataset.field;
        document.querySelectorAll(`[data-field="${field}"]`).forEach(opt => opt.classList.remove('selected'));
        e.target.classList.add('selected');
        checkProfileCompletion();
      }

      // Closet tabs
      if (e.target.matches('.closet-tab') || e.target.closest('.closet-tab')) {
        const tab = e.target.closest('.closet-tab') || e.target;
        const type = tab.dataset.type;
        
        document.querySelectorAll('.closet-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        activeClosetType = type;
        renderClosetContent();
      }

      // Occasion selection
      if (e.target.matches('[data-occasion]') || e.target.closest('[data-occasion]')) {
        const btn = e.target.closest('[data-occasion]') || e.target;
        
        document.querySelectorAll('[data-occasion]').forEach(b => {
          b.style.borderColor = '';
          b.style.background = '';
        });

        btn.style.borderColor = 'var(--success)';
        btn.style.background = 'rgba(16, 185, 129, 0.1)';

        selectedOccasion = btn.dataset.occasion;
        showNotification(`Ocasi√≥n seleccionada: ${selectedOccasion}`, 'success');

        if (closetMode) {
          updateClosetGenerateButton();
        } else {
          setTimeout(() => {
            document.getElementById('uploadArea').classList.remove('hidden');
            scrollToSection('upload');
            updateGenerateButton();
          }, 500);
        }
      }
    });

    // File upload listeners
    document.addEventListener('change', (e) => {
      if (e.target.matches('.file-input') && e.target.id !== 'closet-upload') {
        const type = e.target.id.replace('-upload', '');
        handleFileUpload(type, e.target);
      }
    });

    // INITIALIZATION - COMPLETA
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ NoShopiA Complete System with Smart Closet Initialized');
      
      const checkGoogleLoaded = setInterval(() => {
        if (window.google && window.google.accounts) {
          console.log('‚úÖ Google Sign-In API loaded');
          clearInterval(checkGoogleLoaded);
          updateAuthUI();
        }
      }, 500);

      setTimeout(() => {
        clearInterval(checkGoogleLoaded);
        if (!window.google) {
          showNotification('Error cargando autenticaci√≥n. Recarga la p√°gina.', 'error');
        }
      }, 10000);

      // Animate impact bars on scroll
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const fills = entry.target.querySelectorAll('.impact-fill');
            fills.forEach(fill => {
              const width = fill.dataset.width;
              if (width) {
                fill.style.width = width + '%';
              }
            });
          }
        });
      });

      const impactSection = document.getElementById('impacto');
      if (impactSection) {
        observer.observe(impactSection);
      }

      setTimeout(() => {
        if (!isLoggedIn) {
          showNotification('¬°Bienvenido a NoShopiA! Inicia sesi√≥n para comenzar.', 'info');
        }
      }, 2000);
    });

    console.log('‚úÖ NoShopiA Complete System with Smart Closet Ready');
  </script>
</body>
</html>
